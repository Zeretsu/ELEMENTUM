<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elementum | Interactive Periodic Table</title>
    <meta name="description" content="Explore the periodic table in stunning 3D. Interact with all 118 elements, combine them to form compounds, and discover chemistry like never before.">
    <meta name="keywords" content="periodic table, chemistry, elements, 3D, interactive, education, science">
    <meta name="author" content="Zeretsu">
    <meta name="theme-color" content="#0a0a1a">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="Elementum | Interactive 3D Periodic Table">
    <meta property="og:description" content="Explore chemistry in stunning 3D. All 118 elements with compound combinations.">
    <meta property="og:type" content="website">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect rx='15' width='100' height='100' fill='%230a0a2e'/><text x='50' y='68' font-size='55' font-weight='bold' text-anchor='middle' fill='%2300d4ff'>E</text><circle cx='75' cy='25' r='8' fill='%23ff6b6b'/><circle cx='25' cy='75' r='6' fill='%231dd1a1'/><circle cx='80' cy='70' r='5' fill='%23a29bfe'/></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* GPU Acceleration Hints */
        .cursor-glow, .cursor-trail, .ripple, .morph-blob, .aurora, .star, .nebula, 
        .energy-beam, .shooting-star, .floating-particle, #science-bg, .scan-beam {
            will-change: transform, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #0a0a1a;
            min-height: 100vh;
            overflow: hidden;
            color: #fff;
            user-select: none;
            cursor: crosshair;
        }
        
        /* Cursor Trail */
        .cursor-trail {
            position: fixed;
            top: 0;
            left: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.6), transparent);
            pointer-events: none;
            z-index: 9998;
            mix-blend-mode: screen;
            animation: trailFade 0.25s ease-out forwards;
            contain: strict;
        }
        
        @keyframes trailFade {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.3); }
        }
        
        /* Custom Cursor Glow */
        .cursor-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 30px;
            height: 30px;
            border: 2px solid rgba(0, 212, 255, 0.4);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9997;
            will-change: transform;
            transform-origin: center center;
        }
        
        .cursor-glow.clicking {
            transform: translate(var(--x), var(--y)) scale(0.8) !important;
            border-color: rgba(255, 100, 200, 0.8);
        }
        
        .cursor-glow.hovering {
            transform: translate(var(--x), var(--y)) scale(1.5) !important;
            border-color: rgba(0, 255, 200, 0.8);
            box-shadow: 0 0 20px rgba(0, 255, 200, 0.4), inset 0 0 15px rgba(0, 255, 200, 0.2);
        }
        
        /* Ripple Effect */
        .ripple {
            position: fixed;
            border-radius: 50%;
            border: 2px solid rgba(0, 212, 255, 0.6);
            pointer-events: none;
            z-index: 9996;
            animation: rippleOut 0.6s ease-out forwards;
        }
        
        @keyframes rippleOut {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
        }
        
        /* Scanning Lines Overlay */
        .scan-lines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            opacity: 0.3;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 3px,
                rgba(0, 0, 0, 0.02) 3px,
                rgba(0, 0, 0, 0.02) 6px
            );
        }
        
        /* Scanning Beam - Optimized */
        .scan-beam {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent 10%, rgba(0, 212, 255, 0.2) 50%, transparent 90%);
            pointer-events: none;
            z-index: 3;
            animation: scanDown 12s linear infinite;
            contain: strict;
        }
        
        @keyframes scanDown {
            0% { transform: translateY(0); opacity: 0; }
            5% { opacity: 0.8; }
            95% { opacity: 0.8; }
            100% { transform: translateY(100vh); opacity: 0; }
        }
        
        /* Morphing Blob - Simplified for performance */
        .morph-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(50px);
            opacity: 0.12;
            animation: morphBlob 20s ease-in-out infinite;
            pointer-events: none;
            mix-blend-mode: screen;
        }
        
        @keyframes morphBlob {
            0%, 100% {
                transform: scale(1) translateY(0);
            }
            50% {
                transform: scale(1.15) translateY(-20px);
            }
        }
        
        /* Hexagonal Grid Pattern */
        .hex-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%2300d4ff' fill-opacity='0.03'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.98-7.5V0h-2v6.35L0 12.69v2.3zm0 18.5L12.98 41v8h-2v-6.85L0 35.81v-2.3zM15 0v7.5L27.99 15H28v-2.31h-.01L17 6.35V0h-2zm0 49v-8l12.99-7.5H28v2.31h-.01L17 42.15V49h-2z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
            animation: hexPulse 10s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes hexPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        /* Vignette Effect */
        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 4;
            background: radial-gradient(ellipse at center, transparent 0%, transparent 60%, rgba(0, 0, 0, 0.4) 100%);
        }
        
        /* Screen Flash Effect */
        #screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3999;
            opacity: 0;
            background: radial-gradient(ellipse at center, rgba(0, 212, 255, 0.4), rgba(138, 43, 226, 0.3), transparent);
        }
        
        #screen-flash.flash {
            animation: screenFlash 0.5s ease-out;
        }
        
        @keyframes screenFlash {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Scientific animated background */
        #science-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(0, 200, 255, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(180, 0, 255, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 40%, rgba(0, 255, 200, 0.2) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 70%, rgba(255, 50, 150, 0.2) 0%, transparent 40%),
                radial-gradient(ellipse at 50% 50%, rgba(100, 0, 200, 0.15) 0%, transparent 60%),
                linear-gradient(180deg, #010105 0%, #080818 30%, #0a0a25 60%, #0f1035 100%);
        }
        
        /* Aurora Borealis Effect - Optimized */
        .aurora {
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 200, 0.04) 20%,
                rgba(100, 0, 255, 0.06) 50%,
                rgba(0, 150, 255, 0.05) 80%,
                transparent 100%);
            animation: aurora 25s ease-in-out infinite;
            pointer-events: none;
            filter: blur(80px);
            contain: strict;
        }
        
        @keyframes aurora {
            0%, 100% { transform: translateX(-25%); }
            50% { transform: translateX(-50%); }
        }
        
        /* Floating Stars - Optimized */
        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            pointer-events: none;
            contain: strict;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Shooting Stars */
        .shooting-star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            animation: shootingStar 4s linear infinite;
            contain: strict;
        }
        
        .shooting-star::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 0;
            width: 60px;
            height: 1px;
            background: linear-gradient(90deg, rgba(255,255,255,0.6), transparent);
            transform: translateY(-50%);
        }
        
        @keyframes shootingStar {
            0% { transform: translate(0, 0) rotate(-45deg); opacity: 0; }
            10% { opacity: 1; }
            50% { transform: translate(-150px, 150px) rotate(-45deg); opacity: 0; }
            100% { opacity: 0; }
        }
        
        /* Nebula Clouds - Optimized */
        .nebula {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            animation: nebulaPulse 20s ease-in-out infinite;
            pointer-events: none;
            mix-blend-mode: screen;
            contain: strict;
        }
        
        @keyframes nebulaPulse {
            0%, 100% { opacity: 0.25; }
            50% { opacity: 0.4; }
        }

        .molecule {
            position: absolute;
            opacity: 0.3;
            animation: floatMolecule 25s infinite ease-in-out;
            pointer-events: none;
            contain: strict;
        }

        .atom-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.8) 0%, transparent 70%);
            contain: strict;
            border-radius: 50%;
            animation: drift 15s infinite linear;
            pointer-events: none;
            box-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
        }
        
        /* Energy Beam Effect */
        .energy-beam {
            position: absolute;
            width: 2px;
            height: 100vh;
            background: linear-gradient(to bottom, transparent, rgba(0, 212, 255, 0.3), transparent);
            animation: beamMove 10s ease-in-out infinite;
            pointer-events: none;
            contain: strict;
        }
        
        @keyframes beamMove {
            0%, 100% { transform: translateX(0); opacity: 0; }
            50% { transform: translateX(100vw); opacity: 0.5; }
        }

        .electron-orbit {
            position: absolute;
            border: 1px solid rgba(0, 212, 255, 0.15);
            border-radius: 50%;
            animation: rotateOrbit 12s infinite linear;
            pointer-events: none;
            contain: strict;
        }

        .electron-orbit::before {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(0, 212, 255, 0.7);
            border-radius: 50%;
            top: -3px;
            left: 50%;
            transform: translateX(-50%);
        }

        .grid-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.04) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
        }

        .helix {
            position: absolute;
            width: 100px;
            height: 400px;
            opacity: 0.08;
            animation: helixFloat 30s infinite ease-in-out;
            contain: strict;
        }

        .helix-strand {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .helix-node {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(123, 47, 255, 0.6);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(123, 47, 255, 0.4);
        }

        .helix-connector {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.4), rgba(123, 47, 255, 0.4));
        }

        .formula-float {
            position: absolute;
            font-family: 'Times New Roman', serif;
            font-size: 16px;
            color: rgba(0, 212, 255, 0.25);
            animation: formulaFloat 30s infinite linear;
            pointer-events: none;
            white-space: nowrap;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        @keyframes floatMolecule {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-30px) rotate(90deg); }
            50% { transform: translateY(-10px) rotate(180deg); }
            75% { transform: translateY(-40px) rotate(270deg); }
        }

        @keyframes drift {
            0% { transform: translate(0, 0); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translate(var(--drift-x), var(--drift-y)); opacity: 0; }
        }

        @keyframes rotateOrbit {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes helixFloat {
            0%, 100% { transform: translateY(0) rotateY(0deg); }
            50% { transform: translateY(-50px) rotateY(180deg); }
        }

        @keyframes formulaFloat {
            0% { transform: translateX(-100px); opacity: 0; }
            5% { opacity: 0.1; }
            95% { opacity: 0.1; }
            100% { transform: translateX(calc(100vw + 100px)); opacity: 0; }
        }
        
        /* Central Pulsing Glow */
        .central-glow {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60vw;
            height: 60vh;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, 
                rgba(0, 212, 255, 0.08) 0%, 
                rgba(138, 43, 226, 0.05) 30%,
                rgba(255, 45, 146, 0.03) 50%,
                transparent 70%);
            pointer-events: none;
            z-index: 0;
            animation: centralPulse 6s ease-in-out infinite;
            filter: blur(60px);
        }
        
        @keyframes centralPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
        }

        #scene-container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #scene-container canvas {
            display: block;
        }

        /* Ensure UI elements are above scene */
        #top-bar, #category-filter, #combination-panel, #tooltip, #loading {
            z-index: 100;
        }

        /* Top Bar */
        #top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: linear-gradient(180deg, rgba(8, 12, 30, 0.98) 0%, rgba(12, 16, 40, 0.95) 100%);
            backdrop-filter: blur(25px);
            display: flex;
            align-items: center;
            padding: 0 30px;
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 212, 255, 0.12);
            box-shadow: 
                0 4px 30px rgba(0, 0, 0, 0.4),
                0 1px 0 rgba(255, 255, 255, 0.03) inset;
        }
        
        #top-bar::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 212, 255, 0.4) 20%, 
                rgba(162, 155, 254, 0.4) 50%, 
                rgba(0, 212, 255, 0.4) 80%, 
                transparent 100%);
        }

        #top-bar h1 {
            font-size: 26px;
            font-weight: 800;
            background: linear-gradient(135deg, #00d4ff 0%, #a29bfe 50%, #00ffc8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            text-transform: uppercase;
            filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.4));
        }

        #search-container {
            margin-left: 35px;
            position: relative;
        }

        #search {
            width: 260px;
            padding: 11px 18px 11px 42px;
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 30px;
            background: rgba(0, 20, 40, 0.5);
            color: #fff;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        #search:focus {
            border-color: rgba(0, 212, 255, 0.5);
            background: rgba(0, 30, 60, 0.7);
            width: 320px;
            box-shadow: 
                0 0 20px rgba(0, 212, 255, 0.2),
                inset 0 0 15px rgba(0, 212, 255, 0.05);
        }

        #search::placeholder {
            color: rgba(255,255,255,0.4);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(0, 212, 255, 0.6);
            transition: all 0.3s ease;
        }
        
        #search:focus + .search-icon,
        #search-container:hover .search-icon {
            color: #00d4ff;
            filter: drop-shadow(0 0 5px rgba(0, 212, 255, 0.5));
        }

        #controls-container {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 9px 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.85);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            gap: 7px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.4s ease;
        }
        
        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: rgba(0, 212, 255, 0.15);
            border-color: rgba(0, 212, 255, 0.3);
            transform: translateY(-1px);
            color: #fff;
        }

        .btn.active {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.3), rgba(162, 155, 254, 0.3));
            border-color: rgba(0, 212, 255, 0.4);
            color: #fff;
            box-shadow: 0 2px 15px rgba(0, 212, 255, 0.2);
        }

        /* Category Filter */
        #category-filter {
            position: fixed;
            top: 85px;
            left: 20px;
            background: rgba(10, 10, 30, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 18px;
            z-index: 100;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            min-width: 190px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        #category-filter::-webkit-scrollbar {
            width: 6px;
        }

        #category-filter::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.03);
            border-radius: 3px;
        }

        #category-filter::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(0, 212, 255, 0.4), rgba(138, 43, 226, 0.4));
            border-radius: 3px;
        }

        #category-filter h3 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: rgba(0, 212, 255, 0.8);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.15);
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s ease;
            margin-bottom: 4px;
            border: 1px solid transparent;
            background: rgba(255, 255, 255, 0.02);
        }

        .category-item:hover {
            background: rgba(0, 212, 255, 0.12);
            border-color: rgba(0, 212, 255, 0.25);
            transform: translateX(4px);
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.1);
        }

        .category-item.active {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.15), rgba(138, 43, 226, 0.1));
            border-color: rgba(0, 212, 255, 0.4);
            box-shadow: 0 0 25px rgba(0, 212, 255, 0.15), inset 0 0 20px rgba(0, 212, 255, 0.05);
        }

        .category-color {
            width: 16px;
            height: 16px;
            border-radius: 5px;
            box-shadow: 0 0 8px currentColor;
            flex-shrink: 0;
            transition: all 0.25s ease;
        }
        
        .category-item:hover .category-color {
            transform: scale(1.15);
            box-shadow: 0 0 12px currentColor, 0 0 20px currentColor;
        }

        .category-name {
            font-size: 13px;
            color: rgba(255,255,255,0.85);
            white-space: nowrap;
            transition: all 0.25s ease;
            font-weight: 400;
        }
        
        .category-item:hover .category-name {
            color: #fff;
        }
        
        .category-item.active .category-name {
            color: #fff;
            font-weight: 500;
        }

        /* Element Tooltip */
        #tooltip {
            position: fixed;
            pointer-events: none;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.2s;
        }

        #tooltip.visible {
            opacity: 1;
        }

        .tooltip-content {
            background: linear-gradient(135deg, rgba(10, 10, 40, 0.98), rgba(15, 10, 50, 0.98));
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 22px;
            min-width: 340px;
            max-width: 380px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            border: 2px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 30px 60px rgba(0,0,0,0.6), 0 0 40px rgba(0, 212, 255, 0.15), inset 0 1px 0 rgba(255,255,255,0.1);
            position: relative;
            animation: tooltipGlow 3s ease-in-out infinite;
        }
        
        @keyframes tooltipGlow {
            0%, 100% { box-shadow: 0 30px 60px rgba(0,0,0,0.6), 0 0 40px rgba(0, 212, 255, 0.15), inset 0 1px 0 rgba(255,255,255,0.1); }
            50% { box-shadow: 0 30px 60px rgba(0,0,0,0.6), 0 0 60px rgba(0, 212, 255, 0.25), 0 0 80px rgba(138, 43, 226, 0.1), inset 0 1px 0 rgba(255,255,255,0.1); }
        }
        
        .tooltip-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.6), rgba(138, 43, 226, 0.6), transparent);
            border-radius: 24px 24px 0 0;
        }
        
        .tooltip-content::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 50%;
            background: radial-gradient(ellipse at top, rgba(0, 212, 255, 0.08), transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .tooltip-content::-webkit-scrollbar {
            width: 6px;
        }

        .tooltip-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }

        .tooltip-content::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.3);
            border-radius: 3px;
        }

        .tooltip-header {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .tooltip-symbol-box {
            width: 85px;
            height: 85px;
            border-radius: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            animation: symbolBoxPulse 2s ease-in-out infinite;
        }
        
        @keyframes symbolBoxPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        
        .tooltip-symbol-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: symbolShine 4s linear infinite;
        }
        
        @keyframes symbolShine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .tooltip-symbol-box::after {
            content: '';
            position: absolute;
            inset: 2px;
            border-radius: 16px;
            background: inherit;
            z-index: 1;
        }

        .tooltip-number {
            position: absolute;
            top: 6px;
            left: 8px;
            font-size: 11px;
            opacity: 0.9;
            z-index: 2;
            text-shadow: 0 0 10px currentColor;
        }

        .tooltip-symbol {
            font-size: 38px;
            font-weight: 700;
            z-index: 2;
            text-shadow: 0 0 20px currentColor, 0 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 1px;
        }

        .tooltip-mass {
            font-size: 11px;
            opacity: 0.8;
            z-index: 2;
        }

        .tooltip-info h2 {
            font-size: 24px;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #fff, rgba(0, 212, 255, 0.9));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tooltip-category {
            font-size: 13px;
            opacity: 0.6;
            text-transform: capitalize;
        }

        .tooltip-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tooltip-item {
            background: rgba(255,255,255,0.05);
            padding: 10px 12px;
            border-radius: 10px;
        }

        .tooltip-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.5;
            margin-bottom: 4px;
        }

        .tooltip-value {
            font-size: 14px;
            font-weight: 500;
        }

        .tooltip-description {
            font-size: 13px;
            line-height: 1.6;
            opacity: 0.8;
        }

        /* Electron Shell Visualization */
        .electron-shells {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .shells-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(0, 212, 255, 0.8);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .shells-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(0, 212, 255, 0.2);
        }

        .shell-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            padding: 6px 10px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }

        .shell-label {
            font-size: 13px;
            font-weight: 600;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 212, 255, 0.2);
            border-radius: 50%;
            color: #00d4ff;
        }

        .shell-name {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            width: 50px;
        }

        .shell-electrons {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .electron {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #00a8cc);
            box-shadow: 0 0 6px rgba(0, 212, 255, 0.6);
        }

        .shell-count {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            margin-left: auto;
            background: rgba(0, 212, 255, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .shell-key {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px dashed rgba(255,255,255,0.1);
            font-size: 10px;
            color: rgba(255,255,255,0.4);
            line-height: 1.6;
        }

        .shell-key-title {
            color: rgba(0, 212, 255, 0.6);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .shell-key-item {
            display: inline-block;
            margin-right: 12px;
        }

        .shell-key-letter {
            color: #00d4ff;
            font-weight: 600;
        }

        /* Combination Panel */
        #combination-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(calc(100% + 10px));
            background: linear-gradient(135deg, rgba(15, 15, 45, 0.98), rgba(25, 15, 55, 0.98));
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 20px 30px;
            z-index: 100;
            border: 2px solid rgba(0, 212, 255, 0.3);
            min-width: 500px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.5), 0 0 40px rgba(0, 212, 255, 0.1);
        }

        #combination-panel.visible {
            transform: translateX(-50%) translateY(0);
            transition: transform 0.3s ease;
        }
        
        #combination-panel:not(.visible) {
            transition: transform 0.3s ease;
        }

        #combiner-toggle {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.4), rgba(138, 43, 226, 0.4));
            border: 2px solid rgba(0, 212, 255, 0.5);
            color: #fff;
            padding: 14px 28px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            z-index: 99;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 5px 25px rgba(0, 212, 255, 0.3), 0 0 50px rgba(138, 43, 226, 0.2);
            animation: pulseGlow 3s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 5px 25px rgba(0, 212, 255, 0.3), 0 0 50px rgba(138, 43, 226, 0.2); }
            50% { box-shadow: 0 5px 35px rgba(0, 212, 255, 0.5), 0 0 70px rgba(138, 43, 226, 0.4); }
        }

        #combiner-toggle:hover {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.6), rgba(138, 43, 226, 0.6));
            transform: translateX(-50%) scale(1.08) translateY(-3px);
            box-shadow: 0 10px 40px rgba(0, 212, 255, 0.5), 0 0 80px rgba(138, 43, 226, 0.4);
        }

        #combiner-toggle.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #combination-panel h3 {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 15px;
            text-align: center;
        }

        #selected-elements {
            display: flex;
            justify-content: center;
            gap: 10px;
            min-height: 70px;
            align-items: center;
            flex-wrap: wrap;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 16px;
            margin-bottom: 15px;
        }

        .selected-element {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            animation: elementFloat 3s ease-in-out infinite, elementGlow 2s ease-in-out infinite;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255,255,255,0.1);
        }
        
        @keyframes elementFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        
        @keyframes elementGlow {
            0%, 100% { box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255,255,255,0.1); }
            50% { box-shadow: 0 5px 30px rgba(0, 212, 255, 0.3), inset 0 1px 0 rgba(255,255,255,0.2), 0 0 15px rgba(138, 43, 226, 0.2); }
        }

        .selected-element:hover {
            transform: scale(1.15) translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.4), 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .selected-element .remove-btn {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff3366, #ff6b6b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0;
            transition: all 0.2s;
            box-shadow: 0 2px 10px rgba(255, 51, 102, 0.5);
        }

        .selected-element:hover .remove-btn {
            opacity: 1;
            transform: scale(1.1);
        }

        .selected-element .symbol {
            font-size: 22px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .selected-element .name {
            font-size: 8px;
            opacity: 0.7;
        }

        .plus-sign {
            font-size: 24px;
            opacity: 0.5;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            animation: plusPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes plusPulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .empty-slot {
            width: 60px;
            height: 60px;
            border: 2px dashed rgba(0, 212, 255, 0.4);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            opacity: 0.5;
            animation: emptySlotPulse 2s ease-in-out infinite;
            background: radial-gradient(circle at center, rgba(0, 212, 255, 0.05), transparent);
        }
        
        @keyframes emptySlotPulse {
            0%, 100% { border-color: rgba(0, 212, 255, 0.4); }
            50% { border-color: rgba(138, 43, 226, 0.6); }
        }

        #combination-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        #combination-buttons .btn {
            padding: 12px 24px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff, #7b2fff) !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4), 0 0 30px rgba(123, 47, 255, 0.2);
            transition: all 0.3s ease !important;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: btnShimmer 2s infinite;
        }
        
        @keyframes btnShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .btn-primary:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 25px rgba(0, 212, 255, 0.6), 0 0 40px rgba(123, 47, 255, 0.4) !important;
        }

        .btn-danger {
            background: rgba(255, 51, 102, 0.2) !important;
            border-color: #ff3366 !important;
            transition: all 0.3s ease !important;
        }
        
        .btn-danger:hover {
            background: rgba(255, 51, 102, 0.4) !important;
            box-shadow: 0 4px 20px rgba(255, 51, 102, 0.4) !important;
            transform: translateY(-2px) !important;
        }

        /* Compound Result - Holographic Style */
        #compound-result {
            display: none;
            margin-top: 20px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.15), rgba(138, 43, 226, 0.1), rgba(0, 255, 200, 0.1));
            border: 2px solid transparent;
            border-image: linear-gradient(135deg, rgba(0, 212, 255, 0.6), rgba(138, 43, 226, 0.6), rgba(0, 255, 200, 0.6)) 1;
            border-radius: 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        #compound-result::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            animation: holographicShine 3s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes holographicShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        #compound-result.visible {
            display: block;
            animation: resultReveal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes resultReveal {
            0% { opacity: 0; transform: translateY(20px) scale(0.9); }
            50% { transform: translateY(-5px) scale(1.02); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        .compound-formula {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 10px;
            font-family: 'Times New Roman', serif;
            background: linear-gradient(135deg, #fff, #00d4ff, #a29bfe, #00d4ff, #fff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmerText 3s linear infinite;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.3));
        }
        
        @keyframes shimmerText {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .compound-name {
            font-size: 22px;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #00d4ff, #a29bfe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        .compound-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
            text-align: left;
        }

        .compound-detail-item {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 10px;
        }

        .compound-detail-label {
            font-size: 10px;
            text-transform: uppercase;
            opacity: 0.5;
            margin-bottom: 4px;
        }

        .compound-detail-value {
            font-size: 14px;
        }

        .compound-description {
            margin-top: 15px;
            font-size: 14px;
            line-height: 1.7;
            opacity: 0.8;
            text-align: left;
        }

        /* No Result */
        .no-compound {
            padding: 20px;
            text-align: center;
            opacity: 0.6;
        }

        /* Instructions Panel */
        #instructions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 15px 20px;
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.1);
            font-size: 12px;
            line-height: 1.8;
        }

        #instructions h4 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.5;
            margin-bottom: 10px;
        }

        .instruction-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instruction-icon {
            font-size: 16px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Subscript for formulas */
        sub {
            font-size: 0.65em;
            vertical-align: sub;
        }

        /* Highlight animation */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .element-highlight {
            animation: pulse 0.5s ease;
        }

        /* Loading - Epic Intro */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #0a0a25 0%, #050510 50%, #000005 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.8s ease, transform 0.8s ease;
            overflow: hidden;
        }
        
        #loading::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent 0%, rgba(0, 212, 255, 0.1) 25%, transparent 50%, rgba(138, 43, 226, 0.1) 75%, transparent 100%);
            animation: loadingRotate 10s linear infinite;
        }
        
        @keyframes loadingRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #loading.hidden {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }

        .loader {
            width: 120px;
            height: 120px;
            position: relative;
        }

        .loader-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }

        .loader-ring:nth-child(1) {
            border-top-color: #00d4ff;
            animation-duration: 1s;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .loader-ring:nth-child(2) {
            border-right-color: #a29bfe;
            animation-duration: 1.5s;
            animation-direction: reverse;
            width: 75%;
            height: 75%;
            top: 12.5%;
            left: 12.5%;
            box-shadow: 0 0 15px rgba(162, 155, 254, 0.4);
        }

        .loader-ring:nth-child(3) {
            border-bottom-color: #1dd1a1;
            animation-duration: 2s;
            width: 50%;
            height: 50%;
            top: 25%;
            left: 25%;
            box-shadow: 0 0 15px rgba(29, 209, 161, 0.4);
        }

        .loader-nucleus {
            position: absolute;
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, #ff6b6b, #ff4757);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 30px #ff6b6b;
            animation: nucleusPulse 1.5s ease-in-out infinite;
        }

        @keyframes nucleusPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loading p {
            margin-top: 20px;
            opacity: 0.6;
        }

        #loading-facts {
            margin-top: 15px;
            font-size: 13px;
            opacity: 0.5;
            font-style: italic;
            max-width: 300px;
            text-align: center;
            animation: fadeInOut 4s infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            20%, 80% { opacity: 0.5; }
        }

        /* ELEMENTUM Letter Animation */
        #elementum-reveal {
            display: none;
            flex-direction: row;
            gap: 10px;
            margin-bottom: 30px;
            perspective: 1000px;
        }
        
        #elementum-reveal.active {
            display: flex;
        }
        
        .element-letter {
            width: 60px;
            height: 70px;
            background: linear-gradient(145deg, rgba(20, 20, 50, 0.95), rgba(10, 10, 30, 0.98));
            border: 2px solid;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            opacity: 0;
            transform: translateY(50px) rotateX(-30deg) scale(0.5);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .element-letter.animate {
            animation: letterReveal 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        
        @keyframes letterReveal {
            0% {
                opacity: 0;
                transform: translateY(50px) rotateX(-30deg) scale(0.5);
            }
            60% {
                opacity: 1;
                transform: translateY(-10px) rotateX(10deg) scale(1.1);
            }
            100% {
                opacity: 1;
                transform: translateY(0) rotateX(0) scale(1);
            }
        }
        
        .element-letter .symbol {
            font-size: 36px;
            font-weight: 700;
        }
        
        .element-letter.glow {
            animation: letterGlow 1.5s ease-in-out infinite;
        }
        
        @keyframes letterGlow {
            0%, 100% { 
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
            50% { 
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 30px var(--glow-color), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
        }
        
        #loading-subtitle {
            opacity: 0;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-top: 20px;
            transition: opacity 0.5s ease;
        }
        
        #loading-subtitle.visible {
            opacity: 1;
        }
        
        .loader-phase-1 {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        
        .loader-phase-1.hide {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
            position: absolute;
        }

        /* Discovery Counter - Sleek Panel */
        #discovery-panel {
            position: fixed;
            top: 85px;
            left: 20px;
            background: linear-gradient(135deg, rgba(10, 10, 40, 0.95), rgba(20, 10, 50, 0.95));
            backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 18px 22px;
            z-index: 100;
            border: 1px solid rgba(0, 212, 255, 0.3);
            min-width: 190px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 0 30px rgba(0, 212, 255, 0.1);
        }

        #discovery-panel h4 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: rgba(0, 212, 255, 0.9);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .discovery-count {
            font-size: 38px;
            font-weight: 700;
            background: linear-gradient(135deg, #00d4ff 0%, #a29bfe 50%, #00d4ff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmerCount 3s linear infinite;
            filter: drop-shadow(0 0 8px rgba(0, 212, 255, 0.4));
        }
        
        @keyframes shimmerCount {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .discovery-total {
            font-size: 14px;
            opacity: 0.5;
        }

        .discovery-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 12px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .discovery-progress {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #a29bfe, #ff6b9d, #00d4ff);
            background-size: 300% 100%;
            animation: progressShimmer 3s linear infinite;
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        @keyframes progressShimmer {
            0% { background-position: 100% 0; }
            100% { background-position: 0% 0; }
        }

        .discovery-recent {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 11px;
            opacity: 0.6;
        }

        /* Combine Animation - Epic Energy Burst */
        .combine-flash {
            animation: energyBurst 0.8s cubic-bezier(0.22, 0.61, 0.36, 1) forwards !important;
        }
        
        @keyframes energyBurst {
            0% { 
                box-shadow: 0 25px 60px rgba(0,0,0,0.5);
                filter: brightness(1);
                transform: translateX(-50%) scale(1);
            }
            25% { 
                box-shadow: 0 0 80px rgba(0, 212, 255, 0.8), 0 0 120px rgba(138, 43, 226, 0.5);
                filter: brightness(1.3);
                transform: translateX(-50%) scale(1.02);
            }
            50% { 
                box-shadow: 0 0 60px rgba(0, 255, 200, 0.6);
                filter: brightness(1.2);
                transform: translateX(-50%) scale(1.01);
            }
            100% { 
                box-shadow: 0 25px 60px rgba(0,0,0,0.5);
                filter: brightness(1);
                transform: translateX(-50%) scale(1);
            }
        }

        /* Compound Success Particles */
        .success-particle {
            position: fixed;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 3500;
        }

        /* Quiz Mode Panel */
        #quiz-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 10, 30, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            z-index: 3000;
            border: 1px solid rgba(0, 212, 255, 0.3);
            min-width: 450px;
            max-width: 550px;
            text-align: center;
        }

        #quiz-panel.visible {
            display: block;
        }

        #quiz-panel h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }
        
        .quiz-difficulty-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .difficulty-btn {
            padding: 10px 20px;
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .difficulty-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .difficulty-btn.active {
            border-color: var(--diff-color);
            background: var(--diff-bg);
            box-shadow: 0 0 20px var(--diff-glow);
        }
        
        .difficulty-btn.beginner {
            --diff-color: #1dd1a1;
            --diff-bg: rgba(29, 209, 161, 0.2);
            --diff-glow: rgba(29, 209, 161, 0.3);
        }
        
        .difficulty-btn.amateur {
            --diff-color: #feca57;
            --diff-bg: rgba(254, 202, 87, 0.2);
            --diff-glow: rgba(254, 202, 87, 0.3);
        }
        
        .difficulty-btn.master {
            --diff-color: #ff6b6b;
            --diff-bg: rgba(255, 107, 107, 0.2);
            --diff-glow: rgba(255, 107, 107, 0.3);
        }
        
        .quiz-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .quiz-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .quiz-stat-label {
            font-size: 10px;
            text-transform: uppercase;
            opacity: 0.5;
        }
        
        .quiz-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #00d4ff;
        }
        
        .quiz-timer {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .quiz-timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #a29bfe);
            border-radius: 2px;
            transition: width 0.1s linear;
        }
        
        .quiz-timer-bar.warning {
            background: linear-gradient(90deg, #feca57, #ff9f43);
        }
        
        .quiz-timer-bar.danger {
            background: linear-gradient(90deg, #ff6b6b, #ee5a5a);
        }
        
        .quiz-type-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 20px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #00d4ff;
            margin-bottom: 12px;
        }

        .quiz-question {
            font-size: 18px;
            margin-bottom: 20px;
            line-height: 1.6;
            min-height: 50px;
        }
        
        .quiz-hint {
            font-size: 12px;
            color: rgba(255,255,255,0.4);
            font-style: italic;
            margin-bottom: 15px;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quiz-options.single-column {
            grid-template-columns: 1fr;
        }

        .quiz-option {
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.3);
        }

        .quiz-option.correct {
            background: rgba(29, 209, 161, 0.2);
            border-color: #1dd1a1;
        }

        .quiz-option.wrong {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
        }

        .quiz-score {
            font-size: 14px;
            opacity: 0.6;
            margin-bottom: 15px;
        }

        .quiz-streak {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.2), rgba(255, 69, 0, 0.2));
            border-radius: 20px;
            font-size: 12px;
            color: #ffa500;
        }
        
        .quiz-footer {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .quiz-input {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 18px;
            text-align: center;
            outline: none;
            transition: all 0.2s;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        
        .quiz-input:focus {
            border-color: rgba(0, 212, 255, 0.5);
            background: rgba(0, 212, 255, 0.05);
        }
        
        .quiz-input.correct {
            border-color: #1dd1a1;
            background: rgba(29, 209, 161, 0.1);
        }
        
        .quiz-input.wrong {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        /* Temperature Slider Panel */
        #temp-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(10, 10, 30, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 15px 20px;
            z-index: 100;
            border: 1px solid rgba(0, 212, 255, 0.2);
            min-width: 200px;
        }

        #temp-panel h4 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(0, 212, 255, 0.8);
            margin-bottom: 10px;
        }

        #temp-slider {
            width: 100%;
            margin: 10px 0;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #00d4ff, #ff6b6b);
            height: 6px;
            border-radius: 3px;
            outline: none;
        }

        #temp-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        #temp-value {
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            color: #00d4ff;
        }

        #temp-value span {
            font-size: 14px;
            opacity: 0.6;
        }

        .state-legend {
            display: flex;
            justify-content: space-around;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .state-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            opacity: 0.7;
        }

        .state-icon {
            font-size: 14px;
        }

        /* Keyboard shortcuts panel */
        #shortcuts-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(8, 8, 30, 0.97), rgba(12, 12, 45, 0.97));
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 18px 22px;
            z-index: 100;
            border: 1px solid rgba(0, 212, 255, 0.2);
            font-size: 11px;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.5),
                0 0 20px rgba(0, 212, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.03);
        }

        #shortcuts-panel h4 {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #00d4ff, #a29bfe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.15);
            text-align: center;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            padding: 6px 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .shortcut-item:hover {
            background: rgba(0, 212, 255, 0.08);
        }

        .shortcut-key {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.25), rgba(138, 43, 226, 0.2));
            padding: 4px 10px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-weight: 600;
            color: #00d4ff;
            min-width: 28px;
            text-align: center;
            font-size: 11px;
            border: 1px solid rgba(0, 212, 255, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
        }

        .shortcut-desc {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
        }

        /* Comparison Panel */
        #comparison-panel {
            display: none;
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(10, 10, 30, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 20px;
            z-index: 150;
            border: 1px solid rgba(0, 212, 255, 0.3);
            width: 320px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }

        #comparison-panel.visible {
            display: block;
        }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            cursor: move;
            padding: 10px;
            margin: -20px -20px 15px -20px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 24px 24px 0 0;
        }

        .comparison-header h3 {
            font-size: 16px;
            color: #00d4ff;
        }

        .comparison-close {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .comparison-element {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
        }

        .comparison-element-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .comparison-symbol-box {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .comparison-symbol {
            font-size: 24px;
            font-weight: 700;
        }

        .comparison-name {
            font-size: 18px;
            font-weight: 600;
        }

        .comparison-props {
            display: grid;
            gap: 8px;
        }

        .comparison-prop {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }

        .comparison-prop-label {
            opacity: 0.6;
            font-size: 12px;
        }

        .comparison-prop-value {
            font-weight: 500;
        }

        .comparison-prop-value.higher {
            color: #1dd1a1;
        }

        .comparison-prop-value.lower {
            color: #ff6b6b;
        }

        /* Wikipedia link */
        .wiki-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            padding: 8px 14px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 20px;
            color: #00d4ff;
            text-decoration: none;
            font-size: 12px;
            transition: all 0.2s;
            pointer-events: auto;
        }

        .wiki-link:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: scale(1.05);
        }

        /* Zoom overlay */
        #zoom-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2500;
            align-items: center;
            justify-content: center;
        }

        #zoom-overlay.visible {
            display: flex;
        }

        #zoom-content {
            background: rgba(10, 10, 30, 0.98);
            border-radius: 24px;
            padding: 40px;
            padding-top: 180px;
            border: 2px solid rgba(0, 212, 255, 0.4);
            text-align: center;
            max-width: 500px;
            position: relative;
            overflow: hidden;
        }
        
        /* Electron Orbital Animation - positioned at top of panel behind symbol */
        #electron-orbital-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            pointer-events: none;
            z-index: 1;
        }
        
        #zoom-symbol {
            position: relative;
            z-index: 2;
        }
        
        .orbital-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 1px solid rgba(0, 212, 255, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: orbital-pulse 3s ease-in-out infinite;
        }
        
        .orbital-ring:nth-child(odd) {
            animation-delay: 0.5s;
        }
        
        @keyframes orbital-pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.7; }
        }
        
        .orbiting-electron {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle at 30% 30%, #fff, #00d4ff);
            border-radius: 50%;
            box-shadow: 0 0 6px #00d4ff, 0 0 12px rgba(0, 212, 255, 0.6);
            transform-origin: center center;
            z-index: 10;
        }
        
        .nucleus-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 50%;
            animation: nucleus-pulse 2s ease-in-out infinite;
            z-index: 5;
        }
        
        @keyframes nucleus-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
        }
        
        /* Dim the 3D scene when zoom is active */
        #scene-container.dimmed {
            opacity: 0.15;
            transition: opacity 0.3s ease;
        }

        #zoom-symbol {
            font-size: 120px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        #zoom-name {
            font-size: 32px;
            margin-bottom: 5px;
        }

        #zoom-number {
            font-size: 18px;
            opacity: 0.6;
            margin-bottom: 20px;
        }

        #zoom-close {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 10px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 20px;
        }

        /* Sound toggle */
        #sound-toggle {
            position: fixed;
            top: 80px;
            right: 250px;
            background: rgba(10, 10, 30, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 8px 16px;
            z-index: 100;
            border: 1px solid rgba(0, 212, 255, 0.2);
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
        }

        #sound-toggle:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        #sound-toggle .icon {
            font-size: 16px;
        }

        /* State badges in tooltip */
        .state-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            margin-left: 10px;
        }

        .state-solid {
            background: rgba(139, 69, 19, 0.3);
            color: #d4a574;
        }

        .state-liquid {
            background: rgba(0, 150, 255, 0.3);
            color: #6db3f2;
        }

        .state-gas {
            background: rgba(150, 255, 150, 0.3);
            color: #90ee90;
        }

        .state-unknown {
            background: rgba(150, 150, 150, 0.3);
            color: #aaa;
        }

        /* Help Modal */
        #help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 5000;
            align-items: center;
            justify-content: center;
        }

        #help-modal.visible {
            display: flex;
        }

        #help-content {
            background: rgba(10, 10, 30, 0.98);
            border-radius: 24px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        #help-content h2 {
            color: #00d4ff;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .help-section {
            margin-bottom: 20px;
        }

        .help-section h3 {
            font-size: 14px;
            color: #a29bfe;
            margin-bottom: 10px;
        }

        .help-section p, .help-section li {
            font-size: 13px;
            opacity: 0.8;
            line-height: 1.6;
        }

        .help-section ul {
            padding-left: 20px;
        }

        #help-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #fff;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #help-btn:hover {
            background: rgba(0, 212, 255, 0.4);
        }

        /* WebGL Fallback */
        #webgl-error {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 100, 100, 0.1);
            border: 1px solid rgba(255, 100, 100, 0.3);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 6000;
        }

        #webgl-error h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
        }

        /* Footer */
        #footer {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            opacity: 0.3;
            z-index: 50;
            text-align: center;
        }

        #footer a {
            color: #00d4ff;
            text-decoration: none;
        }

        /* ============================================ */
        /* REACTION LAB MODE                           */
        /* ============================================ */
        #reaction-lab {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, 
                rgba(5, 8, 25, 0.99) 0%,
                rgba(10, 15, 35, 0.99) 50%,
                rgba(5, 10, 30, 0.99) 100%);
            z-index: 5000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(15px);
        }

        #reaction-lab.visible {
            display: flex;
            animation: labFadeIn 0.5s ease-out;
        }

        @keyframes labFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Lab Background Effects */
        .lab-bg-glow {
            position: absolute;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.08) 0%, transparent 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            animation: labBgPulse 4s ease-in-out infinite;
        }

        @keyframes labBgPulse {
            0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); }
        }

        .lab-header {
            position: absolute;
            top: 25px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .lab-header h2 {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #00ff88, #00d4ff, #a29bfe, #ff6b9d);
            background-size: 300% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 0 0 40px rgba(0, 212, 255, 0.5);
            animation: labTitleShimmer 4s ease infinite;
        }

        @keyframes labTitleShimmer {
            0%, 100% { background-position: 0% center; }
            50% { background-position: 100% center; }
        }

        .lab-close {
            position: absolute;
            right: 30px;
            top: 25px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 80, 80, 0.2), rgba(255, 50, 50, 0.1));
            border: 2px solid rgba(255, 100, 100, 0.4);
            color: #ff6464;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lab-close:hover {
            background: linear-gradient(135deg, rgba(255, 80, 80, 0.4), rgba(255, 50, 50, 0.3));
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 0 20px rgba(255, 100, 100, 0.4);
        }

        .lab-container {
            display: flex;
            gap: 60px;
            align-items: center;
            margin-top: 40px;
        }

        /* Realistic Beaker */
        .beaker-container {
            position: relative;
            width: 320px;
            height: 480px;
            overflow: visible;
        }

        /* Lab Table Surface */
        .lab-table {
            position: absolute;
            bottom: 0;
            left: -40px;
            right: -40px;
            height: 20px;
            background: linear-gradient(180deg, 
                rgba(60, 60, 80, 0.8) 0%,
                rgba(40, 40, 60, 0.9) 50%,
                rgba(30, 30, 50, 1) 100%);
            border-radius: 4px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .beaker {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 280px;
            background: linear-gradient(90deg,
                rgba(200, 220, 255, 0.03) 0%,
                rgba(255, 255, 255, 0.08) 20%,
                rgba(255, 255, 255, 0.12) 50%,
                rgba(255, 255, 255, 0.08) 80%,
                rgba(200, 220, 255, 0.03) 100%);
            border: 2px solid rgba(255, 255, 255, 0.25);
            border-top: none;
            border-radius: 0 0 25px 25px;
            overflow: hidden;
            box-shadow: 
                inset -20px 0 40px rgba(255, 255, 255, 0.05),
                inset 20px 0 40px rgba(0, 0, 0, 0.1),
                0 20px 60px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        /* Glass Reflection */
        .beaker::before {
            content: '';
            position: absolute;
            top: 0;
            left: 8px;
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0.1) 50%,
                rgba(255, 255, 255, 0.2) 100%);
            border-radius: 2px;
        }

        /* Beaker Lip/Rim */
        .beaker::after {
            content: '';
            position: absolute;
            top: -12px;
            left: -12px;
            right: -12px;
            height: 15px;
            background: linear-gradient(180deg,
                rgba(255, 255, 255, 0.15) 0%,
                rgba(255, 255, 255, 0.08) 100%);
            border: 2px solid rgba(255, 255, 255, 0.25);
            border-bottom: none;
            border-radius: 8px 8px 0 0;
        }

        /* Measurement Lines */
        .beaker-measurements {
            position: absolute;
            right: 10px;
            top: 20px;
            bottom: 30px;
            width: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            pointer-events: none;
        }

        .measurement-line {
            width: 15px;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        .measurement-line::after {
            content: attr(data-ml);
            position: absolute;
            right: 20px;
            font-size: 8px;
            color: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%);
        }

        /* Realistic Liquid */
        .beaker-liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 55%;
            background: linear-gradient(180deg, 
                rgba(0, 180, 255, 0.3) 0%,
                rgba(0, 140, 220, 0.5) 30%,
                rgba(0, 100, 200, 0.7) 100%);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: visible;
            border-radius: 0 0 23px 23px;
        }

        /* Liquid Surface Reflection */
        .beaker-liquid::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(180deg,
                rgba(255, 255, 255, 0.4) 0%,
                rgba(255, 255, 255, 0.1) 100%);
            border-radius: 50%;
            transform: scaleY(0.3);
        }

        /* Liquid Wave Animation */
        .beaker-liquid::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -10%;
            width: 120%;
            height: 15px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 10'%3E%3Cpath d='M0 5 Q 25 0, 50 5 T 100 5 L 100 10 L 0 10 Z' fill='rgba(255,255,255,0.1)'/%3E%3C/svg%3E");
            background-size: 50px 100%;
            animation: liquidWave 3s linear infinite;
        }

        @keyframes liquidWave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50px); }
        }

        .beaker-liquid.reacting {
            animation: liquidBoil 0.15s ease-in-out infinite;
        }

        @keyframes liquidBoil {
            0%, 100% { transform: translateY(0) scaleX(1); }
            25% { transform: translateY(-3px) scaleX(1.01); }
            50% { transform: translateY(-1px) scaleX(0.99); }
            75% { transform: translateY(-4px) scaleX(1.02); }
        }

        /* Realistic Bubbles */
        .bubble {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 255, 255, 0.9) 0%,
                rgba(255, 255, 255, 0.4) 30%,
                rgba(255, 255, 255, 0.1) 60%,
                transparent 100%);
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                inset -2px -2px 4px rgba(255, 255, 255, 0.2),
                0 0 3px rgba(255, 255, 255, 0.1);
            animation: bubbleFloat var(--duration, 2s) ease-out forwards;
        }

        @keyframes bubbleFloat {
            0% { 
                transform: translateY(0) scale(1) rotate(0deg); 
                opacity: 0.9; 
            }
            50% {
                transform: translateY(calc(var(--rise, -150px) * 0.5)) scale(1.1) rotate(180deg);
                opacity: 0.7;
            }
            100% { 
                transform: translateY(var(--rise, -150px)) scale(0.6) rotate(360deg); 
                opacity: 0; 
            }
        }

        /* Realistic Fire */
        .fire-container {
            position: absolute;
            bottom: 85%;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 150px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s ease;
            filter: blur(0.5px);
        }

        .fire-container.active {
            opacity: 1;
        }

        .flame {
            position: absolute;
            bottom: 0;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            filter: blur(2px);
            mix-blend-mode: screen;
        }

        .flame-core {
            animation: flameDance 0.08s ease-in-out infinite alternate;
        }

        .flame-mid {
            animation: flameDance 0.1s ease-in-out infinite alternate-reverse;
        }

        .flame-outer {
            animation: flameDance 0.12s ease-in-out infinite alternate;
        }

        @keyframes flameDance {
            0% { 
                transform: scaleY(1) scaleX(1) translateY(0); 
                filter: blur(2px);
            }
            100% { 
                transform: scaleY(1.15) scaleX(0.9) translateY(-5px); 
                filter: blur(3px);
            }
        }

        /* Ember Particles */
        .ember {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #ffdd44;
            border-radius: 50%;
            box-shadow: 0 0 6px #ff8800, 0 0 12px #ff4400;
            animation: emberFloat var(--duration, 1s) ease-out forwards;
        }

        @keyframes emberFloat {
            0% { 
                transform: translate(0, 0) scale(1); 
                opacity: 1; 
            }
            100% { 
                transform: translate(var(--tx, 0), var(--ty, -100px)) scale(0); 
                opacity: 0; 
            }
        }

        /* Epic Explosion */
        .explosion {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .explosion-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            border: 3px solid;
            box-shadow: 0 0 20px currentColor, inset 0 0 20px currentColor;
            animation: explodeRingNew 0.6s cubic-bezier(0.2, 0.8, 0.3, 1) forwards;
        }

        @keyframes explodeRingNew {
            0% { width: 0; height: 0; opacity: 1; border-width: 8px; }
            100% { width: 350px; height: 350px; opacity: 0; border-width: 1px; }
        }

        .explosion-flash {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border-radius: 50%;
            animation: explosionFlash 0.3s ease-out forwards;
        }

        @keyframes explosionFlash {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }

        .explosion-particle {
            position: absolute;
            border-radius: 50%;
            animation: explodeParticleNew var(--duration, 0.8s) cubic-bezier(0.2, 0.8, 0.3, 1) forwards;
        }

        @keyframes explodeParticleNew {
            0% { 
                transform: translate(0, 0) scale(1) rotate(0deg); 
                opacity: 1; 
            }
            100% { 
                transform: translate(var(--tx), var(--ty)) scale(0) rotate(720deg); 
                opacity: 0; 
            }
        }

        .debris {
            position: absolute;
            background: linear-gradient(45deg, #888, #444);
            animation: debrisFly var(--duration, 1s) cubic-bezier(0.1, 0.8, 0.2, 1) forwards;
        }

        @keyframes debrisFly {
            0% { 
                transform: translate(0, 0) rotate(0deg); 
                opacity: 1; 
            }
            100% { 
                transform: translate(var(--tx), var(--ty)) rotate(var(--rot, 720deg)); 
                opacity: 0; 
            }
        }

        /* Realistic Smoke */
        .smoke {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 40% 40%, 
                rgba(150, 150, 150, 0.5) 0%,
                rgba(100, 100, 100, 0.3) 40%,
                rgba(80, 80, 80, 0.1) 70%,
                transparent 100%);
            filter: blur(8px);
            animation: smokeRiseNew var(--duration, 3s) ease-out forwards;
            pointer-events: none;
        }

        @keyframes smokeRiseNew {
            0% { 
                transform: translateY(0) scale(0.5) rotate(0deg); 
                opacity: 0.6; 
            }
            50% {
                transform: translateY(-100px) scale(1.5) rotate(45deg);
                opacity: 0.4;
            }
            100% { 
                transform: translateY(-250px) scale(3) rotate(90deg); 
                opacity: 0; 
            }
        }

        /* Sparks with Trails */
        .spark {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 
                0 0 4px #fff,
                0 0 8px #ffaa00, 
                0 0 16px #ff6600,
                0 0 24px #ff4400;
            animation: sparkFlyNew var(--duration, 0.8s) cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
        }

        .spark::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 100%;
            width: 20px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ffaa00);
            transform: translateY(-50%);
            opacity: 0.6;
        }

        @keyframes sparkFlyNew {
            0% { 
                transform: translate(0, 0) scale(1); 
                opacity: 1; 
            }
            70% {
                opacity: 1;
            }
            100% { 
                transform: translate(var(--tx), var(--ty)) scale(0.3); 
                opacity: 0; 
            }
        }

        /* Steam Wisps */
        .steam {
            position: absolute;
            width: 30px;
            height: 60px;
            background: linear-gradient(180deg,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 100%);
            border-radius: 50%;
            filter: blur(8px);
            animation: steamRise var(--duration, 2s) ease-out forwards;
        }

        @keyframes steamRise {
            0% { 
                transform: translateY(0) scaleX(1) rotate(0deg); 
                opacity: 0.5; 
            }
            100% { 
                transform: translateY(-150px) scaleX(2) rotate(var(--rot, 30deg)); 
                opacity: 0; 
            }
        }

        /* Dripping Effect */
        .drip {
            position: absolute;
            width: 6px;
            height: 10px;
            border-radius: 50% 50% 50% 50% / 30% 30% 70% 70%;
            animation: dripFall var(--duration, 1s) ease-in forwards;
        }

        @keyframes dripFall {
            0% { transform: translateY(0); opacity: 0.8; }
            80% { opacity: 0.8; }
            100% { transform: translateY(100px); opacity: 0; }
        }

        /* Recipe Book Panel */
        .recipe-book {
            background: linear-gradient(135deg, 
                rgba(20, 15, 35, 0.98) 0%,
                rgba(15, 10, 30, 0.98) 100%);
            border: 1px solid rgba(255, 200, 100, 0.3);
            border-radius: 16px;
            padding: 20px;
            width: 280px;
            max-height: 520px;
            overflow-y: auto;
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 220, 150, 0.1),
                0 0 30px rgba(255, 180, 100, 0.1);
            position: relative;
        }
        
        .recipe-book::before {
            content: '';
            position: absolute;
            top: 0;
            left: 20px;
            right: 20px;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255, 200, 100, 0.4), transparent);
            border-radius: 0 0 50% 50%;
        }
        
        .recipe-book h3 {
            font-size: 14px;
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .recipe-book h3::before,
        .recipe-book h3::after {
            content: '';
            font-size: 10px;
            opacity: 0.6;
        }
        
        .recipe-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .recipe-item {
            background: linear-gradient(135deg, 
                rgba(40, 35, 60, 0.6) 0%,
                rgba(30, 25, 50, 0.8) 100%);
            border: 1px solid rgba(255, 200, 100, 0.15);
            border-radius: 10px;
            padding: 10px 12px;
            cursor: pointer;
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
        }
        
        .recipe-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 200, 100, 0.1), transparent);
            transition: left 0.4s ease;
        }
        
        .recipe-item:hover::before {
            left: 100%;
        }
        
        .recipe-item:hover {
            border-color: rgba(255, 200, 100, 0.4);
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(255, 180, 100, 0.15);
        }
        
        .recipe-item.extreme {
            border-left: 3px solid #ff4444;
        }
        
        .recipe-item.high {
            border-left: 3px solid #ff8800;
        }
        
        .recipe-item.medium {
            border-left: 3px solid #ffcc00;
        }
        
        .recipe-item.low {
            border-left: 3px solid #44aa44;
        }
        
        .recipe-name {
            font-size: 12px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .recipe-intensity {
            font-size: 8px;
            padding: 2px 6px;
            border-radius: 10px;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .recipe-intensity.extreme {
            background: rgba(255, 68, 68, 0.3);
            color: #ff6666;
        }
        
        .recipe-intensity.high {
            background: rgba(255, 136, 0, 0.3);
            color: #ffaa44;
        }
        
        .recipe-intensity.medium {
            background: rgba(255, 204, 0, 0.3);
            color: #ffdd44;
        }
        
        .recipe-intensity.low {
            background: rgba(68, 170, 68, 0.3);
            color: #66cc66;
        }
        
        .recipe-elements {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            font-family: 'Courier New', monospace;
        }
        
        .recipe-equation {
            font-size: 10px;
            color: rgba(0, 212, 255, 0.7);
            margin-top: 4px;
            font-family: 'Times New Roman', serif;
        }
        
        .recipe-book::-webkit-scrollbar {
            width: 6px;
        }
        
        .recipe-book::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }
        
        .recipe-book::-webkit-scrollbar-thumb {
            background: rgba(255, 200, 100, 0.3);
            border-radius: 3px;
        }
        
        .recipe-book::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 200, 100, 0.5);
        }

        /* Element Tray - Enhanced */
        .element-tray {
            background: linear-gradient(135deg, 
                rgba(15, 20, 50, 0.95) 0%,
                rgba(10, 15, 40, 0.98) 100%);
            border: 1px solid rgba(0, 212, 255, 0.25);
            border-radius: 20px;
            padding: 25px;
            max-width: 420px;
            max-height: 520px;
            overflow-y: auto;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .element-tray h3 {
            font-size: 13px;
            color: #00d4ff;
            margin-bottom: 18px;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .element-tray h3::before {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.5), transparent);
        }

        .element-tray h3::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.5));
        }

        .tray-elements {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .tray-element {
            width: 55px;
            height: 55px;
            background: linear-gradient(145deg, 
                rgba(40, 45, 80, 0.9) 0%,
                rgba(25, 30, 55, 0.95) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .tray-element::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), transparent);
            pointer-events: none;
        }

        .tray-element:hover {
            transform: scale(1.15) translateY(-3px);
            border-color: var(--element-color, rgba(0, 212, 255, 0.6));
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                0 0 20px var(--element-glow, rgba(0, 212, 255, 0.3));
        }

        .tray-element:active {
            transform: scale(1.05);
        }

        .tray-element .symbol {
            font-size: 18px;
            font-weight: 700;
        }

        .tray-element .number {
            font-size: 9px;
            opacity: 0.4;
            margin-top: 2px;
        }

        /* Beaker Elements - Floating Pills */
        .beaker-element {
            position: absolute;
            width: 45px;
            height: 45px;
            background: linear-gradient(145deg, 
                rgba(255, 255, 255, 0.15) 0%,
                rgba(255, 255, 255, 0.05) 100%);
            border: 2px solid;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 15px;
            animation: elementSplash 0.8s cubic-bezier(0.2, 0.8, 0.3, 1) forwards;
            cursor: pointer;
            backdrop-filter: blur(4px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        @keyframes elementSplash {
            0% { 
                transform: translateY(-150px) rotate(0deg) scale(0.5); 
                opacity: 0; 
            }
            40% { 
                transform: translateY(30px) rotate(270deg) scale(1.1); 
            }
            60% {
                transform: translateY(-10px) rotate(330deg) scale(0.95);
            }
            80% {
                transform: translateY(5px) rotate(350deg) scale(1.02);
            }
            100% { 
                transform: translateY(0) rotate(360deg) scale(1); 
                opacity: 1; 
            }
        }

        .beaker-element::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 8px;
            animation: elementBob 2s ease-in-out infinite;
        }

        @keyframes elementBob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .beaker-element:hover {
            transform: scale(1.15);
            box-shadow: 0 0 20px currentColor;
        }

        /* Splash Effect */
        .splash {
            position: absolute;
            pointer-events: none;
        }

        .splash-drop {
            position: absolute;
            border-radius: 50%;
            animation: splashDrop 0.5s ease-out forwards;
        }

        @keyframes splashDrop {
            0% { transform: translate(0, 0) scale(1); opacity: 0.8; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* Reaction Info - Glass Card */
        .reaction-info {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, 
                rgba(15, 20, 45, 0.95) 0%,
                rgba(10, 15, 35, 0.98) 100%);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 16px;
            padding: 20px 35px;
            text-align: center;
            min-width: 350px;
            opacity: 0;
            pointer-events: none;
            transform: translateX(-50%) translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(0, 255, 136, 0.1);
            z-index: 200;
        }

        .reaction-info.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }
        
        .reaction-info-close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(255, 100, 100, 0.3);
            color: #ff6666;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .reaction-info-close:hover {
            background: rgba(255, 100, 100, 0.6);
            color: #fff;
            transform: scale(1.1);
        }

        .reaction-info h4 {
            color: #00ff88;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .reaction-info p {
            color: rgba(255, 255, 255, 0.75);
            font-size: 14px;
            line-height: 1.5;
        }

        .reaction-equation {
            font-family: 'Times New Roman', Georgia, serif;
            font-size: 18px;
            color: #00d4ff;
            margin-top: 12px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            border: 1px solid rgba(0, 212, 255, 0.2);
            letter-spacing: 1px;
        }

        /* Clear Beaker Button */
        .clear-beaker-btn {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 30px;
            background: linear-gradient(135deg, rgba(255, 80, 80, 0.15), rgba(255, 50, 50, 0.1));
            border: 1px solid rgba(255, 100, 100, 0.35);
            border-radius: 25px;
            color: #ff7070;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            pointer-events: auto;
        }

        .clear-beaker-btn:hover {
            background: linear-gradient(135deg, rgba(255, 80, 80, 0.3), rgba(255, 50, 50, 0.2));
            box-shadow: 0 0 20px rgba(255, 100, 100, 0.3);
            transform: translateX(-50%) scale(1.05);
        }

        /* Glow Overlay for Reactions */
        .reaction-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 0 0 23px 23px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .reaction-glow.active {
            animation: reactionGlowPulse 0.5s ease-in-out infinite;
        }

        @keyframes reactionGlowPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        /* ============================================ */
        /* REALISTIC DAMAGE EFFECTS                    */
        /* ============================================ */
        
        /* Cracked beaker state */
        .beaker.cracked {
            filter: brightness(1.1);
        }
        
        .beaker.cracked::before {
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.3) 0%, 
                rgba(255,255,255,0.15) 25%, 
                transparent 50%,
                rgba(255,255,255,0.1) 100%) !important;
        }
        
        .beaker.shattered {
            filter: brightness(0.8) saturate(0.7);
        }
        
        .beaker.shattered::after {
            opacity: 0.3;
        }
        
        /* Crack appearance animation */
        @keyframes crackAppear {
            0% { 
                opacity: 0; 
                transform: rotate(var(--angle, 0deg)) scaleX(0); 
            }
            100% { 
                opacity: 1; 
                transform: rotate(var(--angle, 0deg)) scaleX(1); 
            }
        }
        
        /* Glass shard flying animation */
        @keyframes shardFly {
            0% { 
                transform: translate(-50%, -50%) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) rotate(var(--rot)) scale(0.3);
                opacity: 0;
            }
        }
        
        /* Large splash droplets */
        @keyframes dropletFly {
            0% { 
                transform: translate(-50%, 0) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translate(calc(-50% + var(--tx)), var(--ty)) scale(0.5);
                opacity: 0;
            }
        }
        
        /* Spreading fire container */
        .spreading-fire {
            filter: blur(1px);
        }
        
        /* Smoke cloud rising */
        @keyframes smokeCloudRise {
            0% { 
                transform: translateY(0) scale(1);
                opacity: 0.6;
            }
            100% { 
                transform: translateY(-150px) scale(2);
                opacity: 0;
            }
        }
        
        /* Leak growing down */
        @keyframes leakGrow {
            0% { 
                height: 0;
            }
            100% { 
                height: 80px;
            }
        }
        
        /* Puddle growing */
        @keyframes puddleGrow {
            0% { 
                width: 0;
                height: 0;
            }
            100% { 
                width: 120px;
                height: 30px;
            }
        }
        
        /* Recipe highlight animation */
        @keyframes recipeHighlight {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(255, 200, 100, 0.3), inset 0 0 8px rgba(255, 200, 100, 0.1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(255, 200, 100, 0.8), inset 0 0 20px rgba(255, 200, 100, 0.3);
                transform: scale(1.05);
            }
        }

        /* ============================================ */
        /* MOBILE RESPONSIVE STYLES                    */
        /* ============================================ */
        @media (max-width: 1200px) {
            #shortcuts-panel {
                display: none;
            }
            
            #temp-panel {
                right: 10px;
                min-width: 180px;
            }
            
            #sound-toggle {
                right: 200px;
            }
        }

        @media (max-width: 900px) {
            #category-filter {
                display: none;
            }
            
            #top-bar h1 {
                font-size: 18px;
            }
            
            #top-bar h1 span:last-child {
                display: none;
            }
            
            #controls-container {
                gap: 5px;
            }
            
            #controls-container .btn {
                padding: 8px 12px;
                font-size: 11px;
            }
            
            #controls-container .btn span {
                display: none;
            }
            
            #instructions {
                display: none;
            }
        }

        @media (max-width: 700px) {
            #top-bar {
                flex-direction: column;
                gap: 10px;
                padding: 10px 15px;
            }
            
            #search-container {
                width: 100%;
            }
            
            #search {
                width: 100%;
            }
            
            #controls-container {
                width: 100%;
                justify-content: center;
            }
            
            #combination-panel {
                min-width: auto;
                width: calc(100% - 20px);
                padding: 15px;
            }
            
            #temp-panel {
                top: auto;
                bottom: 80px;
                right: 10px;
                left: 10px;
                width: auto;
            }
            
            #sound-toggle {
                top: auto;
                bottom: 150px;
                right: 10px;
            }
            
            #combiner-toggle {
                font-size: 12px;
                padding: 10px 16px;
            }
            
            .tooltip-content {
                max-width: 280px;
            }
            
            #comparison-panel {
                width: calc(100% - 20px);
                left: 10px;
                right: 10px;
            }
            
            #help-btn {
                bottom: 70px;
            }
        }

        @media (max-width: 500px) {
            #controls-container .btn {
                padding: 6px 10px;
            }
            
            #top-bar h1 {
                font-size: 16px;
            }
            
            #zoom-content {
                padding: 20px;
                margin: 10px;
            }
            
            #zoom-symbol {
                font-size: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- Scientific Background -->
    <div id="science-bg">
        <div class="grid-lines"></div>
    </div>
    
    <!-- Visual Effects Layer -->
    <div class="scan-lines"></div>
    <div class="scan-beam"></div>
    <div class="vignette"></div>
    <div id="screen-flash"></div>
    <div class="cursor-glow" id="cursor-glow"></div>

    <div id="loading">
        <div class="loader-phase-1">
            <div class="loader">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-nucleus"></div>
            </div>
            <p>Initializing Elementum...</p>
            <div id="loading-facts"></div>
        </div>
        
        <div id="elementum-reveal">
            <div class="element-letter" style="border-color: #00d4ff; --glow-color: rgba(0, 212, 255, 0.5);">
                <span class="symbol" style="color: #00d4ff;">E</span>
            </div>
            <div class="element-letter" style="border-color: #a29bfe; --glow-color: rgba(162, 155, 254, 0.5);">
                <span class="symbol" style="color: #a29bfe;">L</span>
            </div>
            <div class="element-letter" style="border-color: #00d4ff; --glow-color: rgba(0, 212, 255, 0.5);">
                <span class="symbol" style="color: #00d4ff;">E</span>
            </div>
            <div class="element-letter" style="border-color: #1dd1a1; --glow-color: rgba(29, 209, 161, 0.5);">
                <span class="symbol" style="color: #1dd1a1;">M</span>
            </div>
            <div class="element-letter" style="border-color: #00d4ff; --glow-color: rgba(0, 212, 255, 0.5);">
                <span class="symbol" style="color: #00d4ff;">E</span>
            </div>
            <div class="element-letter" style="border-color: #feca57; --glow-color: rgba(254, 202, 87, 0.5);">
                <span class="symbol" style="color: #feca57;">N</span>
            </div>
            <div class="element-letter" style="border-color: #54a0ff; --glow-color: rgba(84, 160, 255, 0.5);">
                <span class="symbol" style="color: #54a0ff;">T</span>
            </div>
            <div class="element-letter" style="border-color: #ff6b6b; --glow-color: rgba(255, 107, 107, 0.5);">
                <span class="symbol" style="color: #ff6b6b;">U</span>
            </div>
            <div class="element-letter" style="border-color: #a29bfe; --glow-color: rgba(162, 155, 254, 0.5);">
                <span class="symbol" style="color: #a29bfe;">M</span>
            </div>
        </div>
        <div id="loading-subtitle">Interactive Periodic Explorer</div>
    </div>

    <!-- Discovery Counter -->
    <div id="discovery-panel">
        <h4> Discoveries</h4>
        <div class="discovery-count" id="discovery-count">0</div>
        <div class="discovery-total">of <span id="total-compounds">300+</span> compounds</div>
        <div class="discovery-bar">
            <div class="discovery-progress" id="discovery-progress" style="width: 0%;"></div>
        </div>
        <div class="discovery-recent" id="discovery-recent">Discover your first compound!</div>
    </div>

    <!-- Quiz Mode Panel -->
    <div id="quiz-panel">
        <h3> Element Quiz</h3>
        
        <div class="quiz-difficulty-selector" id="quiz-difficulty-selector">
            <button class="difficulty-btn beginner active" data-difficulty="beginner"> Beginner</button>
            <button class="difficulty-btn amateur" data-difficulty="amateur"> Amateur</button>
            <button class="difficulty-btn master" data-difficulty="master"> Master</button>
        </div>
        
        <div class="quiz-stats">
            <div class="quiz-stat">
                <span class="quiz-stat-label">Score</span>
                <span class="quiz-stat-value" id="quiz-score">0</span>
            </div>
            <div class="quiz-stat">
                <span class="quiz-stat-label">Streak</span>
                <span class="quiz-stat-value" id="streak-count" style="color: #ffa500;">0</span>
            </div>
            <div class="quiz-stat">
                <span class="quiz-stat-label">Best</span>
                <span class="quiz-stat-value" id="quiz-best">0</span>
            </div>
        </div>
        
        <div class="quiz-timer" id="quiz-timer">
            <div class="quiz-timer-bar" id="quiz-timer-bar" style="width: 100%;"></div>
        </div>
        
        <div class="quiz-type-badge" id="quiz-type-badge">Multiple Choice</div>
        <div class="quiz-question" id="quiz-question">Select a difficulty to begin!</div>
        <div class="quiz-hint" id="quiz-hint"></div>
        <div class="quiz-options" id="quiz-options"></div>
        
        <div class="quiz-footer">
            <button class="btn" onclick="skipQuestion()" id="btn-skip"> Skip</button>
            <button class="btn" onclick="closeQuiz()"> Close</button>
        </div>
    </div>

    <div id="scene-container"></div>

    <div id="top-bar">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="width: 38px; height: 38px; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(162, 155, 254, 0.2)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 1px solid rgba(0, 212, 255, 0.2);"></div>
            <div style="display: flex; flex-direction: column;">
                <h1>Elementum</h1>
                <span style="font-size: 11px; color: rgba(255,255,255,0.4); margin-top: -2px; letter-spacing: 0.5px;">Interactive Periodic Explorer  By Zeretsu</span>
            </div>
        </div>
        <div id="search-container">
            <span class="search-icon"></span>
            <input type="text" id="search" placeholder="Search elements... ">
        </div>
        <div id="controls-container">
            <button class="btn" id="btn-rotate">
                <span></span> Auto Rotate
            </button>
            <button class="btn" id="btn-reset">
                <span></span> Reset View
            </button>
            <button class="btn" id="btn-flat">
                <span></span> Flat View
            </button>
            <button class="btn" id="btn-3d">
                <span></span> 3D View
            </button>
            <button class="btn" id="btn-lab" style="background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 212, 255, 0.2)); border-color: rgba(0, 255, 136, 0.4);">
                <span></span> Reaction Lab
            </button>
            <button class="btn" id="btn-quiz" style="background: linear-gradient(135deg, rgba(255, 165, 0, 0.2), rgba(255, 69, 0, 0.2)); border-color: rgba(255, 165, 0, 0.4);">
                <span></span> Quiz
            </button>
            <button class="btn" id="btn-fullscreen" style="background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2)); border-color: rgba(138, 43, 226, 0.4);">
                <span></span> Fullscreen
            </button>
        </div>
    </div>

    <div id="category-filter">
        <h3>Categories</h3>
        <div class="category-item active" data-category="all">
            <div class="category-color" style="background: linear-gradient(135deg, #ff6b6b, #a29bfe);"></div>
            <span class="category-name">All Elements</span>
        </div>
        <div class="category-item" data-category="alkali">
            <div class="category-color" style="background: #ff6b6b;"></div>
            <span class="category-name">Alkali Metals</span>
        </div>
        <div class="category-item" data-category="alkaline">
            <div class="category-color" style="background: #feca57;"></div>
            <span class="category-name">Alkaline Earth</span>
        </div>
        <div class="category-item" data-category="transition">
            <div class="category-color" style="background: #54a0ff;"></div>
            <span class="category-name">Transition Metals</span>
        </div>
        <div class="category-item" data-category="post-transition">
            <div class="category-color" style="background: #5f27cd;"></div>
            <span class="category-name">Post-Transition</span>
        </div>
        <div class="category-item" data-category="metalloid">
            <div class="category-color" style="background: #00d2d3;"></div>
            <span class="category-name">Metalloids</span>
        </div>
        <div class="category-item" data-category="nonmetal">
            <div class="category-color" style="background: #1dd1a1;"></div>
            <span class="category-name">Nonmetals</span>
        </div>
        <div class="category-item" data-category="halogen">
            <div class="category-color" style="background: #10ac84;"></div>
            <span class="category-name">Halogens</span>
        </div>
        <div class="category-item" data-category="noble">
            <div class="category-color" style="background: #a29bfe;"></div>
            <span class="category-name">Noble Gases</span>
        </div>
        <div class="category-item" data-category="lanthanide">
            <div class="category-color" style="background: #48dbfb;"></div>
            <span class="category-name">Lanthanides</span>
        </div>
        <div class="category-item" data-category="actinide">
            <div class="category-color" style="background: #ff9ff3;"></div>
            <span class="category-name">Actinides</span>
        </div>
    </div>

    <div id="tooltip">
        <div class="tooltip-content">
            <div class="tooltip-header">
                <div class="tooltip-symbol-box" id="tooltip-symbol-box">
                    <span class="tooltip-number" id="tooltip-number">1</span>
                    <span class="tooltip-symbol" id="tooltip-symbol">H</span>
                    <span class="tooltip-mass" id="tooltip-mass">1.008</span>
                </div>
                <div class="tooltip-info">
                    <h2 id="tooltip-name">Hydrogen</h2>
                    <div class="tooltip-category" id="tooltip-category">Nonmetal</div>
                </div>
            </div>
            <div class="tooltip-grid" id="tooltip-grid"></div>
            <div class="tooltip-description" id="tooltip-description"></div>
            <div class="electron-shells" id="electron-shells"></div>
        </div>
    </div>

    <button id="combiner-toggle"> Open Element Combiner</button>

    <div id="combination-panel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0;"> Element Combiner</h3>
            <button id="combiner-close" style="background:rgba(255,255,255,0.1); border:none; color:#fff; width:28px; height:28px; border-radius:50%; cursor:pointer; font-size:14px;"></button>
        </div>
        <p style="font-size:11px; opacity:0.5; margin-bottom:10px; text-align:center;">Click elements to add them</p>
        <div id="selected-elements">
            <div class="empty-slot">+</div>
            <span class="plus-sign">+</span>
            <div class="empty-slot">+</div>
        </div>
        <div id="combination-buttons">
            <button class="btn btn-primary" id="btn-combine"> Combine</button>
            <button class="btn btn-danger" id="btn-clear"> Clear</button>
        </div>
        <div id="compound-result"></div>
    </div>

    <div id="instructions">
        <h4>Controls</h4>
        <div class="instruction-item"><span class="instruction-icon"></span> Right-click drag to rotate</div>
        <div class="instruction-item"><span class="instruction-icon"></span> Scroll to zoom</div>
        <div class="instruction-item"><span class="instruction-icon"></span> Hover for info</div>
        <div class="instruction-item"><span class="instruction-icon"></span> Left-click to select</div>
        <div class="instruction-item"><span class="instruction-icon"></span> Double-click to zoom</div>
    </div>

    <!-- Temperature Panel -->
    <div id="temp-panel">
        <h4> Temperature Control</h4>
        <input type="range" id="temp-slider" min="0" max="6000" value="298">
        <div id="temp-value">298 <span>K</span></div>
        <button id="temp-reset" style="width:100%; margin-top:10px; padding:8px; background:rgba(0,212,255,0.2); border:1px solid rgba(0,212,255,0.3); border-radius:8px; color:#fff; cursor:pointer; font-size:12px;"> Reset to 298K (Room Temp)</button>
        <div class="state-legend">
            <div class="state-item"><span class="state-icon"></span> Solid</div>
            <div class="state-item"><span class="state-icon"></span> Liquid</div>
            <div class="state-item"><span class="state-icon"></span> Gas</div>
        </div>
    </div>

    <!-- Keyboard Shortcuts -->
    <div id="shortcuts-panel">
        <h4> Keyboard Shortcuts</h4>
        <div class="shortcut-item"><span class="shortcut-key">R</span><span class="shortcut-desc">Toggle rotate</span></div>
        <div class="shortcut-item"><span class="shortcut-key">F</span><span class="shortcut-desc">Flat view</span></div>
        <div class="shortcut-item"><span class="shortcut-key">3</span><span class="shortcut-desc">3D view</span></div>
        <div class="shortcut-item"><span class="shortcut-key">/</span><span class="shortcut-desc">Search</span></div>
        <div class="shortcut-item"><span class="shortcut-key">C</span><span class="shortcut-desc">Compare mode</span></div>
        <div class="shortcut-item"><span class="shortcut-key">Esc</span><span class="shortcut-desc">Clear/Close</span></div>
    </div>

    <!-- Sound Toggle -->
    <div id="sound-toggle">
        <span class="icon"></span>
        <span>Sound: ON</span>
    </div>

    <!-- Comparison Panel -->
    <div id="comparison-panel">
        <div class="comparison-header">
            <h3> Compare Mode</h3>
            <button class="comparison-close" onclick="closeComparison()"></button>
        </div>
        <p style="opacity:0.6; margin-bottom:15px; font-size:12px;">Click elements on the table to compare them</p>
        <div id="comparison-grid" style="display:flex; flex-direction:column; gap:15px;">
            <div class="comparison-element" id="compare-1">
                <p style="text-align:center; opacity:0.4; padding:20px;">Click first element</p>
            </div>
            <div class="comparison-element" id="compare-2">
                <p style="text-align:center; opacity:0.4; padding:20px;">Click second element</p>
            </div>
        </div>
    </div>

    <!-- Zoom Overlay -->
    <div id="zoom-overlay" onclick="closeZoom()">
        <div id="zoom-content" onclick="event.stopPropagation()">
            <div id="electron-orbital-container"></div>
            <div id="zoom-symbol">H</div>
            <div id="zoom-name">Hydrogen</div>
            <div id="zoom-number">Atomic Number: 1</div>
            <div id="zoom-details"></div>
            <a id="zoom-wiki" class="wiki-link" href="#" target="_blank">
                 Learn More on Wikipedia
            </a>
            <br>
            <button id="zoom-close" onclick="closeZoom()">Close</button>
        </div>
    </div>

    <!-- Help Button -->
    <button id="help-btn" aria-label="Help">?</button>

    <!-- Help Modal -->
    <div id="help-modal" role="dialog" aria-labelledby="help-title">
        <div id="help-content">
            <h2 id="help-title">
                 How to Use Elementum
                <button onclick="closeHelp()" style="background:none; border:none; color:#fff; font-size:24px; cursor:pointer;"></button>
            </h2>
            
            <div class="help-section">
                <h3> Navigation</h3>
                <ul>
                    <li><strong>Right-click + drag</strong> - Rotate the periodic table</li>
                    <li><strong>Scroll wheel</strong> - Zoom in/out</li>
                    <li><strong>Hover</strong> - View element details</li>
                    <li><strong>Double-click</strong> - Focus on an element</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3> Element Combiner</h3>
                <p>Click "Open Element Combiner" at the bottom, then click elements to add them. Press "Combine" to see what compound they form together!</p>
            </div>
            
            <div class="help-section">
                <h3> Comparison Mode</h3>
                <p>Press <strong>C</strong> on your keyboard to enter comparison mode. Click two elements to compare their properties side-by-side. You can drag the panel around.</p>
            </div>
            
            <div class="help-section">
                <h3> Temperature Control</h3>
                <p>Use the temperature slider to see which elements are solid, liquid, or gas at different temperatures. Room temperature is 298K (25C).</p>
            </div>
            
            <div class="help-section">
                <h3> Keyboard Shortcuts</h3>
                <ul>
                    <li><strong>R</strong> - Toggle auto-rotation</li>
                    <li><strong>F</strong> - Flat view</li>
                    <li><strong>3</strong> - 3D view</li>
                    <li><strong>/</strong> - Focus search box</li>
                    <li><strong>C</strong> - Toggle comparison mode</li>
                    <li><strong>Escape</strong> - Close panels</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3> Mobile</h3>
                <p>On touch devices, use one finger to rotate the table. Tap elements to view info, double-tap to zoom.</p>
            </div>
        </div>
    </div>

    <!-- Reaction Lab Mode -->
    <div id="reaction-lab">
        <div class="lab-bg-glow"></div>
        <div class="lab-header">
            <h2> Reaction Laboratory</h2>
        </div>
        <button class="lab-close" onclick="closeReactionLab()"></button>
        
        <div class="lab-container">
            <!-- Recipe Book on the left -->
            <div class="recipe-book">
                <h3> Recipe Guide</h3>
                <div class="recipe-list" id="recipe-list">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            
            <div class="element-tray">
                <h3>Elements</h3>
                <div class="tray-elements" id="tray-elements"></div>
            </div>
            
            <div class="beaker-container">
                <div class="beaker" id="beaker">
                    <div class="beaker-liquid" id="beaker-liquid">
                        <div class="reaction-glow" id="reaction-glow"></div>
                    </div>
                    <div class="fire-container" id="fire-container"></div>
                </div>
                <div class="lab-table"></div>
                <button class="clear-beaker-btn" onclick="clearBeaker()"> Clear Beaker</button>
            </div>
        </div>
        
        <div class="reaction-info" id="reaction-info">
            <button class="reaction-info-close" onclick="hideReactionInfo()"></button>
            <h4 id="reaction-name">Add elements to start!</h4>
            <p id="reaction-desc">Click elements from the tray to drop them into the beaker</p>
            <div class="reaction-equation" id="reaction-equation"></div>
        </div>
    </div>

    <!-- WebGL Error Fallback -->
    <div id="webgl-error">
        <h2> WebGL Not Supported</h2>
        <p>Your browser or device doesn't support WebGL, which is required for the 3D periodic table.</p>
        <p style="margin-top: 15px; opacity: 0.7;">Try using a modern browser like Chrome, Firefox, Edge, or Safari.</p>
    </div>

    <!-- Footer -->
    <div id="footer">
         2025 Zeretsu  <a href="#" onclick="document.getElementById('help-modal').classList.add('visible'); return false;">Help</a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script>
        // ============================================
        // COMPLETE ELEMENT DATA (All 118 elements)
        // ============================================
        const elements = [
            { number: 1, symbol: 'H', name: 'Hydrogen', mass: 1.008, category: 'nonmetal', group: 1, period: 1, electrons: [1], electronegativity: 2.20, radius: 53, melt: -259.14, boil: -252.87, density: 0.09, discovered: 1766, discoverer: 'Henry Cavendish', description: 'Lightest and most abundant element in the universe.  Essential component of water and all organic compounds.  Used in rocket fuel and fuel cells.' },
            { number: 2, symbol: 'He', name: 'Helium', mass: 4.003, category: 'noble', group: 18, period: 1, electrons: [2], electronegativity: null, radius: 31, melt: -272.2, boil: -268.93, density: 0.18, discovered: 1868, discoverer: 'Pierre Janssen', description: 'Second lightest element, extremely unreactive noble gas. Used in balloons, deep-sea diving, and cryogenics.  Has the lowest boiling point of any element.' },
            { number: 3, symbol: 'Li', name: 'Lithium', mass: 6.941, category: 'alkali', group: 1, period: 2, electrons: [2, 1], electronegativity: 0.98, radius: 167, melt: 180.5, boil: 1342, density: 0.53, discovered: 1817, discoverer: 'Johan Arfwedson', description: 'Lightest metal, highly reactive.  Essential for rechargeable batteries in phones and electric vehicles.  Also used in psychiatric medication for bipolar disorder.' },
            { number: 4, symbol: 'Be', name: 'Beryllium', mass: 9.012, category: 'alkaline', group: 2, period: 2, electrons: [2, 2], electronegativity: 1.57, radius: 112, melt: 1287, boil: 2470, density: 1.85, discovered: 1798, discoverer: 'Louis Vauquelin', description: 'Light, strong, and toxic metal. Used in aerospace applications, X-ray windows, and nuclear reactors.  Excellent thermal conductor.' },
            { number: 5, symbol: 'B', name: 'Boron', mass: 10.81, category: 'metalloid', group: 13, period: 2, electrons: [2, 3], electronegativity: 2.04, radius: 87, melt: 2075, boil: 4000, density: 2.34, discovered: 1808, discoverer: 'Humphry Davy', description: 'Hard metalloid essential for plant growth.  Used in fiberglass, detergents, and high-strength materials.  Boron carbide is one of the hardest materials known.' },
            { number: 6, symbol: 'C', name: 'Carbon', mass: 12.01, category: 'nonmetal', group: 14, period: 2, electrons: [2, 4], electronegativity: 2.55, radius: 67, melt: 3550, boil: 4027, density: 2.27, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Basis of all organic chemistry and life. Forms diamonds, graphite, graphene, and fullerenes. Fourth most abundant element in the universe.' },
            { number: 7, symbol: 'N', name: 'Nitrogen', mass: 14.01, category: 'nonmetal', group: 15, period: 2, electrons: [2, 5], electronegativity: 3.04, radius: 56, melt: -210.1, boil: -195.79, density: 1.25, discovered: 1772, discoverer: 'Daniel Rutherford', description: 'Makes up 78% of Earths atmosphere.  Essential for proteins, DNA, and fertilizers. Liquid nitrogen used for cryogenic freezing.' },
            { number: 8, symbol: 'O', name: 'Oxygen', mass: 16.00, category: 'nonmetal', group: 16, period: 2, electrons: [2, 6], electronegativity: 3.44, radius: 48, melt: -218.3, boil: -182.9, density: 1.43, discovered: 1774, discoverer: 'Joseph Priestley', description: 'Essential for respiration and combustion. Third most abundant element in universe. Makes up 21% of atmosphere and about 65% of human body mass.' },
            { number: 9, symbol: 'F', name: 'Fluorine', mass: 19.00, category: 'halogen', group: 17, period: 2, electrons: [2, 7], electronegativity: 3.98, radius: 42, melt: -219.6, boil: -188.12, density: 1.70, discovered: 1886, discoverer: 'Henri Moissan', description: 'Most electronegative and reactive element. Used in toothpaste, Teflon, and refrigerants.  Extremely dangerous in pure form.' },
            { number: 10, symbol: 'Ne', name: 'Neon', mass: 20.18, category: 'noble', group: 18, period: 2, electrons: [2, 8], electronegativity: null, radius: 38, melt: -248.59, boil: -246.08, density: 0.90, discovered: 1898, discoverer: 'William Ramsay', description: 'Inert noble gas famous for bright red-orange glow in neon signs. Fifth most abundant element in universe but rare on Earth.' },
            { number: 11, symbol: 'Na', name: 'Sodium', mass: 22.99, category: 'alkali', group: 1, period: 3, electrons: [2, 8, 1], electronegativity: 0.93, radius: 190, melt: 97.72, boil: 883, density: 0.97, discovered: 1807, discoverer: 'Humphry Davy', description: 'Essential nutrient, reacts explosively with water. Component of table salt (NaCl). Used in street lamps and as heat transfer fluid in nuclear reactors.' },
            { number: 12, symbol: 'Mg', name: 'Magnesium', mass: 24.31, category: 'alkaline', group: 2, period: 3, electrons: [2, 8, 2], electronegativity: 1.31, radius: 145, melt: 650, boil: 1090, density: 1.74, discovered: 1755, discoverer: 'Joseph Black', description: 'Light structural metal, burns with brilliant white flame. Essential for chlorophyll in plants and hundreds of enzymes in humans.  Used in alloys and fireworks.' },
            { number: 13, symbol: 'Al', name: 'Aluminum', mass: 26.98, category: 'post-transition', group: 13, period: 3, electrons: [2, 8, 3], electronegativity: 1.61, radius: 118, melt: 660.32, boil: 2519, density: 2.70, discovered: 1825, discoverer: 'Hans Christian rsted', description: 'Most abundant metal in Earths crust. Lightweight, corrosion-resistant.  Used in cans, foil, aircraft, and construction. Once more valuable than gold.' },
            { number: 14, symbol: 'Si', name: 'Silicon', mass: 28.09, category: 'metalloid', group: 14, period: 3, electrons: [2, 8, 4], electronegativity: 1.90, radius: 111, melt: 1414, boil: 3265, density: 2.33, discovered: 1824, discoverer: 'Jns Jacob Berzelius', description: 'Second most abundant element in crust.  Basis of computer chips and solar cells. Silicon Valley named after this semiconductor element.' },
            { number: 15, symbol: 'P', name: 'Phosphorus', mass: 30.97, category: 'nonmetal', group: 15, period: 3, electrons: [2, 8, 5], electronegativity: 2.19, radius: 98, melt: 44.15, boil: 280.5, density: 1.82, discovered: 1669, discoverer: 'Hennig Brand', description: 'Essential for DNA, RNA, and ATP.  White phosphorus glows in dark and is highly toxic.  Used in fertilizers, matches, and detergents.' },
            { number: 16, symbol: 'S', name: 'Sulfur', mass: 32.07, category: 'nonmetal', group: 16, period: 3, electrons: [2, 8, 6], electronegativity: 2.58, radius: 88, melt: 115.21, boil: 444.6, density: 2.07, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Yellow solid with distinctive smell. Used in vulcanizing rubber, sulfuric acid, and gunpowder.  Essential component of some amino acids.' },
            { number: 17, symbol: 'Cl', name: 'Chlorine', mass: 35.45, category: 'halogen', group: 17, period: 3, electrons: [2, 8, 7], electronegativity: 3.16, radius: 79, melt: -101.5, boil: -34.04, density: 3.21, discovered: 1774, discoverer: 'Carl Wilhelm Scheele', description: 'Yellow-green toxic gas used to purify water and make PVC plastic. Component of table salt.  Used as chemical weapon in WWI.' },
            { number: 18, symbol: 'Ar', name: 'Argon', mass: 39.95, category: 'noble', group: 18, period: 3, electrons: [2, 8, 8], electronegativity: null, radius: 71, melt: -189.3, boil: -185.8, density: 1.78, discovered: 1894, discoverer: 'Lord Rayleigh', description: 'Most abundant noble gas in atmosphere (0.93%). Used in welding, light bulbs, and preserving historical documents.  Completely inert.' },
            { number: 19, symbol: 'K', name: 'Potassium', mass: 39.10, category: 'alkali', group: 1, period: 4, electrons: [2, 8, 8, 1], electronegativity: 0.82, radius: 243, melt: 63.38, boil: 759, density: 0.86, discovered: 1807, discoverer: 'Humphry Davy', description: 'Essential nutrient for nerve function and muscle contraction.  Reacts violently with water. Found in bananas and used in fertilizers.' },
            { number: 20, symbol: 'Ca', name: 'Calcium', mass: 40.08, category: 'alkaline', group: 2, period: 4, electrons: [2, 8, 8, 2], electronegativity: 1.00, radius: 194, melt: 842, boil: 1484, density: 1.54, discovered: 1808, discoverer: 'Humphry Davy', description: 'Fifth most abundant element in crust. Essential for bones, teeth, and muscle function. Found in limestone, chalk, and marble.' },
            { number: 21, symbol: 'Sc', name: 'Scandium', mass: 44.96, category: 'transition', group: 3, period: 4, electrons: [2, 8, 9, 2], electronegativity: 1.36, radius: 184, melt: 1541, boil: 2836, density: 2.99, discovered: 1879, discoverer: 'Lars Fredrik Nilson', description: 'Light transition metal used in aerospace alloys and sports equipment like baseball bats and bicycle frames.  Produces light similar to sunlight.' },
            { number: 22, symbol: 'Ti', name: 'Titanium', mass: 47.87, category: 'transition', group: 4, period: 4, electrons: [2, 8, 10, 2], electronegativity: 1.54, radius: 176, melt: 1668, boil: 3287, density: 4.51, discovered: 1791, discoverer: 'William Gregor', description: 'Strong, light, corrosion-resistant metal. Used in aircraft, spacecraft, medical implants, and sports equipment. As strong as steel but 45% lighter.' },
            { number: 23, symbol: 'V', name: 'Vanadium', mass: 50.94, category: 'transition', group: 5, period: 4, electrons: [2, 8, 11, 2], electronegativity: 1.63, radius: 171, melt: 1910, boil: 3407, density: 6.11, discovered: 1801, discoverer: 'Andrs Manuel del Ro', description: 'Hard, silvery-gray metal that increases steel strength. Used in tools, springs, and jet engines. Named after Scandinavian goddess Vanadis.' },
            { number: 24, symbol: 'Cr', name: 'Chromium', mass: 52.00, category: 'transition', group: 6, period: 4, electrons: [2, 8, 13, 1], electronegativity: 1.66, radius: 166, melt: 1907, boil: 2671, density: 7.19, discovered: 1797, discoverer: 'Louis Nicolas Vauquelin', description: 'Hard, shiny metal used in stainless steel and chrome plating. Gives rubies their red color and emeralds their green.  Resists corrosion.' },
            { number: 25, symbol: 'Mn', name: 'Manganese', mass: 54.94, category: 'transition', group: 7, period: 4, electrons: [2, 8, 13, 2], electronegativity: 1.55, radius: 161, melt: 1246, boil: 2061, density: 7.43, discovered: 1774, discoverer: 'Johan Gottlieb Gahn', description: 'Essential trace element for humans. Used in steel production, batteries, and as purple coloring in glass. Critical for photosynthesis in plants.' },
            { number: 26, symbol: 'Fe', name: 'Iron', mass: 55.85, category: 'transition', group: 8, period: 4, electrons: [2, 8, 14, 2], electronegativity: 1.83, radius: 156, melt: 1538, boil: 2861, density: 7.87, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Most used metal on Earth. Essential for hemoglobin in blood.  Earths core is mainly iron.  Used since Iron Age for tools and construction.' },
            { number: 27, symbol: 'Co', name: 'Cobalt', mass: 58.93, category: 'transition', group: 9, period: 4, electrons: [2, 8, 15, 2], electronegativity: 1.88, radius: 152, melt: 1495, boil: 2927, density: 8.90, discovered: 1735, discoverer: 'Georg Brandt', description: 'Blue-colored metal used in batteries, magnets, and blue pigments since ancient times. Essential trace element.  Used in jet engine superalloys.' },
            { number: 28, symbol: 'Ni', name: 'Nickel', mass: 58.69, category: 'transition', group: 10, period: 4, electrons: [2, 8, 16, 2], electronegativity: 1.91, radius: 149, melt: 1455, boil: 2913, density: 8.91, discovered: 1751, discoverer: 'Axel Fredrik Cronstedt', description: 'Corrosion-resistant, used in coins, stainless steel, and rechargeable batteries. US nickel coin is 75% copper.  Believed to come from meteorites.' },
            { number: 29, symbol: 'Cu', name: 'Copper', mass: 63.55, category: 'transition', group: 11, period: 4, electrons: [2, 8, 18, 1], electronegativity: 1.90, radius: 145, melt: 1084.62, boil: 2562, density: 8.96, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Excellent electrical conductor, one of first metals used by humans. Used in wiring, plumbing, and coins. Statue of Liberty contains 80 tons of copper.' },
            { number: 30, symbol: 'Zn', name: 'Zinc', mass: 65.38, category: 'transition', group: 12, period: 4, electrons: [2, 8, 18, 2], electronegativity: 1.65, radius: 142, melt: 419.53, boil: 907, density: 7.13, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Essential trace element, protects steel from corrosion (galvanization). Used in batteries, sunscreen, and brass alloys.  Fourth most common metal in use.' },
            { number: 31, symbol: 'Ga', name: 'Gallium', mass: 69.72, category: 'post-transition', group: 13, period: 4, electrons: [2, 8, 18, 3], electronegativity: 1.81, radius: 136, melt: 29.76, boil: 2204, density: 5.91, discovered: 1875, discoverer: 'Paul Emile Lecoq de Boisbaudran', description: 'Melts in your hand (MP 29.76C). Used in semiconductors, LEDs, and solar panels. Can attack other metals, weakening aluminum aircraft.' },
            { number: 32, symbol: 'Ge', name: 'Germanium', mass: 72.63, category: 'metalloid', group: 14, period: 4, electrons: [2, 8, 18, 4], electronegativity: 2.01, radius: 125, melt: 938.25, boil: 2833, density: 5.32, discovered: 1886, discoverer: 'Clemens Winkler', description: 'Important semiconductor, predicted by Mendeleev.  Used in fiber optics, infrared optics, and transistors. Transparent to infrared light.' },
            { number: 33, symbol: 'As', name: 'Arsenic', mass: 74.92, category: 'metalloid', group: 15, period: 4, electrons: [2, 8, 18, 5], electronegativity: 2.18, radius: 114, melt: 817, boil: 614, density: 5.73, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Notorious poison through history. Used in semiconductors, wood preservatives, and pesticides. Some organisms use arsenic instead of phosphorus.' },
            { number: 34, symbol: 'Se', name: 'Selenium', mass: 78.96, category: 'nonmetal', group: 16, period: 4, electrons: [2, 8, 18, 6], electronegativity: 2.55, radius: 103, melt: 221, boil: 685, density: 4.81, discovered: 1817, discoverer: 'Jns Jacob Berzelius', description: 'Essential trace element. Used in electronics, glass making, and photocopiers. Named after Greek moon goddess Selene.  Toxic in large amounts.' },
            { number: 35, symbol: 'Br', name: 'Bromine', mass: 79.90, category: 'halogen', group: 17, period: 4, electrons: [2, 8, 18, 7], electronegativity: 2.96, radius: 94, melt: -7.2, boil: 58.8, density: 3.12, discovered: 1826, discoverer: 'Antoine Jrme Balard', description: 'One of two liquid elements at room temperature. Red-brown with choking odor.  Used in flame retardants, water purification, and photography.' },
            { number: 36, symbol: 'Kr', name: 'Krypton', mass: 83.80, category: 'noble', group: 18, period: 4, electrons: [2, 8, 18, 8], electronegativity: 3.00, radius: 88, melt: -157.36, boil: -153.22, density: 3.75, discovered: 1898, discoverer: 'William Ramsay', description: 'Noble gas used in lighting and lasers. Supermans weakness is named after it.  Once used to define the meter length standard.' },
            { number: 37, symbol: 'Rb', name: 'Rubidium', mass: 85.47, category: 'alkali', group: 1, period: 5, electrons: [2, 8, 18, 8, 1], electronegativity: 0.82, radius: 265, melt: 39.31, boil: 688, density: 1.53, discovered: 1861, discoverer: 'Robert Bunsen', description: 'Soft alkali metal that ignites in air and reacts explosively with water. Used in atomic clocks, GPS satellites, and research.' },
            { number: 38, symbol: 'Sr', name: 'Strontium', mass: 87.62, category: 'alkaline', group: 2, period: 5, electrons: [2, 8, 18, 8, 2], electronegativity: 0.95, radius: 219, melt: 777, boil: 1382, density: 2.64, discovered: 1790, discoverer: 'William Cruickshank', description: 'Produces brilliant red color in fireworks. Used in TV screens and some toothpastes.  Radioactive Sr-90 from nuclear fallout is dangerous.' },
            { number: 39, symbol: 'Y', name: 'Yttrium', mass: 88.91, category: 'transition', group: 3, period: 5, electrons: [2, 8, 18, 9, 2], electronegativity: 1.22, radius: 212, melt: 1526, boil: 3345, density: 4.47, discovered: 1794, discoverer: 'Johan Gadolin', description: 'Used in LEDs, superconductors, and cancer treatment. Component of YAG lasers.  Named after Ytterby, Sweden where four elements were discovered.' },
            { number: 40, symbol: 'Zr', name: 'Zirconium', mass: 91.22, category: 'transition', group: 4, period: 5, electrons: [2, 8, 18, 10, 2], electronegativity: 1.33, radius: 206, melt: 1855, boil: 4409, density: 6.51, discovered: 1789, discoverer: 'Martin Heinrich Klaproth', description: 'Extremely corrosion-resistant, used in nuclear reactor fuel rods. Cubic zirconia is a diamond simulant.  Used in hip replacements.' },
            { number: 41, symbol: 'Nb', name: 'Niobium', mass: 92.91, category: 'transition', group: 5, period: 5, electrons: [2, 8, 18, 12, 1], electronegativity: 1.60, radius: 198, melt: 2477, boil: 4744, density: 8.57, discovered: 1801, discoverer: 'Charles Hatchett', description: 'Used in superconducting magnets for MRI machines and particle accelerators. Added to steel for jet engines and rockets.  Hypoallergenic for jewelry.' },
            { number: 42, symbol: 'Mo', name: 'Molybdenum', mass: 95.95, category: 'transition', group: 6, period: 5, electrons: [2, 8, 18, 13, 1], electronegativity: 2.16, radius: 190, melt: 2623, boil: 4639, density: 10.28, discovered: 1778, discoverer: 'Carl Wilhelm Scheele', description: 'Essential trace element for nitrogen fixation. Used in high-strength steel alloys and catalysts.  Has one of highest melting points of all elements.' },
            { number: 43, symbol: 'Tc', name: 'Technetium', mass: 98, category: 'transition', group: 7, period: 5, electrons: [2, 8, 18, 13, 2], electronegativity: 1.90, radius: 183, melt: 2157, boil: 4265, density: 11, discovered: 1937, discoverer: 'Carlo Perrier', description: 'First artificially produced element.  Radioactive with no stable isotopes.  Tc-99m is most widely used radioactive tracer in medical imaging.' },
            { number: 44, symbol: 'Ru', name: 'Ruthenium', mass: 101.07, category: 'transition', group: 8, period: 5, electrons: [2, 8, 18, 15, 1], electronegativity: 2.20, radius: 178, melt: 2334, boil: 4150, density: 12.37, discovered: 1844, discoverer: 'Karl Ernst Claus', description: 'Platinum group metal used in electronics, solar cells, and catalysts. Hardens platinum and palladium. Used in fountain pen nibs.' },
            { number: 45, symbol: 'Rh', name: 'Rhodium', mass: 102.91, category: 'transition', group: 9, period: 5, electrons: [2, 8, 18, 16, 1], electronegativity: 2.28, radius: 173, melt: 1964, boil: 3695, density: 12.41, discovered: 1803, discoverer: 'William Hyde Wollaston', description: 'Rarest and most valuable precious metal. Used in catalytic converters, mirrors, and jewelry.  Highly reflective and corrosion-resistant.' },
            { number: 46, symbol: 'Pd', name: 'Palladium', mass: 106.42, category: 'transition', group: 10, period: 5, electrons: [2, 8, 18, 18], electronegativity: 2.20, radius: 169, melt: 1554.9, boil: 2963, density: 12.02, discovered: 1803, discoverer: 'William Hyde Wollaston', description: 'Used in catalytic converters, electronics, and jewelry. Can absorb 900 times its volume in hydrogen.  Named after asteroid Pallas.' },
            { number: 47, symbol: 'Ag', name: 'Silver', mass: 107.87, category: 'transition', group: 11, period: 5, electrons: [2, 8, 18, 18, 1], electronegativity: 1.93, radius: 165, melt: 961.78, boil: 2162, density: 10.49, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Best electrical and thermal conductor. Used in jewelry, coins, photography, and electronics. Has antibacterial properties.' },
            { number: 48, symbol: 'Cd', name: 'Cadmium', mass: 112.41, category: 'transition', group: 12, period: 5, electrons: [2, 8, 18, 18, 2], electronegativity: 1.69, radius: 161, melt: 321.07, boil: 767, density: 8.65, discovered: 1817, discoverer: 'Karl Samuel Leberecht Hermann', description: 'Toxic heavy metal used in rechargeable batteries and pigments. Used in nuclear reactor control rods. Named from Greek kadmeia (calamine).' },
            { number: 49, symbol: 'In', name: 'Indium', mass: 114.82, category: 'post-transition', group: 13, period: 5, electrons: [2, 8, 18, 18, 3], electronegativity: 1.78, radius: 156, melt: 156.6, boil: 2072, density: 7.31, discovered: 1863, discoverer: 'Ferdinand Reich', description: 'Soft metal used in touchscreens (ITO), solders, and low-melting alloys. Makes a crying sound when bent. Named for indigo spectral line.' },
            { number: 50, symbol: 'Sn', name: 'Tin', mass: 118.71, category: 'post-transition', group: 14, period: 5, electrons: [2, 8, 18, 18, 4], electronegativity: 1.96, radius: 145, melt: 231.93, boil: 2602, density: 7.29, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Used since Bronze Age for bronze alloy. Used in tin cans, solder, and pewter.  Has most stable isotopes of any element (10).' },
            { number: 51, symbol: 'Sb', name: 'Antimony', mass: 121.76, category: 'metalloid', group: 15, period: 5, electrons: [2, 8, 18, 18, 5], electronegativity: 2.05, radius: 133, melt: 630.63, boil: 1587, density: 6.69, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Metalloid used in flame retardants and lead-acid batteries. Used in cosmetics since ancient Egypt.  Expands when solidifying.' },
            { number: 52, symbol: 'Te', name: 'Tellurium', mass: 127.60, category: 'metalloid', group: 16, period: 5, electrons: [2, 8, 18, 18, 6], electronegativity: 2.10, radius: 123, melt: 449.51, boil: 988, density: 6.24, discovered: 1783, discoverer: 'Franz-Joseph Mller von Reichenstein', description: 'Rare metalloid used in solar cells, thermoelectric devices, and rewritable CDs.  Gives garlic breath even in tiny amounts.  Named for Earth.' },
            { number: 53, symbol: 'I', name: 'Iodine', mass: 126.90, category: 'halogen', group: 17, period: 5, electrons: [2, 8, 18, 18, 7], electronegativity: 2.66, radius: 115, melt: 113.7, boil: 184.3, density: 4.93, discovered: 1811, discoverer: 'Bernard Courtois', description: 'Essential for thyroid hormones. Used as antiseptic and in photography. Sublimes to purple vapor.  Deficiency causes goiter.' },
            { number: 54, symbol: 'Xe', name: 'Xenon', mass: 131.29, category: 'noble', group: 18, period: 5, electrons: [2, 8, 18, 18, 8], electronegativity: 2.60, radius: 108, melt: -111.8, boil: -108.1, density: 5.89, discovered: 1898, discoverer: 'William Ramsay', description: 'Noble gas that can form compounds.  Used in flash lamps, anesthesia, and ion propulsion engines. Used in search for dark matter.' },
            { number: 55, symbol: 'Cs', name: 'Cesium', mass: 132.91, category: 'alkali', group: 1, period: 6, electrons: [2, 8, 18, 18, 8, 1], electronegativity: 0.79, radius: 298, melt: 28.44, boil: 671, density: 1.93, discovered: 1860, discoverer: 'Robert Bunsen', description: 'Most electropositive stable element, explodes in water.  Cesium atomic clocks are most accurate timekeepers.  Melts near body temperature.' },
            { number: 56, symbol: 'Ba', name: 'Barium', mass: 137.33, category: 'alkaline', group: 2, period: 6, electrons: [2, 8, 18, 18, 8, 2], electronegativity: 0.89, radius: 253, melt: 727, boil: 1870, density: 3.51, discovered: 1808, discoverer: 'Humphry Davy', description: 'Used in X-ray imaging (barium meal), fireworks, and drilling fluids. Green color in fireworks. Name means heavy in Greek.' },
            { number: 57, symbol: 'La', name: 'Lanthanum', mass: 138.91, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 18, 9, 2], electronegativity: 1.10, radius: 195, melt: 920, boil: 3464, density: 6.15, discovered: 1839, discoverer: 'Carl Gustaf Mosander', description: 'First lanthanide element.  Used in camera lenses, battery electrodes, and lighter flints. Name means hidden in Greek.' },
            { number: 58, symbol: 'Ce', name: 'Cerium', mass: 140.12, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 19, 9, 2], electronegativity: 1.12, radius: 185, melt: 795, boil: 3443, density: 6.77, discovered: 1803, discoverer: 'Jns Jacob Berzelius', description: 'Most abundant lanthanide. Used in catalytic converters, glass polishing, and self-cleaning ovens.  Named after asteroid Ceres.' },
            { number: 59, symbol: 'Pr', name: 'Praseodymium', mass: 140.91, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 21, 8, 2], electronegativity: 1.13, radius: 247, melt: 935, boil: 3520, density: 6.77, discovered: 1885, discoverer: 'Carl Auer von Welsbach', description: 'Used in high-strength magnets, aircraft engines, and welder goggles. Gives glass green color. Name means green twin.' },
            { number: 60, symbol: 'Nd', name: 'Neodymium', mass: 144.24, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 22, 8, 2], electronegativity: 1.14, radius: 206, melt: 1016, boil: 3074, density: 7.01, discovered: 1885, discoverer: 'Carl Auer von Welsbach', description: 'Creates worlds strongest permanent magnets. Used in headphones, electric motors, and hard drives. Essential for green technology.' },
            { number: 61, symbol: 'Pm', name: 'Promethium', mass: 145, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 23, 8, 2], electronegativity: 1.13, radius: 205, melt: 1042, boil: 3000, density: 7.26, discovered: 1945, discoverer: 'Chien Shiung Wu', description: 'Only radioactive lanthanide with no stable isotopes. Used in nuclear batteries and luminous paint. Named after Greek Titan Prometheus.' },
            { number: 62, symbol: 'Sm', name: 'Samarium', mass: 150.36, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 24, 8, 2], electronegativity: 1.17, radius: 238, melt: 1072, boil: 1794, density: 7.52, discovered: 1879, discoverer: 'Paul Emile Lecoq de Boisbaudran', description: 'Used in samarium-cobalt magnets, cancer treatment, and nuclear reactors.' },
            { number: 63, symbol: 'Eu', name: 'Europium', mass: 151.96, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 25, 8, 2], electronegativity: 1.20, radius: 231, melt: 826, boil: 1529, density: 5.24, discovered: 1901, discoverer: 'Eugene-Anatole Demarcay', description: 'Most reactive lanthanide. Used in Euro banknotes and TV screens.' },
            { number: 64, symbol: 'Gd', name: 'Gadolinium', mass: 157.25, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 25, 9, 2], electronegativity: 1.20, radius: 233, melt: 1312, boil: 3273, density: 7.90, discovered: 1880, discoverer: 'Jean Charles Galissard de Marignac', description: 'Most magnetic element. Used in MRI contrast agents.' },
            { number: 65, symbol: 'Tb', name: 'Terbium', mass: 158.93, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 27, 8, 2], electronegativity: 1.20, radius: 225, melt: 1356, boil: 3230, density: 8.23, discovered: 1843, discoverer: 'Carl Gustaf Mosander', description: 'Used in green phosphors for displays and solid-state devices.' },
            { number: 66, symbol: 'Dy', name: 'Dysprosium', mass: 162.50, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 28, 8, 2], electronegativity: 1.22, radius: 228, melt: 1412, boil: 2567, density: 8.55, discovered: 1886, discoverer: 'Paul Emile Lecoq de Boisbaudran', description: 'Used in magnets and nuclear reactor control rods.' },
            { number: 67, symbol: 'Ho', name: 'Holmium', mass: 164.93, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 29, 8, 2], electronegativity: 1.23, radius: 226, melt: 1474, boil: 2700, density: 8.80, discovered: 1878, discoverer: 'Marc Delafontaine', description: 'Has highest magnetic moment of any element. Used in lasers.' },
            { number: 68, symbol: 'Er', name: 'Erbium', mass: 167.26, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 30, 8, 2], electronegativity: 1.24, radius: 226, melt: 1529, boil: 2868, density: 9.07, discovered: 1843, discoverer: 'Carl Gustaf Mosander', description: 'Used in fiber optic amplifiers and pink glass coloring.' },
            { number: 69, symbol: 'Tm', name: 'Thulium', mass: 168.93, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 31, 8, 2], electronegativity: 1.25, radius: 222, melt: 1545, boil: 1950, density: 9.32, discovered: 1879, discoverer: 'Per Teodor Cleve', description: 'Rarest lanthanide. Used in portable X-ray devices.' },
            { number: 70, symbol: 'Yb', name: 'Ytterbium', mass: 173.05, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 32, 8, 2], electronegativity: 1.10, radius: 222, melt: 824, boil: 1196, density: 6.90, discovered: 1878, discoverer: 'Jean Charles Galissard de Marignac', description: 'Used in metallurgy and atomic clocks.' },
            { number: 71, symbol: 'Lu', name: 'Lutetium', mass: 174.97, category: 'lanthanide', group: 3, period: 6, electrons: [2, 8, 18, 32, 9, 2], electronegativity: 1.27, radius: 217, melt: 1663, boil: 3402, density: 9.84, discovered: 1907, discoverer: 'Georges Urbain', description: 'Hardest and densest lanthanide. Used in PET scan detectors.' },
            { number: 72, symbol: 'Hf', name: 'Hafnium', mass: 178.49, category: 'transition', group: 4, period: 6, electrons: [2, 8, 18, 32, 10, 2], electronegativity: 1.30, radius: 208, melt: 2233, boil: 4603, density: 13.31, discovered: 1923, discoverer: 'Dirk Coster', description: 'Used in nuclear reactor control rods and superalloys.' },
            { number: 73, symbol: 'Ta', name: 'Tantalum', mass: 180.95, category: 'transition', group: 5, period: 6, electrons: [2, 8, 18, 32, 11, 2], electronegativity: 1.50, radius: 200, melt: 3017, boil: 5458, density: 16.69, discovered: 1802, discoverer: 'Anders Gustaf Ekeberg', description: 'Used in capacitors, surgical implants, and jet engines.' },
            { number: 74, symbol: 'W', name: 'Tungsten', mass: 183.84, category: 'transition', group: 6, period: 6, electrons: [2, 8, 18, 32, 12, 2], electronegativity: 2.36, radius: 193, melt: 3422, boil: 5555, density: 19.25, discovered: 1783, discoverer: 'Juan Jose Elhuyar', description: 'Highest melting point of all elements. Used in light bulb filaments.' },
            { number: 75, symbol: 'Re', name: 'Rhenium', mass: 186.21, category: 'transition', group: 7, period: 6, electrons: [2, 8, 18, 32, 13, 2], electronegativity: 1.90, radius: 188, melt: 3186, boil: 5596, density: 21.02, discovered: 1925, discoverer: 'Masataka Ogawa', description: 'Used in jet engine superalloys and catalysts.' },
            { number: 76, symbol: 'Os', name: 'Osmium', mass: 190.23, category: 'transition', group: 8, period: 6, electrons: [2, 8, 18, 32, 14, 2], electronegativity: 2.20, radius: 185, melt: 3033, boil: 5012, density: 22.59, discovered: 1803, discoverer: 'Smithson Tennant', description: 'Densest naturally occurring element. Used in fountain pen tips.' },
            { number: 77, symbol: 'Ir', name: 'Iridium', mass: 192.22, category: 'transition', group: 9, period: 6, electrons: [2, 8, 18, 32, 15, 2], electronegativity: 2.20, radius: 180, melt: 2466, boil: 4428, density: 22.56, discovered: 1803, discoverer: 'Smithson Tennant', description: 'Most corrosion-resistant metal. Found in asteroid impact layer.' },
            { number: 78, symbol: 'Pt', name: 'Platinum', mass: 195.08, category: 'transition', group: 10, period: 6, electrons: [2, 8, 18, 32, 17, 1], electronegativity: 2.28, radius: 177, melt: 1768, boil: 3825, density: 21.45, discovered: 1735, discoverer: 'Antonio de Ulloa', description: 'Precious metal used in jewelry, catalysts, and electronics.' },
            { number: 79, symbol: 'Au', name: 'Gold', mass: 196.97, category: 'transition', group: 11, period: 6, electrons: [2, 8, 18, 32, 18, 1], electronegativity: 2.54, radius: 174, melt: 1064, boil: 2856, density: 19.30, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Precious metal prized since antiquity. Excellent conductor, never tarnishes.' },
            { number: 80, symbol: 'Hg', name: 'Mercury', mass: 200.59, category: 'transition', group: 12, period: 6, electrons: [2, 8, 18, 32, 18, 2], electronegativity: 2.00, radius: 171, melt: -39, boil: 357, density: 13.53, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Only metal liquid at room temperature. Used in thermometers.' },
            { number: 81, symbol: 'Tl', name: 'Thallium', mass: 204.38, category: 'post-transition', group: 13, period: 6, electrons: [2, 8, 18, 32, 18, 3], electronegativity: 1.62, radius: 156, melt: 304, boil: 1473, density: 11.85, discovered: 1861, discoverer: 'William Crookes', description: 'Highly toxic metal. Used in electronics and medical imaging.' },
            { number: 82, symbol: 'Pb', name: 'Lead', mass: 207.2, category: 'post-transition', group: 14, period: 6, electrons: [2, 8, 18, 32, 18, 4], electronegativity: 2.33, radius: 154, melt: 327, boil: 1749, density: 11.34, discovered: 'Ancient', discoverer: 'Known since antiquity', description: 'Dense toxic metal. Used in batteries and radiation shielding.' },
            { number: 83, symbol: 'Bi', name: 'Bismuth', mass: 208.98, category: 'post-transition', group: 15, period: 6, electrons: [2, 8, 18, 32, 18, 5], electronegativity: 2.02, radius: 143, melt: 271, boil: 1564, density: 9.78, discovered: 1753, discoverer: 'Claude Francois Geoffroy', description: 'Most diamagnetic element. Used in cosmetics and medicine.' },
            { number: 84, symbol: 'Po', name: 'Polonium', mass: 209, category: 'metalloid', group: 16, period: 6, electrons: [2, 8, 18, 32, 18, 6], electronegativity: 2.00, radius: 135, melt: 254, boil: 962, density: 9.20, discovered: 1898, discoverer: 'Marie Curie', description: 'Highly radioactive. Discovered by Marie Curie, named after Poland.' },
            { number: 85, symbol: 'At', name: 'Astatine', mass: 210, category: 'halogen', group: 17, period: 6, electrons: [2, 8, 18, 32, 18, 7], electronegativity: 2.20, radius: 127, melt: 302, boil: 337, density: 7, discovered: 1940, discoverer: 'Dale R. Corson', description: 'Rarest naturally occurring element on Earth. Highly radioactive.' },
            { number: 86, symbol: 'Rn', name: 'Radon', mass: 222, category: 'noble', group: 18, period: 6, electrons: [2, 8, 18, 32, 18, 8], electronegativity: null, radius: 120, melt: -71, boil: -62, density: 9.73, discovered: 1900, discoverer: 'Friedrich Ernst Dorn', description: 'Radioactive noble gas. Second leading cause of lung cancer.' },
            { number: 87, symbol: 'Fr', name: 'Francium', mass: 223, category: 'alkali', group: 1, period: 7, electrons: [2, 8, 18, 32, 18, 8, 1], electronegativity: 0.70, radius: 348, melt: 27, boil: 677, density: 1.87, discovered: 1939, discoverer: 'Marguerite Perey', description: 'Most unstable naturally occurring element. Extremely rare.' },
            { number: 88, symbol: 'Ra', name: 'Radium', mass: 226, category: 'alkaline', group: 2, period: 7, electrons: [2, 8, 18, 32, 18, 8, 2], electronegativity: 0.90, radius: 283, melt: 700, boil: 1737, density: 5.50, discovered: 1898, discoverer: 'Marie Curie', description: 'Highly radioactive. Once used in luminous paint for watch dials.' },
            { number: 89, symbol: 'Ac', name: 'Actinium', mass: 227, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 18, 9, 2], electronegativity: 1.10, radius: 195, melt: 1050, boil: 3200, density: 10.07, discovered: 1899, discoverer: 'Andre-Louis Debierne', description: 'First actinide element. Glows blue due to radioactivity.' },
            { number: 90, symbol: 'Th', name: 'Thorium', mass: 232.04, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 18, 10, 2], electronegativity: 1.30, radius: 180, melt: 1750, boil: 4788, density: 11.72, discovered: 1829, discoverer: 'Jons Jacob Berzelius', description: 'Potential nuclear fuel. More abundant than uranium.' },
            { number: 91, symbol: 'Pa', name: 'Protactinium', mass: 231.04, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 20, 9, 2], electronegativity: 1.50, radius: 180, melt: 1572, boil: 4000, density: 15.37, discovered: 1913, discoverer: 'Kasimir Fajans', description: 'Rare and toxic actinide. Used in geological dating.' },
            { number: 92, symbol: 'U', name: 'Uranium', mass: 238.03, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 21, 9, 2], electronegativity: 1.38, radius: 175, melt: 1135, boil: 4131, density: 19.05, discovered: 1789, discoverer: 'Martin Heinrich Klaproth', description: 'Used in nuclear power and weapons. Named after Uranus.' },
            { number: 93, symbol: 'Np', name: 'Neptunium', mass: 237, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 22, 9, 2], electronegativity: 1.36, radius: 175, melt: 644, boil: 4000, density: 20.45, discovered: 1940, discoverer: 'Edwin McMillan', description: 'First transuranium element. Named after Neptune.' },
            { number: 94, symbol: 'Pu', name: 'Plutonium', mass: 244, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 24, 8, 2], electronegativity: 1.28, radius: 175, melt: 640, boil: 3228, density: 19.84, discovered: 1940, discoverer: 'Glenn T. Seaborg', description: 'Used in nuclear weapons and spacecraft power. Extremely toxic.' },
            { number: 95, symbol: 'Am', name: 'Americium', mass: 243, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 25, 8, 2], electronegativity: 1.30, radius: 175, melt: 1176, boil: 2011, density: 13.69, discovered: 1944, discoverer: 'Glenn T. Seaborg', description: 'Used in smoke detectors. Named after the Americas.' },
            { number: 96, symbol: 'Cm', name: 'Curium', mass: 247, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 25, 9, 2], electronegativity: 1.30, radius: 169, melt: 1345, boil: 3110, density: 13.51, discovered: 1944, discoverer: 'Glenn T. Seaborg', description: 'Named after Marie and Pierre Curie. Used in space exploration.' },
            { number: 97, symbol: 'Bk', name: 'Berkelium', mass: 247, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 27, 8, 2], electronegativity: 1.30, radius: 170, melt: 1050, boil: 2627, density: 14.78, discovered: 1949, discoverer: 'Glenn T. Seaborg', description: 'Named after Berkeley, California. Produced in nuclear reactors.' },
            { number: 98, symbol: 'Cf', name: 'Californium', mass: 251, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 28, 8, 2], electronegativity: 1.30, radius: 186, melt: 900, boil: 1472, density: 15.10, discovered: 1950, discoverer: 'Glenn T. Seaborg', description: 'Used in nuclear reactors and cancer treatment.' },
            { number: 99, symbol: 'Es', name: 'Einsteinium', mass: 252, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 29, 8, 2], electronegativity: 1.30, radius: 186, melt: 860, boil: 996, density: 8.84, discovered: 1952, discoverer: 'Albert Ghiorso', description: 'Named after Albert Einstein. Discovered in nuclear fallout.' },
            { number: 100, symbol: 'Fm', name: 'Fermium', mass: 257, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 30, 8, 2], electronegativity: 1.30, radius: 186, melt: 1527, boil: null, density: null, discovered: 1952, discoverer: 'Albert Ghiorso', description: 'Named after Enrico Fermi. Only produced in tiny quantities.' },
            { number: 101, symbol: 'Md', name: 'Mendelevium', mass: 258, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 31, 8, 2], electronegativity: 1.30, radius: 186, melt: 827, boil: null, density: null, discovered: 1955, discoverer: 'Albert Ghiorso', description: 'Named after Dmitri Mendeleev, creator of periodic table.' },
            { number: 102, symbol: 'No', name: 'Nobelium', mass: 259, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 32, 8, 2], electronegativity: 1.30, radius: 186, melt: 827, boil: null, density: null, discovered: 1958, discoverer: 'Albert Ghiorso', description: 'Named after Alfred Nobel. Extremely short half-life.' },
            { number: 103, symbol: 'Lr', name: 'Lawrencium', mass: 262, category: 'actinide', group: 3, period: 7, electrons: [2, 8, 18, 32, 32, 8, 3], electronegativity: 1.30, radius: 186, melt: 1627, boil: null, density: null, discovered: 1961, discoverer: 'Albert Ghiorso', description: 'Named after Ernest Lawrence. Last actinide element.' },
            { number: 104, symbol: 'Rf', name: 'Rutherfordium', mass: 267, category: 'transition', group: 4, period: 7, electrons: [2, 8, 18, 32, 32, 10, 2], electronegativity: null, radius: 157, melt: null, boil: null, density: 23.2, discovered: 1964, discoverer: 'Joint Institute for Nuclear Research', description: 'First transactinide element. Named after Ernest Rutherford.' },
            { number: 105, symbol: 'Db', name: 'Dubnium', mass: 268, category: 'transition', group: 5, period: 7, electrons: [2, 8, 18, 32, 32, 11, 2], electronegativity: null, radius: 149, melt: null, boil: null, density: 29.3, discovered: 1967, discoverer: 'Joint Institute for Nuclear Research', description: 'Named after Dubna, Russia. Highly unstable.' },
            { number: 106, symbol: 'Sg', name: 'Seaborgium', mass: 271, category: 'transition', group: 6, period: 7, electrons: [2, 8, 18, 32, 32, 12, 2], electronegativity: null, radius: 143, melt: null, boil: null, density: 35.0, discovered: 1974, discoverer: 'Albert Ghiorso', description: 'Named after Glenn T. Seaborg while he was still alive.' },
            { number: 107, symbol: 'Bh', name: 'Bohrium', mass: 270, category: 'transition', group: 7, period: 7, electrons: [2, 8, 18, 32, 32, 13, 2], electronegativity: null, radius: 141, melt: null, boil: null, density: 37.1, discovered: 1981, discoverer: 'Peter Armbruster', description: 'Named after Niels Bohr. Extremely short-lived.' },
            { number: 108, symbol: 'Hs', name: 'Hassium', mass: 277, category: 'transition', group: 8, period: 7, electrons: [2, 8, 18, 32, 32, 14, 2], electronegativity: null, radius: 134, melt: null, boil: null, density: 40.7, discovered: 1984, discoverer: 'Peter Armbruster', description: 'Named after Hesse, Germany. Densest element predicted.' },
            { number: 109, symbol: 'Mt', name: 'Meitnerium', mass: 276, category: 'transition', group: 9, period: 7, electrons: [2, 8, 18, 32, 32, 15, 2], electronegativity: null, radius: 129, melt: null, boil: null, density: 37.4, discovered: 1982, discoverer: 'Peter Armbruster', description: 'Named after Lise Meitner, nuclear physics pioneer.' },
            { number: 110, symbol: 'Ds', name: 'Darmstadtium', mass: 281, category: 'transition', group: 10, period: 7, electrons: [2, 8, 18, 32, 32, 16, 2], electronegativity: null, radius: 128, melt: null, boil: null, density: 34.8, discovered: 1994, discoverer: 'Sigurd Hofmann', description: 'Named after Darmstadt, Germany. Extremely unstable.' },
            { number: 111, symbol: 'Rg', name: 'Roentgenium', mass: 280, category: 'transition', group: 11, period: 7, electrons: [2, 8, 18, 32, 32, 17, 2], electronegativity: null, radius: 121, melt: null, boil: null, density: 28.7, discovered: 1994, discoverer: 'Sigurd Hofmann', description: 'Named after Wilhelm Roentgen, discoverer of X-rays.' },
            { number: 112, symbol: 'Cn', name: 'Copernicium', mass: 285, category: 'transition', group: 12, period: 7, electrons: [2, 8, 18, 32, 32, 18, 2], electronegativity: null, radius: 122, melt: null, boil: null, density: 23.7, discovered: 1996, discoverer: 'Sigurd Hofmann', description: 'Named after Nicolaus Copernicus. May be a gas at room temperature.' },
            { number: 113, symbol: 'Nh', name: 'Nihonium', mass: 284, category: 'post-transition', group: 13, period: 7, electrons: [2, 8, 18, 32, 32, 18, 3], electronegativity: null, radius: 136, melt: null, boil: null, density: 16, discovered: 2004, discoverer: 'RIKEN', description: 'First element discovered in Asia. Named after Japan (Nihon).' },
            { number: 114, symbol: 'Fl', name: 'Flerovium', mass: 289, category: 'post-transition', group: 14, period: 7, electrons: [2, 8, 18, 32, 32, 18, 4], electronegativity: null, radius: 143, melt: null, boil: null, density: 14, discovered: 1998, discoverer: 'Joint Institute for Nuclear Research', description: 'Named after Flerov Laboratory. May be unusually volatile.' },
            { number: 115, symbol: 'Mc', name: 'Moscovium', mass: 288, category: 'post-transition', group: 15, period: 7, electrons: [2, 8, 18, 32, 32, 18, 5], electronegativity: null, radius: 162, melt: null, boil: null, density: 13.5, discovered: 2003, discoverer: 'Joint Institute for Nuclear Research', description: 'Named after Moscow. Highly unstable superheavy element.' },
            { number: 116, symbol: 'Lv', name: 'Livermorium', mass: 293, category: 'post-transition', group: 16, period: 7, electrons: [2, 8, 18, 32, 32, 18, 6], electronegativity: null, radius: 175, melt: null, boil: null, density: 12.9, discovered: 2000, discoverer: 'Joint Institute for Nuclear Research', description: 'Named after Lawrence Livermore National Laboratory.' },
            { number: 117, symbol: 'Ts', name: 'Tennessine', mass: 294, category: 'halogen', group: 17, period: 7, electrons: [2, 8, 18, 32, 32, 18, 7], electronegativity: null, radius: 165, melt: null, boil: null, density: 7.2, discovered: 2010, discoverer: 'Joint Institute for Nuclear Research', description: 'Named after Tennessee. Second-heaviest halogen.' },
            { number: 118, symbol: 'Og', name: 'Oganesson', mass: 294, category: 'noble', group: 18, period: 7, electrons: [2, 8, 18, 32, 32, 18, 8], electronegativity: null, radius: 157, melt: null, boil: null, density: 5, discovered: 2002, discoverer: 'Joint Institute for Nuclear Research', description: 'Named after Yuri Oganessian. Heaviest known element.' }
        ];

        // Category colors
        const categoryColors = {
            'alkali': '#ff6b6b',
            'alkaline': '#feca57',
            'transition': '#54a0ff',
            'post-transition': '#5f27cd',
            'metalloid': '#00d2d3',
            'nonmetal': '#1dd1a1',
            'halogen': '#10ac84',
            'noble': '#a29bfe',
            'lanthanide': '#48dbfb',
            'actinide': '#ff9ff3'
        };

        // Known compounds database - extensive list
        const compounds = {
            // Water and hydrogen compounds
            'H-O': { formula: 'HO', name: 'Water', molarMass: 18.015, type: 'Covalent', description: 'Essential for all known life. Covers 71% of Earth surface.' },
            'H-H-O': { formula: 'HO', name: 'Water', molarMass: 18.015, type: 'Covalent', description: 'Essential for all known life. Covers 71% of Earth surface.' },
            'H-O-O': { formula: 'HO', name: 'Hydrogen Peroxide', molarMass: 34.01, type: 'Covalent', description: 'Bleaching agent and disinfectant. Decomposes to water and oxygen.' },
            
            // Salts and ionic compounds
            'Na-Cl': { formula: 'NaCl', name: 'Sodium Chloride (Table Salt)', molarMass: 58.44, type: 'Ionic', description: 'Common table salt. Essential for human health.' },
            'K-Cl': { formula: 'KCl', name: 'Potassium Chloride', molarMass: 74.55, type: 'Ionic', description: 'Salt substitute. Used in medicine and fertilizers.' },
            'K-Br': { formula: 'KBr', name: 'Potassium Bromide', molarMass: 119.00, type: 'Ionic', description: 'Used in photography and as anticonvulsant.' },
            'K-I': { formula: 'KI', name: 'Potassium Iodide', molarMass: 166.00, type: 'Ionic', description: 'Radiation protection. Used in iodized salt.' },
            'Na-Br': { formula: 'NaBr', name: 'Sodium Bromide', molarMass: 102.89, type: 'Ionic', description: 'Used in photography and medicine.' },
            'Na-I': { formula: 'NaI', name: 'Sodium Iodide', molarMass: 149.89, type: 'Ionic', description: 'Used in radiation detection and medicine.' },
            'Na-F': { formula: 'NaF', name: 'Sodium Fluoride', molarMass: 41.99, type: 'Ionic', description: 'Used in toothpaste and water fluoridation.' },
            'Ca-Cl': { formula: 'CaCl', name: 'Calcium Chloride', molarMass: 110.98, type: 'Ionic', description: 'De-icing agent. Used in food preservation.' },
            'Ca-F': { formula: 'CaF', name: 'Calcium Fluoride (Fluorite)', molarMass: 78.07, type: 'Ionic', description: 'Mineral fluorite. Used in optics and metallurgy.' },
            'Mg-Cl': { formula: 'MgCl', name: 'Magnesium Chloride', molarMass: 95.21, type: 'Ionic', description: 'De-icing agent. Found in seawater.' },
            'Ba-Cl': { formula: 'BaCl', name: 'Barium Chloride', molarMass: 208.23, type: 'Ionic', description: 'Used in fireworks and water treatment.' },
            'Ba-S-O': { formula: 'BaSO', name: 'Barium Sulfate', molarMass: 233.43, type: 'Ionic', description: 'Used in X-ray imaging (barium meal).' },
            'Li-Cl': { formula: 'LiCl', name: 'Lithium Chloride', molarMass: 42.39, type: 'Ionic', description: 'Used in air conditioning and as desiccant.' },
            'Li-F': { formula: 'LiF', name: 'Lithium Fluoride', molarMass: 25.94, type: 'Ionic', description: 'Used in optics and radiation dosimetry.' },
            
            // Acids
            'H-Cl': { formula: 'HCl', name: 'Hydrochloric Acid', molarMass: 36.46, type: 'Covalent', description: 'Strong acid found in gastric juice. Used in industry.' },
            'H-F': { formula: 'HF', name: 'Hydrofluoric Acid', molarMass: 20.01, type: 'Covalent', description: 'Extremely corrosive. Used to etch glass.' },
            'H-Br': { formula: 'HBr', name: 'Hydrobromic Acid', molarMass: 80.91, type: 'Covalent', description: 'Strong acid used in organic synthesis.' },
            'H-I': { formula: 'HI', name: 'Hydroiodic Acid', molarMass: 127.91, type: 'Covalent', description: 'Strong acid. Reducing agent.' },
            'H-N-O': { formula: 'HNO', name: 'Nitric Acid', molarMass: 63.01, type: 'Covalent', description: 'Strong acid used in fertilizers and explosives.' },
            'H-S-O': { formula: 'HSO', name: 'Sulfuric Acid', molarMass: 98.08, type: 'Covalent', description: 'Most produced chemical. Used in batteries and fertilizers.' },
            'H-P-O': { formula: 'HPO', name: 'Phosphoric Acid', molarMass: 98.00, type: 'Covalent', description: 'Used in soft drinks, fertilizers, and rust removal.' },
            'H-C-O': { formula: 'HCO', name: 'Carbonic Acid', molarMass: 62.03, type: 'Covalent', description: 'Weak acid in carbonated drinks. Blood buffer.' },
            
            // Bases
            'Na-O-H': { formula: 'NaOH', name: 'Sodium Hydroxide', molarMass: 40.00, type: 'Ionic', description: 'Caustic soda. Used in soap making and drain cleaner.' },
            'K-O-H': { formula: 'KOH', name: 'Potassium Hydroxide', molarMass: 56.11, type: 'Ionic', description: 'Caustic potash. Used in soap and batteries.' },
            'Ca-O-H': { formula: 'Ca(OH)', name: 'Calcium Hydroxide', molarMass: 74.09, type: 'Ionic', description: 'Slaked lime. Used in construction and water treatment.' },
            'Mg-O-H': { formula: 'Mg(OH)', name: 'Magnesium Hydroxide', molarMass: 58.32, type: 'Ionic', description: 'Milk of magnesia. Antacid and laxative.' },
            'Al-O-H': { formula: 'Al(OH)', name: 'Aluminum Hydroxide', molarMass: 78.00, type: 'Ionic', description: 'Antacid. Used in water purification.' },
            'N-H': { formula: 'NH', name: 'Ammonia', molarMass: 17.03, type: 'Covalent', description: 'Used in fertilizers and cleaning products.' },
            'H-N': { formula: 'NH', name: 'Ammonia', molarMass: 17.03, type: 'Covalent', description: 'Used in fertilizers and cleaning products.' },
            
            // Oxides
            'C-O': { formula: 'CO', name: 'Carbon Dioxide', molarMass: 44.01, type: 'Covalent', description: 'Greenhouse gas. Used by plants in photosynthesis.' },
            'C-O-O': { formula: 'CO', name: 'Carbon Dioxide', molarMass: 44.01, type: 'Covalent', description: 'Greenhouse gas. Used by plants in photosynthesis.' },
            'S-O': { formula: 'SO', name: 'Sulfur Dioxide', molarMass: 64.07, type: 'Covalent', description: 'Volcanic gas. Used in food preservation.' },
            'S-O-O': { formula: 'SO', name: 'Sulfur Trioxide', molarMass: 80.06, type: 'Covalent', description: 'Precursor to sulfuric acid. Air pollutant.' },
            'N-O': { formula: 'NO', name: 'Nitrogen Dioxide', molarMass: 46.01, type: 'Covalent', description: 'Brown gas. Air pollutant from vehicles.' },
            'N-O-O': { formula: 'NO', name: 'Nitrous Oxide', molarMass: 44.01, type: 'Covalent', description: 'Laughing gas. Anesthetic and greenhouse gas.' },
            'Fe-O': { formula: 'FeO', name: 'Iron(III) Oxide (Rust)', molarMass: 159.69, type: 'Ionic', description: 'Common rust. Red-brown color. Used as pigment.' },
            'Fe-O-O': { formula: 'FeO', name: 'Magnetite', molarMass: 231.53, type: 'Ionic', description: 'Magnetic iron ore. Used in recording media.' },
            'Ca-O': { formula: 'CaO', name: 'Calcium Oxide (Quicklite)', molarMass: 56.08, type: 'Ionic', description: 'Used in cement and steelmaking.' },
            'Mg-O': { formula: 'MgO', name: 'Magnesium Oxide', molarMass: 40.30, type: 'Ionic', description: 'Used as antacid and in refractory materials.' },
            'Al-O': { formula: 'AlO', name: 'Aluminum Oxide (Corundum)', molarMass: 101.96, type: 'Ionic', description: 'Rubies and sapphires are varieties. Very hard.' },
            'Si-O': { formula: 'SiO', name: 'Silicon Dioxide (Silica)', molarMass: 60.08, type: 'Covalent', description: 'Main component of sand and glass.' },
            'Ti-O': { formula: 'TiO', name: 'Titanium Dioxide', molarMass: 79.87, type: 'Ionic', description: 'White pigment in paint and sunscreen.' },
            'Zn-O': { formula: 'ZnO', name: 'Zinc Oxide', molarMass: 81.38, type: 'Ionic', description: 'Used in sunscreen and rubber production.' },
            'Cu-O': { formula: 'CuO', name: 'Copper(II) Oxide', molarMass: 79.55, type: 'Ionic', description: 'Black powder. Used in ceramics and batteries.' },
            'Pb-O': { formula: 'PbO', name: 'Lead(II) Oxide', molarMass: 223.2, type: 'Ionic', description: 'Used in lead-acid batteries and glass.' },
            'Mn-O': { formula: 'MnO', name: 'Manganese Dioxide', molarMass: 86.94, type: 'Ionic', description: 'Used in batteries and as oxidizer.' },
            'Cr-O': { formula: 'CrO', name: 'Chromium(III) Oxide', molarMass: 151.99, type: 'Ionic', description: 'Green pigment. Used in metallurgy.' },
            'Co-O': { formula: 'CoO', name: 'Cobalt(II) Oxide', molarMass: 74.93, type: 'Ionic', description: 'Blue pigment. Used in ceramics.' },
            'Ni-O': { formula: 'NiO', name: 'Nickel(II) Oxide', molarMass: 74.69, type: 'Ionic', description: 'Green powder. Used in ceramics and batteries.' },
            'Sn-O': { formula: 'SnO', name: 'Tin(IV) Oxide', molarMass: 150.71, type: 'Ionic', description: 'Used in ceramics and gas sensors.' },
            'K-O': { formula: 'KO', name: 'Potassium Oxide', molarMass: 94.20, type: 'Ionic', description: 'Used in fertilizers and glass making.' },
            'Na-O': { formula: 'NaO', name: 'Sodium Oxide', molarMass: 61.98, type: 'Ionic', description: 'Used in glass and ceramics.' },
            'Li-O': { formula: 'LiO', name: 'Lithium Oxide', molarMass: 29.88, type: 'Ionic', description: 'Used in ceramics and as CO absorber.' },
            
            // Sulfides
            'H-S': { formula: 'HS', name: 'Hydrogen Sulfide', molarMass: 34.08, type: 'Covalent', description: 'Toxic gas with rotten egg smell.' },
            'Cu-S': { formula: 'CuS', name: 'Copper(II) Sulfide', molarMass: 95.61, type: 'Ionic', description: 'Black mineral. Copper ore.' },
            'Fe-S': { formula: 'FeS', name: 'Iron(II) Sulfide', molarMass: 87.91, type: 'Ionic', description: 'Pyrite (fools gold) is FeS.' },
            'Zn-S': { formula: 'ZnS', name: 'Zinc Sulfide', molarMass: 97.47, type: 'Ionic', description: 'Phosphorescent. Used in glow-in-dark materials.' },
            'Pb-S': { formula: 'PbS', name: 'Lead(II) Sulfide (Galena)', molarMass: 239.30, type: 'Ionic', description: 'Lead ore. Used in early radio detectors.' },
            'Ag-S': { formula: 'AgS', name: 'Silver Sulfide', molarMass: 247.80, type: 'Ionic', description: 'Black tarnish on silver.' },
            'Na-S': { formula: 'NaS', name: 'Sodium Sulfide', molarMass: 78.04, type: 'Ionic', description: 'Used in leather tanning and dyes.' },
            'Ca-S': { formula: 'CaS', name: 'Calcium Sulfide', molarMass: 72.14, type: 'Ionic', description: 'Phosphorescent. Used in luminous paints.' },
            
            // Carbonates
            'Ca-C-O': { formula: 'CaCO', name: 'Calcium Carbonate', molarMass: 100.09, type: 'Ionic', description: 'Found in limestone, marble, and seashells.' },
            'Na-C-O': { formula: 'NaCO', name: 'Sodium Carbonate (Soda Ash)', molarMass: 105.99, type: 'Ionic', description: 'Used in glass making and detergents.' },
            'K-C-O': { formula: 'KCO', name: 'Potassium Carbonate', molarMass: 138.21, type: 'Ionic', description: 'Used in soap and glass making.' },
            'Mg-C-O': { formula: 'MgCO', name: 'Magnesium Carbonate', molarMass: 84.31, type: 'Ionic', description: 'Antacid. Used in chalk and talcum powder.' },
            'Ba-C-O': { formula: 'BaCO', name: 'Barium Carbonate', molarMass: 197.34, type: 'Ionic', description: 'Used in ceramics and rat poison.' },
            'Li-C-O': { formula: 'LiCO', name: 'Lithium Carbonate', molarMass: 73.89, type: 'Ionic', description: 'Used to treat bipolar disorder.' },
            'Cu-C-O': { formula: 'CuCO', name: 'Copper Carbonate', molarMass: 123.55, type: 'Ionic', description: 'Green patina on copper. Malachite mineral.' },
            'Zn-C-O': { formula: 'ZnCO', name: 'Zinc Carbonate', molarMass: 125.39, type: 'Ionic', description: 'Smithsonite mineral. Calamine lotion.' },
            
            // Nitrates
            'K-N-O': { formula: 'KNO', name: 'Potassium Nitrate', molarMass: 101.10, type: 'Ionic', description: 'Saltpeter. Used in gunpowder and fertilizers.' },
            'Na-N-O': { formula: 'NaNO', name: 'Sodium Nitrate', molarMass: 84.99, type: 'Ionic', description: 'Chilean saltpeter. Used in fertilizers.' },
            'Ca-N-O': { formula: 'Ca(NO)', name: 'Calcium Nitrate', molarMass: 164.09, type: 'Ionic', description: 'Fertilizer. Used in cold packs.' },
            'Ag-N-O': { formula: 'AgNO', name: 'Silver Nitrate', molarMass: 169.87, type: 'Ionic', description: 'Used in photography and medicine.' },
            'Cu-N-O': { formula: 'Cu(NO)', name: 'Copper(II) Nitrate', molarMass: 187.56, type: 'Ionic', description: 'Blue crystals. Used in fireworks.' },
            'Pb-N-O': { formula: 'Pb(NO)', name: 'Lead(II) Nitrate', molarMass: 331.21, type: 'Ionic', description: 'Used in fireworks and matches.' },
            'Fe-N-O': { formula: 'Fe(NO)', name: 'Iron(III) Nitrate', molarMass: 241.86, type: 'Ionic', description: 'Used as mordant in dyeing.' },
            
            // Sulfates
            'Cu-S-O': { formula: 'CuSO', name: 'Copper Sulfate', molarMass: 159.61, type: 'Ionic', description: 'Blue vitriol. Used as fungicide.' },
            'Fe-S-O': { formula: 'FeSO', name: 'Iron(II) Sulfate', molarMass: 151.91, type: 'Ionic', description: 'Green vitriol. Iron supplement.' },
            'Zn-S-O': { formula: 'ZnSO', name: 'Zinc Sulfate', molarMass: 161.47, type: 'Ionic', description: 'White vitriol. Dietary supplement.' },
            'Mg-S-O': { formula: 'MgSO', name: 'Magnesium Sulfate (Epsom Salt)', molarMass: 120.37, type: 'Ionic', description: 'Used in bath salts and as laxative.' },
            'Ca-S-O': { formula: 'CaSO', name: 'Calcium Sulfate (Gypsum)', molarMass: 136.14, type: 'Ionic', description: 'Used in plaster and drywall.' },
            'Na-S-O': { formula: 'NaSO', name: 'Sodium Sulfate', molarMass: 142.04, type: 'Ionic', description: 'Glaubers salt. Used in detergents.' },
            'K-S-O': { formula: 'KSO', name: 'Potassium Sulfate', molarMass: 174.26, type: 'Ionic', description: 'Important fertilizer.' },
            'Al-S-O': { formula: 'Al(SO)', name: 'Aluminum Sulfate', molarMass: 342.15, type: 'Ionic', description: 'Used in water treatment and dyeing.' },
            'Pb-S-O': { formula: 'PbSO', name: 'Lead(II) Sulfate', molarMass: 303.26, type: 'Ionic', description: 'Forms in lead-acid batteries.' },
            
            // Phosphates
            'Ca-P-O': { formula: 'Ca(PO)', name: 'Calcium Phosphate', molarMass: 310.18, type: 'Ionic', description: 'Main component of bones and teeth.' },
            'Na-P-O': { formula: 'NaPO', name: 'Trisodium Phosphate', molarMass: 163.94, type: 'Ionic', description: 'Cleaning agent and food additive.' },
            'K-P-O': { formula: 'KPO', name: 'Potassium Phosphate', molarMass: 212.27, type: 'Ionic', description: 'Fertilizer and food additive.' },
            
            // Chlorides
            'Ag-Cl': { formula: 'AgCl', name: 'Silver Chloride', molarMass: 143.32, type: 'Ionic', description: 'Used in photography and electrochemistry.' },
            'Cu-Cl': { formula: 'CuCl', name: 'Copper(II) Chloride', molarMass: 134.45, type: 'Ionic', description: 'Green/blue. Used in fireworks.' },
            'Fe-Cl': { formula: 'FeCl', name: 'Iron(III) Chloride', molarMass: 162.20, type: 'Ionic', description: 'Used in water treatment and etching.' },
            'Zn-Cl': { formula: 'ZnCl', name: 'Zinc Chloride', molarMass: 136.30, type: 'Ionic', description: 'Used in soldering flux and batteries.' },
            'Al-Cl': { formula: 'AlCl', name: 'Aluminum Chloride', molarMass: 133.34, type: 'Ionic', description: 'Catalyst. Used in antiperspirants.' },
            'Sn-Cl': { formula: 'SnCl', name: 'Tin(II) Chloride', molarMass: 189.62, type: 'Ionic', description: 'Reducing agent. Used in tin plating.' },
            'Pb-Cl': { formula: 'PbCl', name: 'Lead(II) Chloride', molarMass: 278.11, type: 'Ionic', description: 'White precipitate. Slightly soluble.' },
            'Hg-Cl': { formula: 'HgCl', name: 'Mercury(II) Chloride', molarMass: 271.52, type: 'Ionic', description: 'Highly toxic. Historical antiseptic.' },
            'Mn-Cl': { formula: 'MnCl', name: 'Manganese(II) Chloride', molarMass: 125.84, type: 'Ionic', description: 'Pink crystals. Used in batteries.' },
            'Co-Cl': { formula: 'CoCl', name: 'Cobalt(II) Chloride', molarMass: 129.84, type: 'Ionic', description: 'Blue when dry, pink when wet. Humidity indicator.' },
            'Ni-Cl': { formula: 'NiCl', name: 'Nickel(II) Chloride', molarMass: 129.60, type: 'Ionic', description: 'Green crystals. Used in electroplating.' },
            'Cr-Cl': { formula: 'CrCl', name: 'Chromium(III) Chloride', molarMass: 158.36, type: 'Ionic', description: 'Purple crystals. Used in chrome plating.' },
            'Au-Cl': { formula: 'AuCl', name: 'Gold(III) Chloride', molarMass: 303.33, type: 'Ionic', description: 'Used in gold plating and analysis.' },
            'Pt-Cl': { formula: 'PtCl', name: 'Platinum(IV) Chloride', molarMass: 336.89, type: 'Ionic', description: 'Used as catalyst precursor.' },
            
            // Hydrocarbons and organic-like
            'H-C': { formula: 'CH', name: 'Methane', molarMass: 16.04, type: 'Covalent', description: 'Natural gas. Potent greenhouse gas.' },
            'C-H': { formula: 'CH', name: 'Methane', molarMass: 16.04, type: 'Covalent', description: 'Natural gas. Potent greenhouse gas.' },
            'C-H-O': { formula: 'CHOH', name: 'Ethanol', molarMass: 46.07, type: 'Covalent', description: 'Drinking alcohol. Fuel and solvent.' },
            'C-H-H': { formula: 'CH', name: 'Ethane', molarMass: 30.07, type: 'Covalent', description: 'Component of natural gas.' },
            'C-C': { formula: 'C (Diamond/Graphite)', name: 'Carbon Allotropes', molarMass: 12.01, type: 'Covalent', description: 'Diamond and graphite are carbon allotropes.' },
            'C-N': { formula: 'HCN', name: 'Hydrogen Cyanide', molarMass: 27.03, type: 'Covalent', description: 'Extremely toxic. Used in chemical synthesis.' },
            'C-Cl': { formula: 'CCl', name: 'Carbon Tetrachloride', molarMass: 153.82, type: 'Covalent', description: 'Former solvent. Ozone depleting.' },
            
            // Cyanides
            'K-C-N': { formula: 'KCN', name: 'Potassium Cyanide', molarMass: 65.12, type: 'Ionic', description: 'Highly toxic. Used in gold extraction.' },
            'Na-C-N': { formula: 'NaCN', name: 'Sodium Cyanide', molarMass: 49.01, type: 'Ionic', description: 'Highly toxic. Used in gold mining.' },
            
            // Peroxides
            'Na-O-O': { formula: 'NaO', name: 'Sodium Peroxide', molarMass: 77.98, type: 'Ionic', description: 'Strong oxidizer. Used in bleaching.' },
            'Ba-O-O': { formula: 'BaO', name: 'Barium Peroxide', molarMass: 169.33, type: 'Ionic', description: 'Used in fireworks and as oxidizer.' },
            
            // Acetates
            'Na-C-H-O': { formula: 'CHCOONa', name: 'Sodium Acetate', molarMass: 82.03, type: 'Ionic', description: 'Used in hand warmers and food preservation.' },
            'Cu-C-H-O': { formula: 'Cu(CHCOO)', name: 'Copper Acetate', molarMass: 181.63, type: 'Ionic', description: 'Verdigris. Green pigment.' },
            'Pb-C-H-O': { formula: 'Pb(CHCOO)', name: 'Lead Acetate', molarMass: 325.29, type: 'Ionic', description: 'Sugar of lead. Sweet but toxic.' },
            'Ca-C-H-O': { formula: 'Ca(CHCOO)', name: 'Calcium Acetate', molarMass: 158.17, type: 'Ionic', description: 'Used in food preservation.' },
            
            // Chromates
            'K-Cr-O': { formula: 'KCrO', name: 'Potassium Chromate', molarMass: 194.19, type: 'Ionic', description: 'Yellow color. Used in dyes.' },
            'Na-Cr-O': { formula: 'NaCrO', name: 'Sodium Chromate', molarMass: 161.97, type: 'Ionic', description: 'Yellow. Corrosion inhibitor.' },
            'Pb-Cr-O': { formula: 'PbCrO', name: 'Lead Chromate', molarMass: 323.19, type: 'Ionic', description: 'Chrome yellow pigment.' },
            
            // Permanganates
            'K-Mn-O': { formula: 'KMnO', name: 'Potassium Permanganate', molarMass: 158.03, type: 'Ionic', description: 'Purple. Strong oxidizer. Disinfectant.' },
            
            // Bromides
            'Ag-Br': { formula: 'AgBr', name: 'Silver Bromide', molarMass: 187.77, type: 'Ionic', description: 'Light sensitive. Used in photography.' },
            'Cu-Br': { formula: 'CuBr', name: 'Copper(II) Bromide', molarMass: 223.35, type: 'Ionic', description: 'Used in photography and organic synthesis.' },
            'Ca-Br': { formula: 'CaBr', name: 'Calcium Bromide', molarMass: 199.89, type: 'Ionic', description: 'Used in drilling fluids.' },
            'Mg-Br': { formula: 'MgBr', name: 'Magnesium Bromide', molarMass: 184.11, type: 'Ionic', description: 'Used in organic synthesis.' },
            
            // Iodides
            'Ag-I': { formula: 'AgI', name: 'Silver Iodide', molarMass: 234.77, type: 'Ionic', description: 'Used in cloud seeding and photography.' },
            'Pb-I': { formula: 'PbI', name: 'Lead(II) Iodide', molarMass: 461.01, type: 'Ionic', description: 'Bright yellow precipitate.' },
            'Cu-I': { formula: 'CuI', name: 'Copper(I) Iodide', molarMass: 190.45, type: 'Ionic', description: 'White powder. Used in organic synthesis.' },
            'Hg-I': { formula: 'HgI', name: 'Mercury(II) Iodide', molarMass: 454.40, type: 'Ionic', description: 'Red/yellow. Used in thermometers.' },
            'Ca-I': { formula: 'CaI', name: 'Calcium Iodide', molarMass: 293.89, type: 'Ionic', description: 'Used in photography.' },
            
            // Fluorides
            'Ca-F': { formula: 'CaF', name: 'Calcium Fluoride', molarMass: 78.07, type: 'Ionic', description: 'Fluorite mineral. Used in optics.' },
            'Al-F': { formula: 'AlF', name: 'Aluminum Fluoride', molarMass: 83.98, type: 'Ionic', description: 'Used in aluminum production.' },
            'Mg-F': { formula: 'MgF', name: 'Magnesium Fluoride', molarMass: 62.30, type: 'Ionic', description: 'Used in optical coatings.' },
            'Ba-F': { formula: 'BaF', name: 'Barium Fluoride', molarMass: 175.32, type: 'Ionic', description: 'Used in optics and radiation detection.' },
            
            // More common compounds
            'Na-H-C-O': { formula: 'NaHCO', name: 'Sodium Bicarbonate (Baking Soda)', molarMass: 84.01, type: 'Ionic', description: 'Used in baking, cleaning, and as antacid.' },
            'K-H-C-O': { formula: 'KHCO', name: 'Potassium Bicarbonate', molarMass: 100.12, type: 'Ionic', description: 'Used in baking and fire extinguishers.' },
            'Mg-H-O': { formula: 'Mg(OH)', name: 'Magnesium Hydroxide', molarMass: 58.32, type: 'Ionic', description: 'Milk of magnesia. Antacid.' },
            
            // Borates
            'Na-B-O': { formula: 'NaBO', name: 'Borax', molarMass: 201.22, type: 'Ionic', description: 'Used in cleaning and as flux.' },
            
            // Silicates
            'Na-Si-O': { formula: 'NaSiO', name: 'Sodium Silicate', molarMass: 122.06, type: 'Ionic', description: 'Water glass. Used as adhesive and sealant.' },
            'Ca-Si-O': { formula: 'CaSiO', name: 'Calcium Silicate', molarMass: 116.16, type: 'Ionic', description: 'Used in cement and insulation.' },
            
            // Arsenates and others
            'As-O': { formula: 'AsO', name: 'Arsenic Trioxide', molarMass: 197.84, type: 'Covalent', description: 'Highly toxic. Historical poison.' },
            'Sb-O': { formula: 'SbO', name: 'Antimony Trioxide', molarMass: 291.52, type: 'Ionic', description: 'Flame retardant.' },
            'Bi-O': { formula: 'BiO', name: 'Bismuth Trioxide', molarMass: 465.96, type: 'Ionic', description: 'Yellow pigment. Used in ceramics.' },
            'Se-O': { formula: 'SeO', name: 'Selenium Dioxide', molarMass: 110.96, type: 'Covalent', description: 'Used in glass making.' },
            'Te-O': { formula: 'TeO', name: 'Tellurium Dioxide', molarMass: 159.60, type: 'Ionic', description: 'Used in acousto-optic devices.' },
            
            // Tungstates and Molybdates
            'Ca-W-O': { formula: 'CaWO', name: 'Calcium Tungstate', molarMass: 287.92, type: 'Ionic', description: 'Scheelite mineral. Fluoresces under UV.' },
            'Na-W-O': { formula: 'NaWO', name: 'Sodium Tungstate', molarMass: 293.82, type: 'Ionic', description: 'Used in fireproofing and dyes.' },
            'Pb-Mo-O': { formula: 'PbMoO', name: 'Lead Molybdate', molarMass: 367.14, type: 'Ionic', description: 'Wulfenite mineral. Orange crystals.' },
            'Ca-Mo-O': { formula: 'CaMoO', name: 'Calcium Molybdate', molarMass: 200.02, type: 'Ionic', description: 'Powellite mineral.' },
            
            // Vanadates
            'Pb-V-O': { formula: 'Pb(VO)Cl', name: 'Vanadinite', molarMass: 1416.27, type: 'Ionic', description: 'Lead vanadate mineral. Red-orange crystals.' },
            'Na-V-O': { formula: 'NaVO', name: 'Sodium Vanadate', molarMass: 121.93, type: 'Ionic', description: 'Used in ceramics and as catalyst.' },
            
            // Titanates
            'Ba-Ti-O': { formula: 'BaTiO', name: 'Barium Titanate', molarMass: 233.19, type: 'Ionic', description: 'Piezoelectric. Used in capacitors.' },
            'Ca-Ti-O': { formula: 'CaTiO', name: 'Calcium Titanate (Perovskite)', molarMass: 135.94, type: 'Ionic', description: 'Important mineral structure.' },
            'Sr-Ti-O': { formula: 'SrTiO', name: 'Strontium Titanate', molarMass: 183.49, type: 'Ionic', description: 'Diamond simulant. Very high refractive index.' },
            'Pb-Ti-O': { formula: 'PbTiO', name: 'Lead Titanate', molarMass: 303.09, type: 'Ionic', description: 'Ferroelectric. Used in transducers.' },
            
            // Zirconates
            'Ba-Zr-O': { formula: 'BaZrO', name: 'Barium Zirconate', molarMass: 276.55, type: 'Ionic', description: 'High-temperature proton conductor.' },
            'Ca-Zr-O': { formula: 'CaZrO', name: 'Calcium Zirconate', molarMass: 179.30, type: 'Ionic', description: 'Used in refractories.' },
            'Pb-Zr-O': { formula: 'PbZrO', name: 'Lead Zirconate', molarMass: 346.41, type: 'Ionic', description: 'Antiferroelectric material.' },
            
            // Rare Earth compounds
            'La-O': { formula: 'LaO', name: 'Lanthanum Oxide', molarMass: 325.81, type: 'Ionic', description: 'Used in optics and catalysts.' },
            'Ce-O': { formula: 'CeO', name: 'Cerium Oxide', molarMass: 172.11, type: 'Ionic', description: 'Used in catalytic converters and polishing.' },
            'Nd-O': { formula: 'NdO', name: 'Neodymium Oxide', molarMass: 336.48, type: 'Ionic', description: 'Used in magnets and lasers.' },
            'Sm-O': { formula: 'SmO', name: 'Samarium Oxide', molarMass: 348.72, type: 'Ionic', description: 'Used in nuclear reactors.' },
            'Eu-O': { formula: 'EuO', name: 'Europium Oxide', molarMass: 351.92, type: 'Ionic', description: 'Red phosphor in TVs and LEDs.' },
            'Gd-O': { formula: 'GdO', name: 'Gadolinium Oxide', molarMass: 362.50, type: 'Ionic', description: 'MRI contrast agent precursor.' },
            'Tb-O': { formula: 'TbO', name: 'Terbium Oxide', molarMass: 365.85, type: 'Ionic', description: 'Green phosphor in displays.' },
            'Dy-O': { formula: 'DyO', name: 'Dysprosium Oxide', molarMass: 372.99, type: 'Ionic', description: 'Used in magnets and lasers.' },
            'Er-O': { formula: 'ErO', name: 'Erbium Oxide', molarMass: 382.52, type: 'Ionic', description: 'Pink color. Used in fiber optics.' },
            'Yb-O': { formula: 'YbO', name: 'Ytterbium Oxide', molarMass: 394.08, type: 'Ionic', description: 'Used in lasers and metallurgy.' },
            'Y-O': { formula: 'YO', name: 'Yttrium Oxide', molarMass: 225.81, type: 'Ionic', description: 'Used in YAG lasers and phosphors.' },
            'Sc-O': { formula: 'ScO', name: 'Scandium Oxide', molarMass: 137.91, type: 'Ionic', description: 'Used in high-intensity lights.' },
            
            // Actinide compounds
            'U-O': { formula: 'UO', name: 'Uranium Dioxide', molarMass: 270.03, type: 'Ionic', description: 'Nuclear fuel. Ceramic form.' },
            'U-F': { formula: 'UF', name: 'Uranium Hexafluoride', molarMass: 352.02, type: 'Covalent', description: 'Used in uranium enrichment.' },
            'Th-O': { formula: 'ThO', name: 'Thorium Dioxide', molarMass: 264.04, type: 'Ionic', description: 'Highest melting point oxide.' },
            'Pu-O': { formula: 'PuO', name: 'Plutonium Dioxide', molarMass: 276.06, type: 'Ionic', description: 'Used in nuclear reactors and RTGs.' },
            
            // Noble gas compounds
            'Xe-F': { formula: 'XeF', name: 'Xenon Difluoride', molarMass: 169.29, type: 'Covalent', description: 'First noble gas compound synthesized.' },
            'Xe-O': { formula: 'XeO', name: 'Xenon Trioxide', molarMass: 179.29, type: 'Covalent', description: 'Explosive oxidizer.' },
            'Kr-F': { formula: 'KrF', name: 'Krypton Difluoride', molarMass: 121.80, type: 'Covalent', description: 'Powerful oxidizing agent.' },
            
            // Germanium compounds
            'Ge-O': { formula: 'GeO', name: 'Germanium Dioxide', molarMass: 104.64, type: 'Covalent', description: 'Used in fiber optics and catalysts.' },
            'Ge-Cl': { formula: 'GeCl', name: 'Germanium Tetrachloride', molarMass: 214.40, type: 'Covalent', description: 'Used in semiconductor production.' },
            
            // Gallium compounds
            'Ga-As': { formula: 'GaAs', name: 'Gallium Arsenide', molarMass: 144.64, type: 'Covalent', description: 'Important semiconductor. Used in LEDs and solar cells.' },
            'Ga-N': { formula: 'GaN', name: 'Gallium Nitride', molarMass: 83.73, type: 'Covalent', description: 'Used in blue LEDs and lasers.' },
            'Ga-O': { formula: 'GaO', name: 'Gallium Oxide', molarMass: 187.44, type: 'Ionic', description: 'Wide bandgap semiconductor.' },
            
            // Indium compounds
            'In-O': { formula: 'InO', name: 'Indium Oxide', molarMass: 277.64, type: 'Ionic', description: 'Transparent conductor. Used in touchscreens.' },
            'In-Sn-O': { formula: 'ITO', name: 'Indium Tin Oxide', molarMass: 277.64, type: 'Ionic', description: 'Transparent electrode in displays.' },
            'In-As': { formula: 'InAs', name: 'Indium Arsenide', molarMass: 189.74, type: 'Covalent', description: 'Infrared detector material.' },
            'In-P': { formula: 'InP', name: 'Indium Phosphide', molarMass: 145.79, type: 'Covalent', description: 'Used in fiber optic communications.' },
            
            // Cadmium compounds
            'Cd-S': { formula: 'CdS', name: 'Cadmium Sulfide', molarMass: 144.48, type: 'Ionic', description: 'Yellow pigment. Photoconductor.' },
            'Cd-Se': { formula: 'CdSe', name: 'Cadmium Selenide', molarMass: 191.37, type: 'Ionic', description: 'Quantum dot material. Red color.' },
            'Cd-Te': { formula: 'CdTe', name: 'Cadmium Telluride', molarMass: 240.01, type: 'Ionic', description: 'Used in thin-film solar cells.' },
            'Cd-O': { formula: 'CdO', name: 'Cadmium Oxide', molarMass: 128.41, type: 'Ionic', description: 'Semiconductor. Used in batteries.' },
            'Cd-Cl': { formula: 'CdCl', name: 'Cadmium Chloride', molarMass: 183.32, type: 'Ionic', description: 'Used in photography and electroplating.' },
            
            // Thallium compounds
            'Tl-Cl': { formula: 'TlCl', name: 'Thallium(I) Chloride', molarMass: 239.84, type: 'Ionic', description: 'Historically used as rodenticide.' },
            'Tl-O': { formula: 'TlO', name: 'Thallium(III) Oxide', molarMass: 456.76, type: 'Ionic', description: 'Used in special glasses.' },
            
            // More Halogen compounds
            'Br-Cl': { formula: 'BrCl', name: 'Bromine Monochloride', molarMass: 115.36, type: 'Covalent', description: 'Interhalogen compound.' },
            'I-Cl': { formula: 'ICl', name: 'Iodine Monochloride', molarMass: 162.36, type: 'Covalent', description: 'Red-brown liquid. Interhalogen.' },
            'I-F': { formula: 'IF', name: 'Iodine Pentafluoride', molarMass: 221.90, type: 'Covalent', description: 'Fluorinating agent.' },
            'Cl-F': { formula: 'ClF', name: 'Chlorine Trifluoride', molarMass: 92.45, type: 'Covalent', description: 'Extremely reactive. Burns water!' },
            'Br-F': { formula: 'BrF', name: 'Bromine Pentafluoride', molarMass: 174.90, type: 'Covalent', description: 'Strong fluorinating agent.' },
            
            // Oxyacids and salts
            'Cl-O': { formula: 'ClO', name: 'Dichlorine Monoxide', molarMass: 86.91, type: 'Covalent', description: 'Yellow-brown gas. Strong oxidizer.' },
            'I-O': { formula: 'IO', name: 'Iodine Pentoxide', molarMass: 333.81, type: 'Covalent', description: 'Used to detect carbon monoxide.' },
            'P-O': { formula: 'PO', name: 'Phosphorus Pentoxide', molarMass: 141.94, type: 'Covalent', description: 'Powerful desiccant.' },
            'P-Cl': { formula: 'PCl', name: 'Phosphorus Trichloride', molarMass: 137.33, type: 'Covalent', description: 'Used to make pesticides.' },
            'P-S': { formula: 'PS', name: 'Phosphorus Pentasulfide', molarMass: 222.27, type: 'Covalent', description: 'Used in match heads.' },
            'B-O': { formula: 'BO', name: 'Boron Trioxide', molarMass: 69.62, type: 'Covalent', description: 'Used in glass and ceramics.' },
            'B-N': { formula: 'BN', name: 'Boron Nitride', molarMass: 24.82, type: 'Covalent', description: 'As hard as diamond. Lubricant.' },
            'B-H': { formula: 'BH', name: 'Diborane', molarMass: 27.67, type: 'Covalent', description: 'Pyrophoric. Rocket fuel.' },
            'B-F': { formula: 'BF', name: 'Boron Trifluoride', molarMass: 67.81, type: 'Covalent', description: 'Lewis acid catalyst.' },
            'B-Cl': { formula: 'BCl', name: 'Boron Trichloride', molarMass: 117.17, type: 'Covalent', description: 'Used in semiconductor doping.' },
            
            // Strontium compounds
            'Sr-O': { formula: 'SrO', name: 'Strontium Oxide', molarMass: 103.62, type: 'Ionic', description: 'Used in fireworks (red color).' },
            'Sr-Cl': { formula: 'SrCl', name: 'Strontium Chloride', molarMass: 158.53, type: 'Ionic', description: 'Red flame color. Used in pyrotechnics.' },
            'Sr-S-O': { formula: 'SrSO', name: 'Strontium Sulfate', molarMass: 183.68, type: 'Ionic', description: 'Celestine mineral.' },
            'Sr-C-O': { formula: 'SrCO', name: 'Strontium Carbonate', molarMass: 147.63, type: 'Ionic', description: 'Used in fireworks and ferrite magnets.' },
            
            // Rubidium compounds
            'Rb-Cl': { formula: 'RbCl', name: 'Rubidium Chloride', molarMass: 120.92, type: 'Ionic', description: 'Used in atomic clocks.' },
            'Rb-O': { formula: 'RbO', name: 'Rubidium Oxide', molarMass: 186.94, type: 'Ionic', description: 'Yellow solid. Very reactive.' },
            
            // Cesium compounds
            'Cs-Cl': { formula: 'CsCl', name: 'Cesium Chloride', molarMass: 168.36, type: 'Ionic', description: 'Crystal structure prototype.' },
            'Cs-O': { formula: 'CsO', name: 'Cesium Oxide', molarMass: 281.81, type: 'Ionic', description: 'Orange-red. Highly reactive.' },
            'Cs-I': { formula: 'CsI', name: 'Cesium Iodide', molarMass: 259.81, type: 'Ionic', description: 'Used in scintillation detectors.' },
            
            // Francium (theoretical)
            'Fr-Cl': { formula: 'FrCl', name: 'Francium Chloride', molarMass: 258.40, type: 'Ionic', description: 'Theoretical. Francium is extremely rare.' },
            
            // Radium compounds
            'Ra-Cl': { formula: 'RaCl', name: 'Radium Chloride', molarMass: 296.09, type: 'Ionic', description: 'Studied by Marie Curie. Radioactive.' },
            'Ra-S-O': { formula: 'RaSO', name: 'Radium Sulfate', molarMass: 322.09, type: 'Ionic', description: 'Very insoluble. Radioactive.' },
            
            // Beryllium compounds
            'Be-O': { formula: 'BeO', name: 'Beryllium Oxide', molarMass: 25.01, type: 'Ionic', description: 'Excellent thermal conductor. Toxic.' },
            'Be-Cl': { formula: 'BeCl', name: 'Beryllium Chloride', molarMass: 79.92, type: 'Covalent', description: 'Linear molecule. Lewis acid.' },
            'Be-F': { formula: 'BeF', name: 'Beryllium Fluoride', molarMass: 47.01, type: 'Ionic', description: 'Used in nuclear reactors.' },
            
            // Additional organic-metal compounds
            'Zn-C-H-O': { formula: 'Zn(CHCOO)', name: 'Zinc Acetate', molarMass: 183.48, type: 'Ionic', description: 'Used in medicine and as wood preservative.' },
            'Fe-C-H-O': { formula: 'Fe(CHCOO)', name: 'Iron(II) Acetate', molarMass: 173.93, type: 'Ionic', description: 'Used in dyeing and as mordant.' },
            'Mg-C-H-O': { formula: 'Mg(CHCOO)', name: 'Magnesium Acetate', molarMass: 142.39, type: 'Ionic', description: 'De-icing agent. Food additive.' },
            
            // Miscellaneous important compounds
            'Hg-O': { formula: 'HgO', name: 'Mercury(II) Oxide', molarMass: 216.59, type: 'Ionic', description: 'Red/yellow. Used by Priestley to discover oxygen.' },
            'Hg-S': { formula: 'HgS', name: 'Mercury(II) Sulfide (Cinnabar)', molarMass: 232.66, type: 'Ionic', description: 'Vermillion pigment. Mercury ore.' },
            'W-O': { formula: 'WO', name: 'Tungsten Trioxide', molarMass: 231.84, type: 'Ionic', description: 'Yellow. Used in electrochromic windows.' },
            'W-C': { formula: 'WC', name: 'Tungsten Carbide', molarMass: 195.85, type: 'Covalent', description: 'Extremely hard. Used in cutting tools.' },
            'Mo-O': { formula: 'MoO', name: 'Molybdenum Trioxide', molarMass: 143.94, type: 'Ionic', description: 'Used as catalyst and in steel alloys.' },
            'Mo-S': { formula: 'MoS', name: 'Molybdenum Disulfide', molarMass: 160.07, type: 'Covalent', description: 'Solid lubricant. Layered structure.' },
            'Re-O': { formula: 'ReO', name: 'Rhenium Heptoxide', molarMass: 484.41, type: 'Covalent', description: 'Yellow solid. Strong oxidizer.' },
            'Os-O': { formula: 'OsO', name: 'Osmium Tetroxide', molarMass: 254.23, type: 'Covalent', description: 'Toxic. Used in electron microscopy.' },
            'Ir-O': { formula: 'IrO', name: 'Iridium Dioxide', molarMass: 224.22, type: 'Ionic', description: 'Used in electrochemical applications.' },
            'Pd-Cl': { formula: 'PdCl', name: 'Palladium(II) Chloride', molarMass: 177.33, type: 'Ionic', description: 'Catalyst. Carbon monoxide detector.' },
            'Rh-Cl': { formula: 'RhCl', name: 'Rhodium(III) Chloride', molarMass: 209.26, type: 'Ionic', description: 'Catalyst precursor.' },
            'Ru-O': { formula: 'RuO', name: 'Ruthenium Tetroxide', molarMass: 165.07, type: 'Covalent', description: 'Powerful oxidizer. Used in organic synthesis.' },
            'Ag-O': { formula: 'AgO', name: 'Silver Oxide', molarMass: 231.74, type: 'Ionic', description: 'Used in batteries and as mild oxidizer.' },
            
            // Superconductor materials
            'Y-Ba-Cu-O': { formula: 'YBaCuO', name: 'YBCO Superconductor', molarMass: 666.19, type: 'Ionic', description: 'High-temp superconductor above liquid nitrogen temp.' },
            'Bi-Sr-Ca-Cu-O': { formula: 'BSCCO', name: 'Bismuth Strontium Calcium Copper Oxide', molarMass: 888.37, type: 'Ionic', description: 'High-temperature superconductor.' },
            'La-Ba-Cu-O': { formula: 'LaBaCuO', name: 'Lanthanum Barium Copper Oxide', molarMass: 534.78, type: 'Ionic', description: 'First high-Tc superconductor discovered.' },
            
            // Hafnium compounds
            'Hf-O': { formula: 'HfO', name: 'Hafnium Dioxide', molarMass: 210.49, type: 'Ionic', description: 'High-k dielectric. Used in semiconductors.' },
            'Hf-Cl': { formula: 'HfCl', name: 'Hafnium Tetrachloride', molarMass: 320.30, type: 'Covalent', description: 'Precursor for hafnium compounds.' },
            
            // Tantalum compounds
            'Ta-O': { formula: 'TaO', name: 'Tantalum Pentoxide', molarMass: 441.89, type: 'Ionic', description: 'Used in capacitors and optics.' },
            'Ta-C': { formula: 'TaC', name: 'Tantalum Carbide', molarMass: 192.96, type: 'Covalent', description: 'One of the hardest materials known.' },
            
            // Niobium compounds
            'Nb-O': { formula: 'NbO', name: 'Niobium Pentoxide', molarMass: 265.81, type: 'Ionic', description: 'Used in capacitors and optics.' },
            'Nb-C': { formula: 'NbC', name: 'Niobium Carbide', molarMass: 104.92, type: 'Covalent', description: 'Extremely hard. Used in cutting tools.' },
            
            // Technetium compounds
            'Tc-O': { formula: 'TcO', name: 'Technetium Dioxide', molarMass: 130.00, type: 'Ionic', description: 'Radioactive. Used in medical imaging.' },
            
            // Promethium compounds
            'Pm-O': { formula: 'PmO', name: 'Promethium Oxide', molarMass: 337.88, type: 'Ionic', description: 'Radioactive rare earth. Glow in dark paints.' },
            'Pm-Cl': { formula: 'PmCl', name: 'Promethium Chloride', molarMass: 251.36, type: 'Ionic', description: 'Used in nuclear batteries.' },
            
            // Holmium, Thulium, Lutetium
            'Ho-O': { formula: 'HoO', name: 'Holmium Oxide', molarMass: 377.86, type: 'Ionic', description: 'Yellow color. Used in lasers.' },
            'Tm-O': { formula: 'TmO', name: 'Thulium Oxide', molarMass: 385.87, type: 'Ionic', description: 'Used in portable X-ray devices.' },
            'Lu-O': { formula: 'LuO', name: 'Lutetium Oxide', molarMass: 397.93, type: 'Ionic', description: 'Used in catalysts and ceramics.' },
            
            // Praseodymium
            'Pr-O': { formula: 'PrO', name: 'Praseodymium Oxide', molarMass: 329.81, type: 'Ionic', description: 'Used in ceramics and magnets.' },
            
            // More Metal Hydrides
            'Li-H': { formula: 'LiH', name: 'Lithium Hydride', molarMass: 7.95, type: 'Ionic', description: 'Hydrogen storage. Reduces metal oxides.' },
            'Na-H': { formula: 'NaH', name: 'Sodium Hydride', molarMass: 24.00, type: 'Ionic', description: 'Strong base. Used in organic synthesis.' },
            'Ca-H': { formula: 'CaH', name: 'Calcium Hydride', molarMass: 42.09, type: 'Ionic', description: 'Drying agent. Produces hydrogen with water.' },
            'Mg-H': { formula: 'MgH', name: 'Magnesium Hydride', molarMass: 26.32, type: 'Ionic', description: 'Hydrogen storage material.' },
            'Al-H': { formula: 'AlH', name: 'Aluminum Hydride (Alane)', molarMass: 30.00, type: 'Covalent', description: 'Rocket fuel additive. Hydrogen storage.' },
            'Ti-H': { formula: 'TiH', name: 'Titanium Hydride', molarMass: 49.88, type: 'Ionic', description: 'Used in powder metallurgy.' },
            'Zr-H': { formula: 'ZrH', name: 'Zirconium Hydride', molarMass: 93.24, type: 'Ionic', description: 'Used in nuclear reactors.' },
            'Pd-H': { formula: 'PdH', name: 'Palladium Hydride', molarMass: 107.43, type: 'Metallic', description: 'Palladium absorbs large amounts of hydrogen.' },
            
            // Carbides
            'Si-C': { formula: 'SiC', name: 'Silicon Carbide (Carborundum)', molarMass: 40.10, type: 'Covalent', description: 'Extremely hard. Used in abrasives and semiconductors.' },
            'B-C': { formula: 'BC', name: 'Boron Carbide', molarMass: 55.26, type: 'Covalent', description: 'Third hardest material. Tank armor.' },
            'Ti-C': { formula: 'TiC', name: 'Titanium Carbide', molarMass: 59.89, type: 'Covalent', description: 'Used in cutting tools. Very hard.' },
            'Zr-C': { formula: 'ZrC', name: 'Zirconium Carbide', molarMass: 103.24, type: 'Covalent', description: 'High melting point. Used in nuclear reactors.' },
            'Cr-C': { formula: 'CrC', name: 'Chromium Carbide', molarMass: 180.01, type: 'Covalent', description: 'Used in hardfacing and wear-resistant coatings.' },
            'Mo-C': { formula: 'MoC', name: 'Molybdenum Carbide', molarMass: 203.89, type: 'Covalent', description: 'Catalyst and hard material.' },
            'V-C': { formula: 'VC', name: 'Vanadium Carbide', molarMass: 62.95, type: 'Covalent', description: 'Used in cutting tools.' },
            'Fe-C': { formula: 'FeC', name: 'Cementite', molarMass: 179.55, type: 'Metallic', description: 'Iron carbide in steel. Affects hardness.' },
            'Ca-C': { formula: 'CaC', name: 'Calcium Carbide', molarMass: 64.10, type: 'Ionic', description: 'Makes acetylene gas with water.' },
            
            // Nitrides
            'Si-N': { formula: 'SiN', name: 'Silicon Nitride', molarMass: 140.28, type: 'Covalent', description: 'High-temperature ceramic. Ball bearings.' },
            'Ti-N': { formula: 'TiN', name: 'Titanium Nitride', molarMass: 61.87, type: 'Covalent', description: 'Gold color. Hard coating for tools.' },
            'Al-N': { formula: 'AlN', name: 'Aluminum Nitride', molarMass: 40.99, type: 'Covalent', description: 'Excellent thermal conductor. Semiconductor.' },
            'Zr-N': { formula: 'ZrN', name: 'Zirconium Nitride', molarMass: 105.23, type: 'Covalent', description: 'Gold color. Hard coating.' },
            'Cr-N': { formula: 'CrN', name: 'Chromium Nitride', molarMass: 66.00, type: 'Covalent', description: 'Hard coating for cutting tools.' },
            'V-N': { formula: 'VN', name: 'Vanadium Nitride', molarMass: 64.95, type: 'Covalent', description: 'Superconductor at low temperatures.' },
            'Li-N': { formula: 'LiN', name: 'Lithium Nitride', molarMass: 34.83, type: 'Ionic', description: 'Red-brown. Fast lithium-ion conductor.' },
            'Mg-N': { formula: 'MgN', name: 'Magnesium Nitride', molarMass: 100.93, type: 'Ionic', description: 'Yellow-green. Forms ammonia with water.' },
            'Ca-N': { formula: 'CaN', name: 'Calcium Nitride', molarMass: 148.25, type: 'Ionic', description: 'Brown-red. Forms ammonia with water.' },
            'Ta-N': { formula: 'TaN', name: 'Tantalum Nitride', molarMass: 194.95, type: 'Covalent', description: 'Used in thin film resistors.' },
            
            // Selenides and Tellurides
            'Cu-Se': { formula: 'CuSe', name: 'Copper Selenide', molarMass: 206.05, type: 'Ionic', description: 'Thermoelectric material.' },
            'Zn-Se': { formula: 'ZnSe', name: 'Zinc Selenide', molarMass: 144.35, type: 'Ionic', description: 'Used in infrared optics.' },
            'Pb-Se': { formula: 'PbSe', name: 'Lead Selenide', molarMass: 286.16, type: 'Ionic', description: 'Infrared detector material.' },
            'Bi-Te': { formula: 'BiTe', name: 'Bismuth Telluride', molarMass: 800.76, type: 'Ionic', description: 'Best thermoelectric material. Cooling devices.' },
            'Pb-Te': { formula: 'PbTe', name: 'Lead Telluride', molarMass: 334.80, type: 'Ionic', description: 'Thermoelectric. Infrared detector.' },
            'Zn-Te': { formula: 'ZnTe', name: 'Zinc Telluride', molarMass: 192.99, type: 'Ionic', description: 'Semiconductor. Terahertz generation.' },
            'Cu-Te': { formula: 'CuTe', name: 'Copper Telluride', molarMass: 254.69, type: 'Ionic', description: 'Thermoelectric material.' },
            'Ag-Se': { formula: 'AgSe', name: 'Silver Selenide', molarMass: 294.70, type: 'Ionic', description: 'Superionic conductor.' },
            'Ag-Te': { formula: 'AgTe', name: 'Silver Telluride', molarMass: 343.34, type: 'Ionic', description: 'Semiconductor. Phase change memory.' },
            'Sb-Te': { formula: 'SbTe', name: 'Antimony Telluride', molarMass: 626.30, type: 'Ionic', description: 'Thermoelectric. Topological insulator.' },
            
            // Arsenides
            'In-As': { formula: 'InAs', name: 'Indium Arsenide', molarMass: 189.74, type: 'Covalent', description: 'Infrared detector. High electron mobility.' },
            'Al-As': { formula: 'AlAs', name: 'Aluminum Arsenide', molarMass: 101.90, type: 'Covalent', description: 'Semiconductor. Used with GaAs.' },
            'Zn-As': { formula: 'ZnAs', name: 'Zinc Arsenide', molarMass: 345.99, type: 'Covalent', description: 'Semiconductor.' },
            'Cd-As': { formula: 'CdAs', name: 'Cadmium Arsenide', molarMass: 487.07, type: 'Covalent', description: 'Topological semimetal.' },
            
            // Phosphides
            'Ga-P': { formula: 'GaP', name: 'Gallium Phosphide', molarMass: 100.70, type: 'Covalent', description: 'LED material. Green and yellow LEDs.' },
            'Al-P': { formula: 'AlP', name: 'Aluminum Phosphide', molarMass: 57.95, type: 'Ionic', description: 'Fumigant. Produces toxic phosphine.' },
            'Zn-P': { formula: 'ZnP', name: 'Zinc Phosphide', molarMass: 258.12, type: 'Covalent', description: 'Rodenticide. Semiconductor.' },
            'Ca-P': { formula: 'CaP', name: 'Calcium Phosphide', molarMass: 182.18, type: 'Ionic', description: 'Produces phosphine with water.' },
            
            // Antimonides
            'Ga-Sb': { formula: 'GaSb', name: 'Gallium Antimonide', molarMass: 191.48, type: 'Covalent', description: 'Infrared detector. Thermophotovoltaics.' },
            'In-Sb': { formula: 'InSb', name: 'Indium Antimonide', molarMass: 236.58, type: 'Covalent', description: 'Fastest transistors. Infrared detector.' },
            'Al-Sb': { formula: 'AlSb', name: 'Aluminum Antimonide', molarMass: 148.74, type: 'Covalent', description: 'Indirect bandgap semiconductor.' },
            'Zn-Sb': { formula: 'ZnSb', name: 'Zinc Antimonide', molarMass: 187.15, type: 'Covalent', description: 'Thermoelectric material.' },
            
            // More Alloys (as compounds)
            'Fe-Ni': { formula: 'FeNi', name: 'Iron-Nickel (Invar/Permalloy)', molarMass: 114.60, type: 'Metallic', description: 'Low thermal expansion (Invar). Magnetic (Permalloy).' },
            'Cu-Zn': { formula: 'CuZn (Brass)', name: 'Brass', molarMass: 128.93, type: 'Metallic', description: 'Common alloy. Yellow color. Used in fittings.' },
            'Cu-Sn': { formula: 'CuSn (Bronze)', name: 'Bronze', molarMass: 309.26, type: 'Metallic', description: 'Ancient alloy. Used in bearings and sculptures.' },
            'Ni-Ti': { formula: 'NiTi', name: 'Nitinol (Shape Memory Alloy)', molarMass: 106.68, type: 'Metallic', description: 'Shape memory effect. Superelastic. Medical devices.' },
            'Fe-Cr': { formula: 'FeCr', name: 'Ferrochrome', molarMass: 107.95, type: 'Metallic', description: 'Used to make stainless steel.' },
            'Al-Cu': { formula: 'AlCu', name: 'Aluminum-Copper', molarMass: 90.54, type: 'Metallic', description: 'Aircraft alloy. Age hardening.' },
            'Ag-Cu': { formula: 'AgCu', name: 'Sterling Silver', molarMass: 171.49, type: 'Metallic', description: 'Jewelry alloy. 92.5% silver.' },
            'Au-Ag': { formula: 'AuAg', name: 'Electrum', molarMass: 304.87, type: 'Metallic', description: 'Natural gold-silver alloy. Ancient coins.' },
            'Pt-Ir': { formula: 'PtIr', name: 'Platinum-Iridium', molarMass: 387.22, type: 'Metallic', description: 'Standard kilogram. Spark plug electrodes.' },
            
            // Ferrites and Spinels
            'Fe-Fe-O': { formula: 'FeO', name: 'Magnetite', molarMass: 231.53, type: 'Ionic', description: 'Natural magnet. Black iron oxide.' },
            'Mg-Fe-O': { formula: 'MgFeO', name: 'Magnesium Ferrite', molarMass: 200.00, type: 'Ionic', description: 'Soft magnetic material.' },
            'Mn-Fe-O': { formula: 'MnFeO', name: 'Manganese Ferrite', molarMass: 230.63, type: 'Ionic', description: 'Used in magnetic recording.' },
            'Zn-Fe-O': { formula: 'ZnFeO', name: 'Zinc Ferrite', molarMass: 241.07, type: 'Ionic', description: 'Magnetic material for electronics.' },
            'Ni-Fe-O': { formula: 'NiFeO', name: 'Nickel Ferrite', molarMass: 234.38, type: 'Ionic', description: 'Microwave absorber.' },
            'Co-Fe-O': { formula: 'CoFeO', name: 'Cobalt Ferrite', molarMass: 234.62, type: 'Ionic', description: 'Hard magnetic material. High coercivity.' },
            'Mg-Al-O': { formula: 'MgAlO', name: 'Spinel', molarMass: 142.27, type: 'Ionic', description: 'Gemstone. Crystal structure prototype.' },
            'Fe-Cr-O': { formula: 'FeCrO', name: 'Chromite', molarMass: 223.84, type: 'Ionic', description: 'Chromium ore. Refractory material.' },
            
            // Perovskites for solar cells
            'Pb-I-C-N-H': { formula: 'CHNHPbI', name: 'Methylammonium Lead Iodide', molarMass: 619.98, type: 'Ionic', description: 'Perovskite solar cell material. High efficiency.' },
            'Cs-Pb-I': { formula: 'CsPbI', name: 'Cesium Lead Iodide', molarMass: 720.80, type: 'Ionic', description: 'Inorganic perovskite. Solar cells.' },
            'Cs-Pb-Br': { formula: 'CsPbBr', name: 'Cesium Lead Bromide', molarMass: 579.83, type: 'Ionic', description: 'Quantum dot material. Green emission.' },
            
            // Battery materials
            'Li-Co-O': { formula: 'LiCoO', name: 'Lithium Cobalt Oxide', molarMass: 97.87, type: 'Ionic', description: 'Cathode material. Lithium-ion batteries.' },
            'Li-Fe-P-O': { formula: 'LiFePO', name: 'Lithium Iron Phosphate', molarMass: 157.76, type: 'Ionic', description: 'Safe battery cathode. Electric vehicles.' },
            'Li-Mn-O': { formula: 'LiMnO', name: 'Lithium Manganese Oxide', molarMass: 180.82, type: 'Ionic', description: 'Spinel cathode material.' },
            'Li-Ni-Mn-Co-O': { formula: 'NMC', name: 'Nickel Manganese Cobalt Oxide', molarMass: 96.93, type: 'Ionic', description: 'High-energy battery cathode. EVs.' },
            'Li-Ti-O': { formula: 'LiTiO', name: 'Lithium Titanate', molarMass: 459.07, type: 'Ionic', description: 'Safe anode. Fast charging.' },
            'Na-S': { formula: 'NaS', name: 'Sodium Sulfide', molarMass: 78.04, type: 'Ionic', description: 'Used in sodium-sulfur batteries.' }
        };

        // Three.js variables
        let scene, camera, renderer, controls;
        let elementMeshes = [];
        let raycaster, mouse;
        let selectedElements = [];
        let autoRotate = false;
        let isFlat = true;
        let hoveredElement = null;
        let combinerOpen = false;

        // WebGL Detection
        function webglAvailable() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && 
                    (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
            } catch(e) {
                return false;
            }
        }

        if (!webglAvailable()) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('webgl-error').style.display = 'block';
            throw new Error('WebGL not available');
        }

        // Help modal functions
        function openHelp() {
            document.getElementById('help-modal').classList.add('visible');
        }
        function closeHelp() {
            document.getElementById('help-modal').classList.remove('visible');
        }
        window.closeHelp = closeHelp;
        
        document.getElementById('help-btn').addEventListener('click', openHelp);
        document.getElementById('help-modal').addEventListener('click', function(e) {
            if (e.target === this) closeHelp();
        });

        // Initialize the scene
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            // Transparent background to show animated science background
            scene.background = null;

            // Camera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 55);

            // Renderer with alpha for transparency
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, powerPreference: 'high-performance' });
            renderer.setClearColor(0x000000, 0);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Cap at 2 for performance
            document.getElementById('scene-container').appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 50);
            scene.add(directionalLight);

            const pointLight = new THREE.PointLight(0x00d4ff, 0.5, 100);
            pointLight.position.set(-20, 20, 20);
            scene.add(pointLight);
            
            // Add floating geometric shapes (disabled - may cause issues)
            // createFloatingGeometry();

            // Create periodic table
            createPeriodicTable();

            // Raycaster for mouse interaction
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Event listeners
            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('click', onMouseClick);

            // Mouse controls for rotation
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            // Prevent context menu on right-click
            renderer.domElement.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });

            renderer.domElement.addEventListener('mousedown', (e) => {
                if (e.button === 2) { // Right mouse button
                    isDragging = true;
                    autoRotate = false;
                    document.getElementById('btn-rotate').classList.remove('active');
                    e.preventDefault();
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - previousMousePosition.x;
                    const deltaY = e.clientY - previousMousePosition.y;

                    scene.rotation.y += deltaX * 0.005;
                    scene.rotation.x += deltaY * 0.005;
                }
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            // Zoom with scroll (passive for performance)
            document.addEventListener('wheel', (e) => {
                camera.position.z += e.deltaY * 0.05;
                camera.position.z = Math.max(20, Math.min(100, camera.position.z));
            }, { passive: true });

            // Start animation
            animate();

            // Enhanced loading sequence with ELEMENTUM reveal
            setTimeout(() => {
                // Phase 1: Hide the spinner
                const loaderPhase1 = document.querySelector('.loader-phase-1');
                if (loaderPhase1) loaderPhase1.classList.add('hide');
                
                // Phase 2: Show ELEMENTUM letters
                setTimeout(() => {
                    const reveal = document.getElementById('elementum-reveal');
                    reveal.classList.add('active');
                    
                    const letters = reveal.querySelectorAll('.element-letter');
                    letters.forEach((letter, index) => {
                        setTimeout(() => {
                            letter.classList.add('animate');
                            // Add glow after animation completes
                            setTimeout(() => {
                                letter.classList.add('glow');
                            }, 600);
                        }, index * 120);
                    });
                    
                    // Show subtitle after letters
                    setTimeout(() => {
                        document.getElementById('loading-subtitle').classList.add('visible');
                    }, letters.length * 120 + 400);
                    
                    // Phase 3: Hide loading screen
                    setTimeout(() => {
                        document.getElementById('loading').classList.add('hidden');
                    }, letters.length * 120 + 1200);
                }, 400);
            }, 800);
        }

        function getElementPosition(element) {
            let col, row;
            
            // Handle lanthanides (57-71)
            if (element.number >= 57 && element.number <= 71) {
                col = (element.number - 57) + 2;
                row = 8.5;
            }
            // Handle actinides (89-103)
            else if (element.number >= 89 && element.number <= 103) {
                col = (element.number - 89) + 2;
                row = 9.5;
            }
            // Regular elements
            else {
                col = element.group;
                row = element.period;
            }

            const spacing = 2.2;
            const x = (col - 9.5) * spacing;
            const y = -(row - 5.5) * spacing;
            const z = isFlat ? 0 : Math.sin(col * 0.3) * 2 + Math.cos(row * 0.3) * 2;

            return { x, y, z };
        }

        function createPeriodicTable() {
            elements.forEach(element => {
                const pos = getElementPosition(element);
                const color = new THREE.Color(categoryColors[element.category] || '#888888');

                // Create element box - using a thin box
                const geometry = new THREE.BoxGeometry(1.8, 1.8, 0.3);
                const material = new THREE.MeshPhongMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.9,
                    shininess: 100
                });

                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(pos.x, pos.y, pos.z);
                mesh.userData = element;

                // Create text canvas for element symbol
                const canvas = document.createElement('canvas');
                canvas.width = 256;
                canvas.height = 256;
                const ctx = canvas.getContext('2d');
                
                // Background matching element color
                ctx.fillStyle = categoryColors[element.category] || '#888888';
                ctx.fillRect(0, 0, 256, 256);
                
                // Add slight gradient overlay
                const gradient = ctx.createLinearGradient(0, 0, 256, 256);
                gradient.addColorStop(0, 'rgba(255,255,255,0.2)');
                gradient.addColorStop(1, 'rgba(0,0,0,0.2)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 256, 256);
                
                // Atomic number (top left)
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 28px Arial';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'top';
                ctx.fillText(element.number, 15, 15);
                
                // Element symbol (center)
                ctx.font = 'bold 90px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(element.symbol, 128, 120);
                
                // Element name (bottom)
                ctx.font = '22px Arial';
                ctx.textBaseline = 'bottom';
                const name = element.name.length > 10 ? element.name.substring(0, 9) + '.' : element.name;
                ctx.fillText(name, 128, 230);
                
                // Atomic mass (below symbol)
                ctx.font = '18px Arial';
                ctx.fillText(element.mass.toFixed(2), 128, 195);

                const texture = new THREE.CanvasTexture(canvas);
                texture.minFilter = THREE.LinearFilter;
                const labelMaterial = new THREE.MeshBasicMaterial({
                    map: texture,
                    transparent: true,
                    opacity: 1
                });

                const labelGeometry = new THREE.PlaneGeometry(1.8, 1.8);
                
                // Front label
                const frontLabel = new THREE.Mesh(labelGeometry, labelMaterial.clone());
                frontLabel.position.z = 0.151;
                mesh.add(frontLabel);

                // Back label
                const backLabel = new THREE.Mesh(labelGeometry, labelMaterial.clone());
                backLabel.position.z = -0.151;
                backLabel.rotation.y = Math.PI;
                mesh.add(backLabel);

                // Store references for filtering
                mesh.labelMaterials = [frontLabel.material, backLabel.material];

                scene.add(mesh);
                elementMeshes.push(mesh);
            });
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Throttled mouse move for better FPS
        let lastMouseMoveTime = 0;
        const mouseMoveThrottle = 7; // ~144fps
        let pendingMouseMove = null;
        
        function onMouseMove(event) {
            const now = performance.now();
            if (now - lastMouseMoveTime < mouseMoveThrottle) {
                // Store for next frame if throttled
                pendingMouseMove = event;
                return;
            }
            lastMouseMoveTime = now;
            pendingMouseMove = null;
            
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(elementMeshes, true);
            
            const cursorGlow = document.getElementById('cursor-glow');

            // Reset previous hover
            if (hoveredElement && (!intersects.length || getParentMesh(intersects[0].object) !== hoveredElement)) {
                hoveredElement.scale.set(1, 1, 1);
                // Remove glow from previous element
                hoveredElement.material.emissive.setHex(0x000000);
                hoveredElement.material.emissiveIntensity = 0;
                hoveredElement = null;
                document.getElementById('tooltip').classList.remove('visible');
                if (cursorGlow) cursorGlow.classList.remove('hovering');
            }

            if (intersects.length > 0) {
                const mesh = getParentMesh(intersects[0].object);
                if (mesh && mesh !== hoveredElement && mesh.userData && mesh.userData.symbol) {
                    hoveredElement = mesh;
                    mesh.scale.set(1.15, 1.15, 1.15);
                    // Add glow effect
                    const glowColor = new THREE.Color(categoryColors[mesh.userData.category] || 0x00d4ff);
                    mesh.material.emissive = glowColor;
                    mesh.material.emissiveIntensity = 0.4;
                    showTooltip(mesh.userData, event);
                    if (cursorGlow) cursorGlow.classList.add('hovering');
                }
            }
        }

        // Helper function to get the parent element mesh
        function getParentMesh(object) {
            while (object) {
                if (object.userData && object.userData.symbol) {
                    return object;
                }
                object = object.parent;
            }
            return null;
        }

        function showTooltip(element, event) {
            // Don't show tooltip if quiz panel is open
            const quizPanel = document.getElementById('quiz-panel');
            if (quizPanel && quizPanel.classList.contains('visible')) {
                return; // Skip showing tooltip when quiz is active
            }
            
            // Don't show tooltip if combination panel has a result visible
            const compoundResult = document.getElementById('compound-result');
            if (combinerOpen && compoundResult && compoundResult.classList.contains('visible')) {
                return; // Skip showing tooltip when compound result is displayed
            }
            
            const tooltip = document.getElementById('tooltip');
            const symbolBox = document.getElementById('tooltip-symbol-box');
            
            // Get state at current temperature
            const state = getStateAtTemp(element, currentTemp);
            const stateIcon = getStateIcon(state);
            
            symbolBox.style.background = categoryColors[element.category];
            document.getElementById('tooltip-number').textContent = element.number;
            document.getElementById('tooltip-symbol').textContent = element.symbol;
            document.getElementById('tooltip-mass').textContent = element.mass.toFixed(3);
            document.getElementById('tooltip-name').innerHTML = element.name + 
                `<span class="state-badge state-${state}">${stateIcon} ${state}</span>`;
            document.getElementById('tooltip-category').textContent = element.category.replace('-', ' ');

            // Grid info
            const gridHTML = `
                <div class="tooltip-item"><div class="tooltip-label">Electronegativity</div><div class="tooltip-value">${element.electronegativity || 'N/A'}</div></div>
                <div class="tooltip-item"><div class="tooltip-label">Atomic Radius</div><div class="tooltip-value">${element.radius} pm</div></div>
                <div class="tooltip-item"><div class="tooltip-label">Melting Point</div><div class="tooltip-value">${element.melt !== null ? element.melt + 'C' : 'N/A'}</div></div>
                <div class="tooltip-item"><div class="tooltip-label">Boiling Point</div><div class="tooltip-value">${element.boil !== null ? element.boil + 'C' : 'N/A'}</div></div>
                <div class="tooltip-item"><div class="tooltip-label">Density</div><div class="tooltip-value">${element.density ? element.density + ' g/cm' : 'N/A'}</div></div>
                <div class="tooltip-item"><div class="tooltip-label">Discovered</div><div class="tooltip-value">${element.discovered}</div></div>
            `;
            document.getElementById('tooltip-grid').innerHTML = gridHTML;
            document.getElementById('tooltip-description').textContent = element.description;

            // Electron shells with enhanced display
            const shellNames = ['1st', '2nd', '3rd', '4th', '5th', '6th', '7th'];
            const shellLetters = ['K', 'L', 'M', 'N', 'O', 'P', 'Q'];
            let shellsHTML = '<div class="shells-title"> Electron Configuration</div>';
            element.electrons.forEach((count, i) => {
                let electrons = '';
                for (let j = 0; j < count; j++) {
                    electrons += '<div class="electron"></div>';
                }
                shellsHTML += `
                    <div class="shell-row">
                        <span class="shell-label">${shellLetters[i]}</span>
                        <span class="shell-name">${shellNames[i]} shell</span>
                        <div class="shell-electrons">${electrons}</div>
                        <span class="shell-count">${count}e</span>
                    </div>`;
            });
            shellsHTML += `
                <div class="shell-key">
                    <div class="shell-key-title"> Shell Key (Principal Energy Levels):</div>
                    <span class="shell-key-item"><span class="shell-key-letter">K</span> = n=1 (max 2e)</span>
                    <span class="shell-key-item"><span class="shell-key-letter">L</span> = n=2 (max 8e)</span>
                    <span class="shell-key-item"><span class="shell-key-letter">M</span> = n=3 (max 18e)</span>
                    <span class="shell-key-item"><span class="shell-key-letter">N</span> = n=4 (max 32e)</span>
                </div>`;
            document.getElementById('electron-shells').innerHTML = shellsHTML;

            // Position tooltip - dynamically calculate size and stay within viewport
            const tooltipContent = tooltip.querySelector('.tooltip-content');
            
            // First, position off-screen to measure actual size
            tooltip.style.left = '-9999px';
            tooltip.style.top = '-9999px';
            tooltip.classList.add('visible');
            
            // Get actual dimensions
            const tooltipRect = tooltipContent.getBoundingClientRect();
            const tooltipWidth = Math.min(tooltipRect.width + 20, 380);
            const tooltipHeight = Math.min(tooltipRect.height + 20, window.innerHeight - 100);
            
            const padding = 15;
            
            // Calculate initial position (prefer right and below cursor)
            let x = event.clientX + padding;
            let y = event.clientY + padding;
            
            // Keep tooltip within horizontal bounds
            if (x + tooltipWidth > window.innerWidth - padding) {
                x = event.clientX - tooltipWidth - padding;
            }
            if (x < padding) {
                x = padding;
            }
            
            // Keep tooltip within vertical bounds
            if (y + tooltipHeight > window.innerHeight - padding) {
                y = event.clientY - tooltipHeight - padding;
            }
            if (y < 70) { // Account for top bar
                y = 70;
            }
            
            // Final safety clamp
            x = Math.max(padding, Math.min(x, window.innerWidth - tooltipWidth - padding));
            y = Math.max(70, Math.min(y, window.innerHeight - tooltipHeight - padding));
            
            tooltip.style.left = x + 'px';
            tooltip.style.top = y + 'px';
            
            // Play hover sound
            playSound('hover');
        }
        
        // Create ripple effect on click
        function createRipple(x, y, color = 'rgba(0, 212, 255, 0.6)') {
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.style.width = '40px';
            ripple.style.height = '40px';
            ripple.style.borderColor = color;
            document.body.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        }

        function onMouseClick(event) {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(elementMeshes, true);

            if (intersects.length > 0) {
                const mesh = getParentMesh(intersects[0].object);
                if (mesh && mesh.userData && mesh.userData.symbol) {
                    playSound('click');
                    
                    // Create ripple at click position
                    const color = categoryColors[mesh.userData.category] || 0x00d4ff;
                    const colorStr = `rgba(${(color >> 16) & 255}, ${(color >> 8) & 255}, ${color & 255}, 0.6)`;
                    createRipple(event.clientX, event.clientY, colorStr);
                    
                    if (compareMode) {
                        addToComparison(mesh.userData);
                    } else if (combinerOpen) {
                        addSelectedElement(mesh.userData);
                    }
                }
            }
        }

        function addSelectedElement(element) {
            if (!element || !element.number) return;
            if (selectedElements.length >= 5) return;
            if (selectedElements.find(e => e.number === element.number)) return;

            selectedElements.push(element);
            updateSelectedDisplay();
            
            // Add particle burst to the newly added element
            setTimeout(() => {
                const container = document.getElementById('selected-elements');
                const elements = container.querySelectorAll('.selected-element');
                const lastElement = elements[elements.length - 1];
                if (lastElement) {
                    const rect = lastElement.getBoundingClientRect();
                    createMiniParticleBurst(rect.left + rect.width / 2, rect.top + rect.height / 2, 
                        categoryColors[element.category] || 0x00d4ff);
                }
            }, 50);
        }
        
        function createMiniParticleBurst(x, y, color) {
            // Reduced particle count for performance
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: fixed;
                    width: 6px;
                    height: 6px;
                    left: ${x}px;
                    top: ${y}px;
                    border-radius: 50%;
                    background: rgba(${(color >> 16) & 255}, ${(color >> 8) & 255}, ${color & 255}, 0.8);
                    pointer-events: none;
                    z-index: 5000;
                    will-change: transform, opacity;
                `;
                
                const angle = (i / 6) * Math.PI * 2;
                const velocity = 30 + Math.random() * 30;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                
                document.body.appendChild(particle);
                
                let posX = 0, posY = 0, opacity = 1;
                const animateParticle = () => {
                    posX += vx * 0.12;
                    posY += vy * 0.12;
                    opacity -= 0.05;
                    particle.style.transform = `translate(${posX}px, ${posY}px)`;
                    particle.style.opacity = opacity;
                    if (opacity > 0) {
                        requestAnimationFrame(animateParticle);
                    } else {
                        particle.remove();
                    }
                };
                requestAnimationFrame(animateParticle);
            }
        }

        function removeSelectedElement(index) {
            selectedElements.splice(index, 1);
            updateSelectedDisplay();
            document.getElementById('compound-result').classList.remove('visible');
        }

        function updateSelectedDisplay() {
            const container = document.getElementById('selected-elements');
            container.innerHTML = '';

            if (selectedElements.length === 0) {
                container.innerHTML = '<div class="empty-slot">+</div><span class="plus-sign">+</span><div class="empty-slot">+</div>';
                return;
            }

            selectedElements.forEach((element, index) => {
                if (index > 0) {
                    container.innerHTML += '<span class="plus-sign">+</span>';
                }
                container.innerHTML += `
                    <div class="selected-element" style="background: ${categoryColors[element.category]}" onclick="removeSelectedElement(${index})">
                        <div class="remove-btn"></div>
                        <span class="symbol">${element.symbol}</span>
                        <span class="name">${element.name}</span>
                    </div>
                `;
            });

            if (selectedElements.length < 5) {
                container.innerHTML += '<span class="plus-sign">+</span><div class="empty-slot">+</div>';
            }
        }

        function combineElements() {
            if (selectedElements.length < 2) {
                alert('Please select at least 2 elements to combine.');
                return;
            }

            playSound('combine');
            const symbols = selectedElements.map(e => e.symbol).sort().join('-');
            const compound = compounds[symbols];

            const resultDiv = document.getElementById('compound-result');
            
            if (compound) {
                const totalMass = selectedElements.reduce((sum, e) => sum + e.mass, 0);
                resultDiv.innerHTML = `
                    <div class="compound-formula">${compound.formula}</div>
                    <div class="compound-name">${compound.name}</div>
                    <div class="compound-details">
                        <div class="compound-detail-item">
                            <div class="compound-detail-label">Molar Mass</div>
                            <div class="compound-detail-value">${compound.molarMass} g/mol</div>
                        </div>
                        <div class="compound-detail-item">
                            <div class="compound-detail-label">Bond Type</div>
                            <div class="compound-detail-value">${compound.type}</div>
                        </div>
                        <div class="compound-detail-item">
                            <div class="compound-detail-label">Combined Mass</div>
                            <div class="compound-detail-value">${totalMass.toFixed(3)} u</div>
                        </div>
                    </div>
                    <div class="compound-description">${compound.description}</div>
                `;
            } else {
                const formula = selectedElements.map(e => e.symbol).join('');
                const totalMass = selectedElements.reduce((sum, e) => sum + e.mass, 0);
                resultDiv.innerHTML = `
                    <div class="compound-formula">${formula}?</div>
                    <div class="compound-name">Unknown Compound</div>
                    <div class="compound-description">
                        This combination doesn't form a common compound in our database. 
                        Combined atomic mass: ${totalMass.toFixed(3)} u
                        <br><br>
                        Try combining elements that commonly bond together like H + O for water, or Na + Cl for salt!
                    </div>
                `;
            }
            
            resultDiv.classList.add('visible');
        }

        function clearSelection() {
            selectedElements = [];
            updateSelectedDisplay();
            document.getElementById('compound-result').classList.remove('visible');
        }
        
        // Floating 3D Geometry
        const floatingObjects = [];
        
        function createFloatingGeometry() {
            // Create wireframe geometric shapes floating around
            const colors = [0x00d4ff, 0x8a2be2, 0xff2d92, 0x00ffc8, 0xff6b35];
            
            for (let i = 0; i < 12; i++) {
                // Create fresh geometry for each mesh
                let geometry;
                switch(i % 5) {
                    case 0: geometry = new THREE.IcosahedronGeometry(2, 0); break;
                    case 1: geometry = new THREE.OctahedronGeometry(2); break;
                    case 2: geometry = new THREE.TetrahedronGeometry(2); break;
                    case 3: geometry = new THREE.DodecahedronGeometry(1.5); break;
                    case 4: geometry = new THREE.TorusGeometry(1.5, 0.5, 8, 16); break;
                }
                
                const material = new THREE.MeshBasicMaterial({
                    color: colors[i % colors.length],
                    wireframe: true,
                    transparent: true,
                    opacity: 0.3
                });
                
                const mesh = new THREE.Mesh(geometry, material);
                
                // Position randomly around the scene
                const radius = 35 + Math.random() * 20;
                const theta = Math.random() * Math.PI * 2;
                const phi = (Math.random() - 0.5) * Math.PI;
                
                mesh.position.x = radius * Math.cos(theta) * Math.cos(phi);
                mesh.position.y = radius * Math.sin(phi) * 0.5;
                mesh.position.z = radius * Math.sin(theta) * Math.cos(phi);
                
                mesh.userData = {
                    rotationSpeed: {
                        x: (Math.random() - 0.5) * 0.02,
                        y: (Math.random() - 0.5) * 0.02,
                        z: (Math.random() - 0.5) * 0.02
                    },
                    floatSpeed: 0.001 + Math.random() * 0.002,
                    floatOffset: Math.random() * Math.PI * 2,
                    isFloatingShape: true
                };
                
                scene.add(mesh);
                floatingObjects.push(mesh);
            }
        }
        
        function animateFloatingGeometry(time) {
            floatingObjects.forEach((obj) => {
                if (obj.userData && obj.userData.isFloatingShape) {
                    obj.rotation.x += obj.userData.rotationSpeed.x;
                    obj.rotation.y += obj.userData.rotationSpeed.y;
                    obj.rotation.z += obj.userData.rotationSpeed.z;
                    
                    // Gentle floating motion
                    const floatY = Math.sin(time * obj.userData.floatSpeed + obj.userData.floatOffset) * 2;
                    obj.position.y += (floatY - obj.position.y) * 0.01;
                }
            });
        }

        // Performance monitoring
        let lastFrameTime = 0;
        let frameCount = 0;
        
        function animate(currentTime) {
            requestAnimationFrame(animate);
            
            // Process any pending mouse events
            if (pendingMouseMove) {
                const event = pendingMouseMove;
                pendingMouseMove = null;
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            }

            if (autoRotate) {
                scene.rotation.y += 0.002;
            }

            renderer.render(scene, camera);
        }

        // Control buttons
        document.getElementById('btn-rotate').addEventListener('click', function() {
            autoRotate = !autoRotate;
            this.classList.toggle('active');
        });

        document.getElementById('btn-reset').addEventListener('click', function() {
            scene.rotation.set(0, 0, 0);
            camera.position.set(0, 0, 55);
        });

        document.getElementById('btn-flat').addEventListener('click', function() {
            isFlat = true;
            updateElementPositions();
        });

        document.getElementById('btn-3d').addEventListener('click', function() {
            isFlat = false;
            updateElementPositions();
        });

        function updateElementPositions() {
            elementMeshes.forEach((mesh, i) => {
                const pos = getElementPosition(elements[i]);
                mesh.position.set(pos.x, pos.y, pos.z);
            });
        }

        // Search functionality
        document.getElementById('search').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            
            elementMeshes.forEach(mesh => {
                const element = mesh.userData;
                const match = element.name.toLowerCase().includes(query) || 
                             element.symbol.toLowerCase().includes(query) ||
                             element.number.toString().includes(query);
                
                const targetOpacity = match || query === '' ? 1 : 0.15;
                mesh.material.opacity = targetOpacity;
                if (mesh.labelMaterials) {
                    mesh.labelMaterials.forEach(mat => mat.opacity = targetOpacity);
                }
            });
        });

        // Category filter
        document.querySelectorAll('.category-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                const category = this.dataset.category;
                
                elementMeshes.forEach(mesh => {
                    const element = mesh.userData;
                    const match = category === 'all' || element.category === category;
                    const targetOpacity = match ? 1 : 0.15;
                    mesh.material.opacity = targetOpacity;
                    if (mesh.labelMaterials) {
                        mesh.labelMaterials.forEach(mat => mat.opacity = targetOpacity);
                    }
                });
            });
        });

        // Combine button
        document.getElementById('btn-combine').addEventListener('click', combineElements);
        document.getElementById('btn-clear').addEventListener('click', clearSelection);

        // Combiner panel toggle
        document.getElementById('combiner-toggle').addEventListener('click', function() {
            combinerOpen = !combinerOpen;
            document.getElementById('combination-panel').classList.toggle('visible', combinerOpen);
            this.innerHTML = combinerOpen ? ' Close Combiner' : ' Open Element Combiner';
        });

        // Close button inside combiner panel
        document.getElementById('combiner-close').addEventListener('click', function() {
            combinerOpen = false;
            document.getElementById('combination-panel').classList.remove('visible');
            document.getElementById('combiner-toggle').innerHTML = ' Open Element Combiner';
        });

        // Make comparison panel draggable
        (function() {
            const panel = document.getElementById('comparison-panel');
            const header = panel.querySelector('.comparison-header');
            let isDragging = false;
            let offsetX, offsetY;

            header.addEventListener('mousedown', function(e) {
                if (e.target.tagName === 'BUTTON') return;
                isDragging = true;
                offsetX = e.clientX - panel.offsetLeft;
                offsetY = e.clientY - panel.offsetTop;
                panel.style.transition = 'none';
            });

            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                // Keep within viewport
                newX = Math.max(0, Math.min(newX, window.innerWidth - panel.offsetWidth));
                newY = Math.max(0, Math.min(newY, window.innerHeight - panel.offsetHeight));
                
                panel.style.left = newX + 'px';
                panel.style.top = newY + 'px';
            });

            document.addEventListener('mouseup', function() {
                isDragging = false;
                panel.style.transition = '';
            });
        })();

        // ============================================
        // NEW FEATURES
        // ============================================

        // Sound System
        let soundEnabled = true;
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (!soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            let duration = 0.15;
            
            switch(type) {
                case 'hover':
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.03;
                    oscillator.type = 'sine';
                    break;
                case 'click':
                    oscillator.frequency.value = 600;
                    gainNode.gain.value = 0.05;
                    oscillator.type = 'triangle';
                    break;
                case 'combine':
                    oscillator.frequency.value = 1200;
                    gainNode.gain.value = 0.08;
                    oscillator.type = 'sine';
                    break;
                case 'correct':
                    // Triumphant ascending tone
                    oscillator.frequency.value = 523.25; // C5
                    gainNode.gain.value = 0.08;
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                    duration = 0.3;
                    break;
                case 'wrong':
                    // Descending buzzer tone
                    oscillator.frequency.value = 300;
                    gainNode.gain.value = 0.06;
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.2);
                    duration = 0.25;
                    break;
                case 'streak':
                    // Exciting fanfare for streaks
                    oscillator.frequency.value = 659.25; // E5
                    gainNode.gain.value = 0.1;
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.08); // G5
                    oscillator.frequency.setValueAtTime(987.77, audioContext.currentTime + 0.16); // B5
                    oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.24); // C6
                    duration = 0.4;
                    break;
                case 'reaction':
                    // Bubbling reaction sound
                    oscillator.frequency.value = 150;
                    gainNode.gain.value = 0.1;
                    oscillator.type = 'sine';
                    // Rapid frequency modulation for bubbling effect
                    for (let i = 0; i < 10; i++) {
                        oscillator.frequency.setValueAtTime(150 + Math.random() * 300, audioContext.currentTime + i * 0.05);
                    }
                    duration = 0.5;
                    break;
            }
            
            oscillator.start();
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            oscillator.stop(audioContext.currentTime + duration);
        }

        document.getElementById('sound-toggle').addEventListener('click', function() {
            soundEnabled = !soundEnabled;
            this.innerHTML = soundEnabled ? 
                '<span class="icon"></span><span>Sound: ON</span>' : 
                '<span class="icon"></span><span>Sound: OFF</span>';
            savePreferences();
        });

        // Temperature Slider
        let currentTemp = 298;
        const tempSlider = document.getElementById('temp-slider');
        const tempValue = document.getElementById('temp-value');

        tempSlider.addEventListener('input', function() {
            currentTemp = parseInt(this.value);
            tempValue.innerHTML = currentTemp + ' <span>K</span>';
            updateElementStates();
            savePreferences();
        });

        document.getElementById('temp-reset').addEventListener('click', function() {
            currentTemp = 298;
            tempSlider.value = 298;
            tempValue.innerHTML = '298 <span>K</span>';
            updateElementStates();
            savePreferences();
        });

        function getStateAtTemp(element, temp) {
            if (element.melt === null || element.boil === null) return 'unknown';
            const meltK = element.melt + 273.15;
            const boilK = element.boil + 273.15;
            if (temp < meltK) return 'solid';
            if (temp > boilK) return 'gas';
            return 'liquid';
        }

        function getStateIcon(state) {
            switch(state) {
                case 'solid': return '';
                case 'liquid': return '';
                case 'gas': return '';
                default: return '';
            }
        }

        function updateElementStates() {
            elementMeshes.forEach(mesh => {
                const element = mesh.userData;
                const state = getStateAtTemp(element, currentTemp);
                
                // Update material color tint based on state
                const baseColor = new THREE.Color(categoryColors[element.category] || 0x666666);
                if (state === 'liquid') {
                    mesh.material.emissive = new THREE.Color(0x0066aa);
                    mesh.material.emissiveIntensity = 0.1;
                } else if (state === 'gas') {
                    mesh.material.emissive = new THREE.Color(0x00aa44);
                    mesh.material.emissiveIntensity = 0.15;
                } else {
                    mesh.material.emissive = new THREE.Color(0x000000);
                    mesh.material.emissiveIntensity = 0;
                }
            });
        }

        // Comparison Mode
        let compareMode = false;
        let compareElements = [];

        function toggleCompareMode() {
            compareMode = !compareMode;
            if (compareMode) {
                compareElements = [];
                document.getElementById('comparison-panel').classList.add('visible');
            } else {
                document.getElementById('comparison-panel').classList.remove('visible');
            }
        }

        function closeComparison() {
            compareMode = false;
            compareElements = [];
            document.getElementById('comparison-panel').classList.remove('visible');
        }
        window.closeComparison = closeComparison;

        function addToComparison(element) {
            if (compareElements.length >= 2) {
                compareElements = [element];
            } else if (!compareElements.find(e => e.number === element.number)) {
                compareElements.push(element);
            }
            updateComparisonPanel();
        }

        function updateComparisonPanel() {
            const grid = document.getElementById('comparison-grid');
            const e1 = compareElements[0];
            const e2 = compareElements[1];
            
            function renderElement(el, id) {
                const div = document.getElementById(id);
                if (!el) {
                    div.innerHTML = '<p style="text-align:center; opacity:0.4; padding:40px;">Click an element</p>';
                    return;
                }
                
                const color = categoryColors[el.category] || '#666';
                const state = getStateAtTemp(el, currentTemp);
                
                div.innerHTML = `
                    <div class="comparison-element-header">
                        <div class="comparison-symbol-box" style="background: ${color};">
                            <span class="comparison-symbol">${el.symbol}</span>
                        </div>
                        <div>
                            <div class="comparison-name">${el.name}</div>
                            <div style="opacity:0.6; font-size:12px;">#${el.number}  ${el.category}</div>
                        </div>
                    </div>
                    <div class="comparison-props">
                        <div class="comparison-prop">
                            <span class="comparison-prop-label">Atomic Mass</span>
                            <span class="comparison-prop-value">${el.mass} u</span>
                        </div>
                        <div class="comparison-prop">
                            <span class="comparison-prop-label">State at ${currentTemp}K</span>
                            <span class="comparison-prop-value">${getStateIcon(state)} ${state}</span>
                        </div>
                        <div class="comparison-prop">
                            <span class="comparison-prop-label">Electronegativity</span>
                            <span class="comparison-prop-value">${el.electronegativity || 'N/A'}</span>
                        </div>
                        <div class="comparison-prop">
                            <span class="comparison-prop-label">Melting Point</span>
                            <span class="comparison-prop-value">${el.melt !== null ? el.melt + 'C' : 'N/A'}</span>
                        </div>
                        <div class="comparison-prop">
                            <span class="comparison-prop-label">Boiling Point</span>
                            <span class="comparison-prop-value">${el.boil !== null ? el.boil + 'C' : 'N/A'}</span>
                        </div>
                        <div class="comparison-prop">
                            <span class="comparison-prop-label">Density</span>
                            <span class="comparison-prop-value">${el.density} g/cm</span>
                        </div>
                        <div class="comparison-prop">
                            <span class="comparison-prop-label">Atomic Radius</span>
                            <span class="comparison-prop-value">${el.radius} pm</span>
                        </div>
                    </div>
                `;
            }
            
            renderElement(e1, 'compare-1');
            renderElement(e2, 'compare-2');
            
            // Highlight higher/lower values
            if (e1 && e2) {
                const props = ['mass', 'electronegativity', 'density', 'radius'];
                // Additional highlighting could be done here
            }
        }

        // Zoom/Focus Mode (Double-click)
        let zoomedElement = null;
        let orbitalAnimationFrame = null;

        function createElectronOrbitalAnimation(electrons) {
            const container = document.getElementById('electron-orbital-container');
            container.innerHTML = '';
            
            // Cancel any existing animation
            if (orbitalAnimationFrame) {
                cancelAnimationFrame(orbitalAnimationFrame);
            }
            
            // Add nucleus glow
            const nucleus = document.createElement('div');
            nucleus.className = 'nucleus-glow';
            container.appendChild(nucleus);
            
            const shellColors = ['#00d4ff', '#a29bfe', '#1dd1a1', '#feca57', '#ff6b6b', '#ff9ff3', '#54a0ff'];
            const orbitingElectrons = [];
            
            // Calculate max radius based on number of shells (container is 200x200)
            const maxRadius = 90;
            const shellSpacing = Math.min(20, maxRadius / electrons.length);
            
            electrons.forEach((electronCount, shellIndex) => {
                const baseRadius = 25 + shellIndex * shellSpacing;
                
                // Create orbital ring
                const ring = document.createElement('div');
                ring.className = 'orbital-ring';
                ring.style.width = (baseRadius * 2) + 'px';
                ring.style.height = (baseRadius * 2) + 'px';
                ring.style.borderColor = shellColors[shellIndex % shellColors.length];
                ring.style.boxShadow = `0 0 10px ${shellColors[shellIndex % shellColors.length]}40, inset 0 0 10px ${shellColors[shellIndex % shellColors.length]}20`;
                container.appendChild(ring);
                
                // Create electrons for this shell (limit display for performance)
                const displayCount = Math.min(electronCount, 8);
                for (let i = 0; i < displayCount; i++) {
                    const electron = document.createElement('div');
                    electron.className = 'orbiting-electron';
                    electron.style.background = `radial-gradient(circle at 30% 30%, #fff, ${shellColors[shellIndex % shellColors.length]})`;
                    electron.style.boxShadow = `0 0 8px ${shellColors[shellIndex % shellColors.length]}, 0 0 15px ${shellColors[shellIndex % shellColors.length]}`;
                    container.appendChild(electron);
                    
                    // Alternate directions for visual interest
                    const direction = shellIndex % 2 === 0 ? 1 : -1;
                    orbitingElectrons.push({
                        el: electron,
                        radius: baseRadius,
                        angle: (Math.PI * 2 * i) / displayCount,
                        speed: (0.03 - shellIndex * 0.003) * direction,
                        offset: Math.random() * Math.PI * 2
                    });
                }
            });
            
            // Animate electrons - container is 200x200, center is 100,100
            const containerCenter = { cx: 100, cy: 100 };
            
            function animateElectrons() {
                orbitingElectrons.forEach(e => {
                    e.angle += e.speed;
                    const x = containerCenter.cx + Math.cos(e.angle) * e.radius - 5;
                    const y = containerCenter.cy + Math.sin(e.angle) * e.radius - 5;
                    e.el.style.left = x + 'px';
                    e.el.style.top = y + 'px';
                });
                orbitalAnimationFrame = requestAnimationFrame(animateElectrons);
            }
            animateElectrons();
        }
        
        function clearElectronOrbitalAnimation() {
            if (orbitalAnimationFrame) {
                cancelAnimationFrame(orbitalAnimationFrame);
                orbitalAnimationFrame = null;
            }
            const container = document.getElementById('electron-orbital-container');
            if (container) container.innerHTML = '';
        }

        function showZoom(element) {
            zoomedElement = element;
            const color = categoryColors[element.category] || '#666';
            const state = getStateAtTemp(element, currentTemp);
            
            document.getElementById('zoom-symbol').textContent = element.symbol;
            document.getElementById('zoom-symbol').style.color = color;
            document.getElementById('zoom-name').textContent = element.name;
            document.getElementById('zoom-number').textContent = `Atomic Number: ${element.number}  ${element.category}`;
            document.getElementById('zoom-wiki').href = `https://en.wikipedia.org/wiki/${element.name}`;
            
            document.getElementById('zoom-details').innerHTML = `
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; text-align:left; margin-top:20px;">
                    <div style="padding:8px; background:rgba(255,255,255,0.05); border-radius:8px;">
                        <div style="opacity:0.6; font-size:11px;">Mass</div>
                        <div style="font-size:16px;">${element.mass} u</div>
                    </div>
                    <div style="padding:8px; background:rgba(255,255,255,0.05); border-radius:8px;">
                        <div style="opacity:0.6; font-size:11px;">State at ${currentTemp}K</div>
                        <div style="font-size:16px;">${getStateIcon(state)} ${state}</div>
                    </div>
                    <div style="padding:8px; background:rgba(255,255,255,0.05); border-radius:8px;">
                        <div style="opacity:0.6; font-size:11px;">Electrons</div>
                        <div style="font-size:16px;">${element.electrons.join(', ')}</div>
                    </div>
                    <div style="padding:8px; background:rgba(255,255,255,0.05); border-radius:8px;">
                        <div style="opacity:0.6; font-size:11px;">Discovered</div>
                        <div style="font-size:16px;">${element.discovered}</div>
                    </div>
                </div>
                <p style="margin-top:15px; opacity:0.7; font-size:13px; line-height:1.5;">${element.description}</p>
            `;
            
            // Hide any visible tooltip
            const tooltip = document.getElementById('tooltip');
            if (tooltip) tooltip.classList.remove('visible');
            
            document.getElementById('zoom-overlay').classList.add('visible');
            
            // Dim the 3D scene
            document.getElementById('scene-container').classList.add('dimmed');
            
            // Create electron orbital animation
            createElectronOrbitalAnimation(element.electrons);
            
            playSound('click');
        }

        function closeZoom() {
            zoomedElement = null;
            document.getElementById('zoom-overlay').classList.remove('visible');
            
            // Restore the 3D scene
            document.getElementById('scene-container').classList.remove('dimmed');
            
            clearElectronOrbitalAnimation();
        }
        window.closeZoom = closeZoom;

        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            // Don't trigger if typing in search
            if (document.activeElement.id === 'search') {
                if (e.key === 'Escape') {
                    document.getElementById('search').value = '';
                    document.getElementById('search').blur();
                    elementMeshes.forEach(mesh => {
                        mesh.material.opacity = 1;
                        if (mesh.labelMaterials) {
                            mesh.labelMaterials.forEach(mat => mat.opacity = 1);
                        }
                    });
                }
                return;
            }
            
            switch(e.key.toLowerCase()) {
                case 'r':
                    autoRotate = !autoRotate;
                    document.getElementById('btn-rotate').classList.toggle('active', autoRotate);
                    break;
                case 'f':
                    isFlat = true;
                    updateElementPositions();
                    break;
                case '3':
                    isFlat = false;
                    updateElementPositions();
                    break;
                case '/':
                    e.preventDefault();
                    document.getElementById('search').focus();
                    break;
                case 'c':
                    toggleCompareMode();
                    break;
                case 'h':
                    openHelp();
                    break;
                case 'escape':
                    closeZoom();
                    closeComparison();
                    closeHelp();
                    clearSelection();
                    break;
            }
        });

        // Touch Support for Mobile
        let touchStartX = 0, touchStartY = 0;
        let touchRotateX = 0, touchRotateY = 0;

        document.getElementById('scene-container').addEventListener('touchstart', function(e) {
            if (e.touches.length === 1) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                touchRotateX = scene.rotation.x;
                touchRotateY = scene.rotation.y;
            }
        }, { passive: true });

        document.getElementById('scene-container').addEventListener('touchmove', function(e) {
            if (e.touches.length === 1) {
                const deltaX = e.touches[0].clientX - touchStartX;
                const deltaY = e.touches[0].clientY - touchStartY;
                scene.rotation.y = touchRotateY + deltaX * 0.005;
                scene.rotation.x = touchRotateX + deltaY * 0.005;
            }
        }, { passive: true });

        // Glow effect on hover
        let hoveredMesh = null;
        let originalEmissive = null;

        function setElementGlow(mesh, glowing) {
            if (!mesh || !mesh.material) return;
            if (glowing) {
                originalEmissive = mesh.material.emissive.clone();
                const color = new THREE.Color(categoryColors[mesh.userData.category] || 0x666666);
                mesh.material.emissive = color;
                mesh.material.emissiveIntensity = 0.3;
            } else if (originalEmissive) {
                mesh.material.emissive = originalEmissive;
                mesh.material.emissiveIntensity = 0;
            }
        }

        // Double-click for zoom
        let lastClickTime = 0;
        document.getElementById('scene-container').addEventListener('click', function(e) {
            // Check for double click
            const now = Date.now();
            if (now - lastClickTime < 300) {
                // Double click
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(scene.children, true);
                
                for (let i = 0; i < intersects.length; i++) {
                    const mesh = getParentMesh(intersects[i].object);
                    if (mesh && mesh.userData && mesh.userData.number) {
                        showZoom(mesh.userData);
                        break;
                    }
                }
            }
            lastClickTime = now;
        });

        // LocalStorage Preferences
        function savePreferences() {
            const prefs = {
                soundEnabled: soundEnabled,
                autoRotate: autoRotate,
                isFlat: isFlat,
                currentTemp: currentTemp
            };
            localStorage.setItem('periodicTablePrefs', JSON.stringify(prefs));
        }

        function loadPreferences() {
            try {
                const saved = localStorage.getItem('periodicTablePrefs');
                if (saved) {
                    const prefs = JSON.parse(saved);
                    
                    if (prefs.soundEnabled !== undefined) {
                        soundEnabled = prefs.soundEnabled;
                        document.getElementById('sound-toggle').innerHTML = soundEnabled ? 
                            '<span class="icon"></span><span>Sound: ON</span>' : 
                            '<span class="icon"></span><span>Sound: OFF</span>';
                    }
                    
                    if (prefs.autoRotate !== undefined) {
                        autoRotate = prefs.autoRotate;
                        document.getElementById('btn-rotate').classList.toggle('active', autoRotate);
                    }
                    
                    if (prefs.isFlat !== undefined) {
                        isFlat = prefs.isFlat;
                        // Will update positions after init
                    }
                    
                    if (prefs.currentTemp !== undefined) {
                        currentTemp = prefs.currentTemp;
                        document.getElementById('temp-slider').value = currentTemp;
                        document.getElementById('temp-value').innerHTML = currentTemp + ' <span>K</span>';
                    }
                }
            } catch(e) {
                console.log('Could not load preferences');
            }
        }

        // Load preferences on start
        loadPreferences();

        // Save when buttons are clicked
        document.getElementById('btn-rotate').addEventListener('click', savePreferences);
        document.getElementById('btn-flat').addEventListener('click', savePreferences);
        document.getElementById('btn-3d').addEventListener('click', savePreferences);

        // ============================================
        // ADVANCED VISUAL EFFECTS
        // ============================================
        
        // Cursor Trail Effect (Optimized for 144fps)
        const cursorTrails = [];
        const maxTrails = 3; // Reduced for performance
        let cursorX = 0, cursorY = 0;
        let lastTrailTime = 0;
        const trailThrottle = 100; // ms between trail particles (reduced frequency)
        const cursorGlow = document.getElementById('cursor-glow');
        const scienceBg = document.getElementById('science-bg');
        let parallaxRAF = null;
        
        document.addEventListener('mousemove', (e) => {
            cursorX = e.clientX;
            cursorY = e.clientY;
            
            // Move cursor glow - center it on cursor (30px/2 = 15px offset)
            const glowX = cursorX - 15;
            const glowY = cursorY - 15;
            cursorGlow.style.setProperty('--x', glowX + 'px');
            cursorGlow.style.setProperty('--y', glowY + 'px');
            cursorGlow.style.transform = `translate(${glowX}px, ${glowY}px)`;
            
            const now = performance.now();
            if (now - lastTrailTime > trailThrottle) {
                // Debounced parallax update
                if (!parallaxRAF) {
                    parallaxRAF = requestAnimationFrame(() => {
                        const moveX = (cursorX / window.innerWidth - 0.5) * 20;
                        const moveY = (cursorY / window.innerHeight - 0.5) * 20;
                        if (scienceBg) {
                            scienceBg.style.transform = `translate3d(${moveX}px, ${moveY}px, 0)`;
                        }
                        parallaxRAF = null;
                    });
                }
                
                // Create trail particle - center it on cursor (8px/2 = 4px offset)
                if (cursorTrails.length < maxTrails) {
                    const trail = document.createElement('div');
                    trail.className = 'cursor-trail';
                    trail.style.transform = `translate(${cursorX - 4}px, ${cursorY - 4}px)`;
                    document.body.appendChild(trail);
                    cursorTrails.push(trail);
                    
                    // Remove after CSS animation completes
                    setTimeout(() => {
                        trail.remove();
                        cursorTrails.shift();
                    }, 250);
                }
                
                lastTrailTime = now;
            }
        }, { passive: true });

        
        document.addEventListener('mousedown', () => {
            cursorGlow.classList.add('clicking');
        });
        
        document.addEventListener('mouseup', () => {
            cursorGlow.classList.remove('clicking');
        });
        
        // Screen Flash Effect
        function triggerScreenFlash() {
            const flash = document.getElementById('screen-flash');
            flash.classList.remove('flash');
            void flash.offsetWidth; // Trigger reflow
            flash.classList.add('flash');
        }

        // Create scientific background elements
        function createScientificBackground() {
            const bg = document.getElementById('science-bg');
            
            // Create Hexagonal Grid
            const hexGrid = document.createElement('div');
            hexGrid.className = 'hex-grid';
            bg.appendChild(hexGrid);
            
            // Create Morphing Blobs (reduced for performance)
            const blobColors = [
                'rgba(0, 212, 255, 0.3)',
                'rgba(138, 43, 226, 0.25)'
            ];
            for (let i = 0; i < 2; i++) {
                const blob = document.createElement('div');
                blob.className = 'morph-blob';
                blob.style.cssText = `width:${350 + Math.random() * 150}px;height:${350 + Math.random() * 150}px;left:${i * 50 + 10}%;top:${20 + i * 30}%;background:${blobColors[i]};animation-delay:${i * 5}s;animation-duration:${18 + i * 4}s`;
                bg.appendChild(blob);
            }
            
            // Create Aurora Effect (single layer for performance)
            const aurora = document.createElement('div');
            aurora.className = 'aurora';
            bg.appendChild(aurora);
            
            // Create Stars (reduced for performance)
            for (let i = 0; i < 60; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = 1 + Math.random() * 3;
                star.style.cssText = `width:${size}px;height:${size}px;left:${Math.random() * 100}%;top:${Math.random() * 100}%;--duration:${2 + Math.random() * 4}s;animation-delay:${Math.random() * 5}s`;
                bg.appendChild(star);
            }
            
            // Create Nebula Clouds (reduced)
            const nebulaColors = [
                'rgba(0, 212, 255, 0.15)',
                'rgba(138, 43, 226, 0.12)',
                'rgba(255, 0, 128, 0.1)'
            ];
            for (let i = 0; i < 3; i++) {
                const nebula = document.createElement('div');
                nebula.className = 'nebula';
                const size = 200 + Math.random() * 400;
                nebula.style.cssText = `width:${size}px;height:${size}px;left:${Math.random() * 100}%;top:${Math.random() * 100}%;background:radial-gradient(ellipse, ${nebulaColors[i]}, transparent 70%);animation-delay:${Math.random() * 10}s;animation-duration:${12 + Math.random() * 8}s`;
                bg.appendChild(nebula);
            }
            
            // Create Energy Beams (reduced)
            for (let i = 0; i < 2; i++) {
                const beam = document.createElement('div');
                beam.className = 'energy-beam';
                beam.style.cssText = `left:-10px;top:${25 + i * 40}%;animation-delay:${i * 4}s;animation-duration:${6 + Math.random() * 4}s;opacity:${0.3 + Math.random() * 0.3}`;
                bg.appendChild(beam);
            }
            
            // Create Shooting Stars (reduced)
            for (let i = 0; i < 3; i++) {
                const shootingStar = document.createElement('div');
                shootingStar.className = 'shooting-star';
                shootingStar.style.cssText = `left:${20 + Math.random() * 60}%;top:${Math.random() * 40}%;animation-delay:${i * 8 + Math.random() * 4}s;animation-duration:${2.5 + Math.random() * 1.5}s`;
                bg.appendChild(shootingStar);
            }
            
            // Create floating particles (reduced for performance)
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'atom-particle';
                const colors = ['rgba(0, 212, 255, 1)', 'rgba(138, 43, 226, 1)', 'rgba(0, 255, 200, 1)', 'rgba(255, 100, 200, 1)'];
                particle.style.cssText = `left:${Math.random() * 100}%;top:${Math.random() * 100}%;--drift-x:${(Math.random() - 0.5) * 500}px;--drift-y:${(Math.random() - 0.5) * 500}px;animation-delay:${Math.random() * 15}s;animation-duration:${10 + Math.random() * 20}s;background:radial-gradient(circle, ${colors[i % 4]} 0%, transparent 70%)`;
                bg.appendChild(particle);
            }
            
            // Create electron orbits (reduced)
            for (let i = 0; i < 5; i++) {
                const orbit = document.createElement('div');
                orbit.className = 'electron-orbit';
                const size = 100 + Math.random() * 200;
                orbit.style.cssText = `width:${size}px;height:${size}px;left:${Math.random() * 100}%;top:${Math.random() * 100}%;animation-duration:${5 + Math.random() * 10}s;animation-delay:${Math.random() * 5}s;opacity:${0.1 + Math.random() * 0.15}`;
                bg.appendChild(orbit);
            }
            
            // Create floating formulas (optimized)
            const formulas = [
                'E = mc', 'PV = nRT', 'HO', 'NaCl', 'CHO', 
                'pH = -log[H]', 'FeO', 'CO'
            ];
            
            let activeFormulas = 0;
            const maxFormulas = 4; // Limit concurrent formulas
            
            function createFloatingFormula() {
                if (activeFormulas >= maxFormulas) return;
                activeFormulas++;
                
                const formula = document.createElement('div');
                formula.className = 'formula-float';
                formula.textContent = formulas[Math.floor(Math.random() * formulas.length)];
                formula.style.cssText = `top:${10 + Math.random() * 80}%;left:-100px;font-size:${12 + Math.random() * 8}px;animation-duration:${25 + Math.random() * 15}s`;
                bg.appendChild(formula);
                
                // Remove after animation
                setTimeout(() => {
                    formula.remove();
                    activeFormulas--;
                }, 40000);
            }
            
            // Create initial formulas (fewer)
            for (let i = 0; i < 3; i++) {
                setTimeout(() => createFloatingFormula(), i * 4000);
            }
            
            // Keep creating formulas (slower interval)
            setInterval(createFloatingFormula, 8000);
            
            // Create molecule structures (SVG) - reduced
            for (let i = 0; i < 3; i++) {
                const molecule = document.createElement('div');
                molecule.className = 'molecule';
                molecule.innerHTML = createMoleculeSVG();
                molecule.style.cssText = `left:${Math.random() * 100}%;top:${Math.random() * 100}%;animation-delay:${Math.random() * 20}s;transform:scale(${0.5 + Math.random() * 0.5})`;
                bg.appendChild(molecule);
            }
        }
        
        function createMoleculeSVG() {
            const types = [
                // Water molecule
                `<svg width="80" height="60" viewBox="0 0 80 60">
                    <circle cx="40" cy="30" r="12" fill="rgba(255,50,50,0.4)"/>
                    <circle cx="20" cy="45" r="8" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="60" cy="45" r="8" fill="rgba(255,255,255,0.4)"/>
                    <line x1="40" y1="30" x2="20" y2="45" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                    <line x1="40" y1="30" x2="60" y2="45" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                </svg>`,
                // Methane molecule
                `<svg width="80" height="80" viewBox="0 0 80 80">
                    <circle cx="40" cy="40" r="12" fill="rgba(100,100,100,0.4)"/>
                    <circle cx="40" cy="15" r="6" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="65" cy="40" r="6" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="40" cy="65" r="6" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="15" cy="40" r="6" fill="rgba(255,255,255,0.4)"/>
                    <line x1="40" y1="40" x2="40" y2="15" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                    <line x1="40" y1="40" x2="65" y2="40" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                    <line x1="40" y1="40" x2="40" y2="65" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                    <line x1="40" y1="40" x2="15" y2="40" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                </svg>`,
                // CO2 molecule
                `<svg width="100" height="40" viewBox="0 0 100 40">
                    <circle cx="50" cy="20" r="10" fill="rgba(100,100,100,0.4)"/>
                    <circle cx="20" cy="20" r="8" fill="rgba(255,50,50,0.4)"/>
                    <circle cx="80" cy="20" r="8" fill="rgba(255,50,50,0.4)"/>
                    <line x1="50" y1="20" x2="20" y2="20" stroke="rgba(255,255,255,0.3)" stroke-width="3"/>
                    <line x1="50" y1="20" x2="80" y2="20" stroke="rgba(255,255,255,0.3)" stroke-width="3"/>
                </svg>`,
                // Benzene ring
                `<svg width="80" height="80" viewBox="0 0 80 80">
                    <polygon points="40,10 70,25 70,55 40,70 10,55 10,25" fill="none" stroke="rgba(100,100,100,0.4)" stroke-width="2"/>
                    <polygon points="40,20 58,30 58,50 40,60 22,50 22,30" fill="none" stroke="rgba(100,100,100,0.3)" stroke-width="1"/>
                    <circle cx="40" cy="10" r="4" fill="rgba(100,100,100,0.5)"/>
                    <circle cx="70" cy="25" r="4" fill="rgba(100,100,100,0.5)"/>
                    <circle cx="70" cy="55" r="4" fill="rgba(100,100,100,0.5)"/>
                    <circle cx="40" cy="70" r="4" fill="rgba(100,100,100,0.5)"/>
                    <circle cx="10" cy="55" r="4" fill="rgba(100,100,100,0.5)"/>
                    <circle cx="10" cy="25" r="4" fill="rgba(100,100,100,0.5)"/>
                </svg>`,
                // Ammonia
                `<svg width="70" height="70" viewBox="0 0 70 70">
                    <circle cx="35" cy="30" r="10" fill="rgba(50,50,255,0.4)"/>
                    <circle cx="20" cy="50" r="6" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="50" cy="50" r="6" fill="rgba(255,255,255,0.4)"/>
                    <circle cx="35" cy="55" r="6" fill="rgba(255,255,255,0.4)"/>
                    <line x1="35" y1="30" x2="20" y2="50" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                    <line x1="35" y1="30" x2="50" y2="50" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                    <line x1="35" y1="30" x2="35" y2="55" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                </svg>`
            ];
            return types[Math.floor(Math.random() * types.length)];
        }

        // ============================================
        // DISCOVERY & ACHIEVEMENT SYSTEM
        // ============================================
        
        let discoveredCompounds = new Set();
        let totalCompounds = Object.keys(compounds).length;

        // Loading screen facts
        const elementFacts = [
            "Gold is so malleable that 1 gram can be beaten into a 1 square meter sheet",
            "Helium is the only element that cannot be solidified by cooling alone",
            "Francium is so rare that there's only about 30g on Earth at any time",
            "Oxygen makes up about 65% of the human body by mass",
            "Carbon can form nearly 10 million different compounds",
            "Mercury is the only metal that is liquid at room temperature",
            "Titanium has the highest strength-to-weight ratio of any metal",
            "Neon signs were first demonstrated in Paris in 1910",
            "Calcium is the most abundant metal in the human body",
            "Hydrogen is the most abundant element in the universe"
        ];

        function showRandomFact() {
            const factDiv = document.getElementById('loading-facts');
            if (factDiv) {
                const fact = elementFacts[Math.floor(Math.random() * elementFacts.length)];
                factDiv.textContent = '"' + fact + '"';
            }
        }
        setInterval(showRandomFact, 4000);
        showRandomFact();

        // Update total compounds display
        document.getElementById('total-compounds').textContent = totalCompounds;

        // Load discovered compounds from localStorage
        function loadDiscoveries() {
            try {
                const saved = localStorage.getItem('elementumDiscoveries');
                if (saved) {
                    discoveredCompounds = new Set(JSON.parse(saved));
                    updateDiscoveryDisplay();
                }
            } catch(e) {}
        }

        function saveDiscoveries() {
            localStorage.setItem('elementumDiscoveries', JSON.stringify([...discoveredCompounds]));
        }

        function updateDiscoveryDisplay() {
            const count = discoveredCompounds.size;
            document.getElementById('discovery-count').textContent = count;
            const percent = (count / totalCompounds) * 100;
            document.getElementById('discovery-progress').style.width = percent + '%';
        }

        function addDiscovery(compoundKey, compoundName) {
            if (!discoveredCompounds.has(compoundKey)) {
                discoveredCompounds.add(compoundKey);
                saveDiscoveries();
                updateDiscoveryDisplay();
                
                document.getElementById('discovery-recent').innerHTML = ' Latest: <strong>' + compoundName + '</strong>';
                
                // Screen flash + Particle celebration
                triggerScreenFlash();
                createSuccessParticles();
                createLightningEffect();
            }
        }
        
        // Lightning Effect between elements
        function createLightningEffect() {
            const panel = document.getElementById('combination-panel');
            const rect = panel.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + 80;
            
            for (let bolt = 0; bolt < 6; bolt++) {
                setTimeout(() => {
                    const lightning = document.createElement('canvas');
                    lightning.width = 300;
                    lightning.height = 150;
                    lightning.style.cssText = `
                        position: fixed;
                        left: ${centerX - 150}px;
                        top: ${centerY - 75}px;
                        pointer-events: none;
                        z-index: 4000;
                    `;
                    document.body.appendChild(lightning);
                    
                    const ctx = lightning.getContext('2d');
                    ctx.strokeStyle = `hsl(${180 + Math.random() * 60}, 100%, 70%)`;
                    ctx.lineWidth = 2;
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = '#00d4ff';
                    ctx.beginPath();
                    
                    let x = 50, y = 75;
                    ctx.moveTo(x, y);
                    while (x < 250) {
                        x += 10 + Math.random() * 20;
                        y = 75 + (Math.random() - 0.5) * 80;
                        ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                    
                    let opacity = 1;
                    const fade = () => {
                        opacity -= 0.08;
                        lightning.style.opacity = opacity;
                        if (opacity > 0) {
                            requestAnimationFrame(fade);
                        } else {
                            lightning.remove();
                        }
                    };
                    requestAnimationFrame(fade);
                }, bolt * 80);
            }
        }

        // Epic Success Particle Explosion
        function createSuccessParticles() {
            const colors = [
                '#00d4ff', '#00ffcc', '#a29bfe', '#ff6b9d', '#feca57', 
                '#1dd1a1', '#ff6b6b', '#74b9ff', '#fd79a8', '#00cec9'
            ];
            const panel = document.getElementById('combination-panel');
            const rect = panel.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Create shockwave ring
            const ring = document.createElement('div');
            ring.style.cssText = `
                position: fixed;
                left: ${centerX}px;
                top: ${centerY}px;
                width: 10px;
                height: 10px;
                border: 3px solid rgba(0, 212, 255, 0.8);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                pointer-events: none;
                z-index: 4000;
            `;
            document.body.appendChild(ring);
            
            let ringSize = 10, ringOpacity = 1;
            const animateRing = () => {
                ringSize += 15;
                ringOpacity -= 0.03;
                ring.style.width = ringSize + 'px';
                ring.style.height = ringSize + 'px';
                ring.style.opacity = ringOpacity;
                ring.style.borderWidth = Math.max(1, 3 - ringSize/100) + 'px';
                if (ringOpacity > 0) {
                    requestAnimationFrame(animateRing);
                } else {
                    ring.remove();
                }
            };
            requestAnimationFrame(animateRing);
            
            // Create sparkle particles
            for (let i = 0; i < 40; i++) {
                const particle = document.createElement('div');
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = 4 + Math.random() * 8;
                const isSquare = Math.random() > 0.7;
                
                particle.className = 'success-particle';
                particle.style.cssText = `
                    position: fixed;
                    left: ${centerX}px;
                    top: ${centerY}px;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    border-radius: ${isSquare ? '2px' : '50%'};
                    box-shadow: 0 0 ${size * 2}px ${color}, 0 0 ${size * 4}px ${color};
                    pointer-events: none;
                    z-index: 3500;
                `;
                document.body.appendChild(particle);
                
                const angle = (Math.PI * 2 * i) / 40 + (Math.random() - 0.5) * 0.5;
                const velocity = 8 + Math.random() * 12;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                const rotateSpeed = (Math.random() - 0.5) * 20;
                
                let x = 0, y = 0, opacity = 1, rotation = 0;
                const animate = () => {
                    x += vx * 0.95;
                    y += vy * 0.95 + 0.3; // gravity
                    opacity -= 0.015;
                    rotation += rotateSpeed;
                    particle.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}deg) scale(${opacity})`;
                    particle.style.opacity = opacity;
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        particle.remove();
                    }
                };
                setTimeout(() => requestAnimationFrame(animate), i * 10);
            }
            
            // Create rising sparkles
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    sparkle.style.cssText = `
                        position: fixed;
                        left: ${centerX + (Math.random() - 0.5) * 200}px;
                        top: ${centerY}px;
                        width: 4px;
                        height: 4px;
                        background: ${color};
                        border-radius: 50%;
                        box-shadow: 0 0 10px ${color}, 0 0 20px ${color};
                        pointer-events: none;
                        z-index: 3500;
                    `;
                    document.body.appendChild(sparkle);
                    
                    let y = 0, opacity = 1, wobble = 0;
                    const animateSparkle = () => {
                        y -= 3 + Math.random() * 2;
                        wobble += 0.2;
                        opacity -= 0.01;
                        sparkle.style.transform = `translateY(${y}px) translateX(${Math.sin(wobble) * 15}px)`;
                        sparkle.style.opacity = opacity;
                        if (opacity > 0) {
                            requestAnimationFrame(animateSparkle);
                        } else {
                            sparkle.remove();
                        }
                    };
                    requestAnimationFrame(animateSparkle);
                }, i * 50);
            }
        }

        // ============================================
        // ENHANCED QUIZ MODE WITH DIFFICULTY LEVELS
        // ============================================
        
        let quizDifficulty = 'beginner';
        let quizTimer = null;
        let quizTimeLeft = 0;
        let quizBestScore = parseInt(localStorage.getItem('quizBestScore') || '0');
        let currentQuizAnswer = '';
        let quizScore = 0;
        let quizStreak = 0;
        let askedQuestions = [];
        
        // Question types for cognitive enhancement
        const questionTypes = {
            symbol: 'Symbol Recognition',
            number: 'Atomic Number',
            property: 'Element Properties',
            recall: 'Memory Recall',
            pattern: 'Pattern Recognition',
            application: 'Real-World Application'
        };
        
        // Beginner questions - basic facts, no timer pressure
        const beginnerQuestions = [
            { type: 'symbol', q: 'What is the chemical symbol for Gold?', options: ['Au', 'Ag', 'Go', 'Gd'], answer: 'Au', hint: 'From Latin "Aurum"' },
            { type: 'symbol', q: 'What is the chemical symbol for Silver?', options: ['Si', 'Ag', 'Sr', 'Sv'], answer: 'Ag', hint: 'From Latin "Argentum"' },
            { type: 'symbol', q: 'What is the chemical symbol for Iron?', options: ['Ir', 'In', 'Fe', 'I'], answer: 'Fe', hint: 'From Latin "Ferrum"' },
            { type: 'number', q: 'Which element has the atomic number 1?', options: ['Helium', 'Hydrogen', 'Lithium', 'Oxygen'], answer: 'Hydrogen', hint: 'The simplest and lightest element' },
            { type: 'number', q: 'Which element has the atomic number 6?', options: ['Nitrogen', 'Oxygen', 'Carbon', 'Boron'], answer: 'Carbon', hint: 'Essential for all life' },
            { type: 'property', q: 'What element makes up about 78% of Earth\'s atmosphere?', options: ['Oxygen', 'Carbon', 'Nitrogen', 'Argon'], answer: 'Nitrogen', hint: 'We breathe it but don\'t use it' },
            { type: 'property', q: 'Which element is essential for bones and teeth?', options: ['Iron', 'Calcium', 'Potassium', 'Sodium'], answer: 'Calcium', hint: 'Found in milk and dairy' },
            { type: 'property', q: 'What is the most abundant element in the universe?', options: ['Oxygen', 'Carbon', 'Helium', 'Hydrogen'], answer: 'Hydrogen', hint: 'Stars are mostly made of this' },
            { type: 'application', q: 'What element is diamond made of?', options: ['Silicon', 'Carbon', 'Boron', 'Nitrogen'], answer: 'Carbon', hint: 'Also found in graphite and coal' },
            { type: 'application', q: 'What element is used in computer chips?', options: ['Carbon', 'Germanium', 'Silicon', 'Gallium'], answer: 'Silicon', hint: 'Silicon Valley is named after it' },
            { type: 'recall', q: 'Which noble gas is used in neon signs?', options: ['Argon', 'Helium', 'Neon', 'Xenon'], answer: 'Neon', hint: 'The name gives it away!' },
            { type: 'recall', q: 'Which element is named after the Sun?', options: ['Helium', 'Solarium', 'Radium', 'Neon'], answer: 'Helium', hint: 'Helios = Greek god of the Sun' },
            { type: 'property', q: 'What is the lightest metal?', options: ['Aluminum', 'Magnesium', 'Lithium', 'Sodium'], answer: 'Lithium', hint: 'Used in batteries' },
            { type: 'application', q: 'Which halogen is used to purify water?', options: ['Fluorine', 'Chlorine', 'Bromine', 'Iodine'], answer: 'Chlorine', hint: 'Also used in swimming pools' },
            { type: 'property', q: 'Which element gives rubies their red color?', options: ['Iron', 'Copper', 'Chromium', 'Cobalt'], answer: 'Chromium', hint: 'Also used for shiny plating' }
        ];
        
        // Amateur questions - harder facts, moderate timer
        const amateurQuestions = [
            { type: 'number', q: 'What is the atomic number of Uranium?', options: ['92', '88', '94', '90'], answer: '92', hint: 'Between Protactinium and Neptunium' },
            { type: 'symbol', q: 'Which element has the symbol "W"?', options: ['Tungsten', 'Wolfram', 'Wismuth', 'Tungsten'], answer: 'Tungsten', hint: 'From German "Wolfram"' },
            { type: 'property', q: 'Which element has the highest melting point?', options: ['Iron', 'Tungsten', 'Carbon', 'Platinum'], answer: 'Tungsten', hint: 'Used in light bulb filaments' },
            { type: 'pattern', q: 'Which element comes after Argon in the periodic table?', options: ['Chlorine', 'Potassium', 'Calcium', 'Krypton'], answer: 'Potassium', hint: 'Atomic number 19' },
            { type: 'pattern', q: 'What do Helium, Neon, and Argon have in common?', options: ['They are metals', 'They are noble gases', 'They are halogens', 'They are radioactive'], answer: 'They are noble gases', hint: 'Very unreactive elements' },
            { type: 'recall', q: 'What is the heaviest naturally occurring element?', options: ['Lead', 'Uranium', 'Plutonium', 'Radium'], answer: 'Uranium', hint: 'Used in nuclear reactors' },
            { type: 'property', q: 'Which element is liquid at room temperature besides Mercury?', options: ['Gallium', 'Bromine', 'Cesium', 'Francium'], answer: 'Bromine', hint: 'A reddish-brown halogen' },
            { type: 'application', q: 'Which element is used in photosynthesis to produce oxygen?', options: ['Nitrogen', 'Carbon', 'Hydrogen', 'Magnesium'], answer: 'Carbon', hint: 'Plants absorb CO' },
            { type: 'number', q: 'How many elements are in the Lanthanide series?', options: ['14', '15', '10', '18'], answer: '15', hint: 'Elements 57-71' },
            { type: 'symbol', q: 'What element has the symbol "Sb"?', options: ['Sulfur', 'Antimony', 'Strontium', 'Samarium'], answer: 'Antimony', hint: 'From Latin "Stibium"' },
            { type: 'pattern', q: 'Which group contains the most reactive metals?', options: ['Group 1', 'Group 2', 'Group 11', 'Group 3'], answer: 'Group 1', hint: 'Alkali metals' },
            { type: 'recall', q: 'Which element was discovered by Marie Curie?', options: ['Uranium', 'Radium', 'Radon', 'Polonium'], answer: 'Radium', hint: 'She also discovered Polonium' },
            { type: 'property', q: 'Which element is the best conductor of electricity?', options: ['Gold', 'Copper', 'Silver', 'Aluminum'], answer: 'Silver', hint: 'Better than copper but more expensive' },
            { type: 'application', q: 'Which radioactive element is used in smoke detectors?', options: ['Uranium', 'Radium', 'Americium', 'Plutonium'], answer: 'Americium', hint: 'Am-241' },
            { type: 'number', q: 'What is the atomic number of Lead?', options: ['79', '80', '82', '83'], answer: '82', hint: 'Symbol: Pb' }
        ];
        
        // Master questions - expert level, includes typing, tight timer
        const masterQuestions = [
            { type: 'recall', q: 'Type the symbol for Tungsten:', inputType: 'text', answer: 'W', hint: 'From German name' },
            { type: 'number', q: 'Type the atomic number of Gold:', inputType: 'text', answer: '79', hint: 'Between Platinum and Mercury' },
            { type: 'recall', q: 'Type the symbol for Antimony:', inputType: 'text', answer: 'SB', hint: 'From Latin Stibium' },
            { type: 'pattern', q: 'Which electron configuration is correct for Neon?', options: ['1s 2s 2p', '1s 2s 2p', '1s 2s 2p', '1s 2s 2p'], answer: '1s 2s 2p', hint: '10 electrons total' },
            { type: 'property', q: 'What is the electronegativity of Fluorine (Pauling scale)?', options: ['3.98', '3.44', '3.16', '2.96'], answer: '3.98', hint: 'Most electronegative element' },
            { type: 'recall', q: 'Type the element with atomic number 74:', inputType: 'text', answer: 'TUNGSTEN', hint: 'Also accepted: Wolfram' },
            { type: 'pattern', q: 'How many valence electrons does Sulfur have?', options: ['2', '4', '6', '8'], answer: '6', hint: 'Group 16 element' },
            { type: 'number', q: 'Type the atomic number of Oganesson:', inputType: 'text', answer: '118', hint: 'The heaviest known element' },
            { type: 'property', q: 'Which element has an atomic radius of 53 pm?', options: ['Hydrogen', 'Helium', 'Lithium', 'Beryllium'], answer: 'Hydrogen', hint: 'The smallest atom' },
            { type: 'application', q: 'What element is used as a neutron moderator in nuclear reactors?', options: ['Uranium', 'Plutonium', 'Graphite (Carbon)', 'Lead'], answer: 'Graphite (Carbon)', hint: 'Slows down neutrons' },
            { type: 'recall', q: 'Type the symbol for Mercury:', inputType: 'text', answer: 'HG', hint: 'From Hydrargyrum' },
            { type: 'pattern', q: 'What is the oxidation state of Oxygen in most compounds?', options: ['+2', '-1', '-2', '+1'], answer: '-2', hint: 'Except in peroxides' },
            { type: 'property', q: 'Which element has the highest density?', options: ['Gold', 'Platinum', 'Osmium', 'Iridium'], answer: 'Osmium', hint: '22.59 g/cm' },
            { type: 'recall', q: 'Type the symbol for Sodium:', inputType: 'text', answer: 'NA', hint: 'From Latin Natrium' },
            { type: 'application', q: 'Which isotope is used in carbon dating?', options: ['Carbon-12', 'Carbon-13', 'Carbon-14', 'Carbon-11'], answer: 'Carbon-14', hint: 'Radioactive with 5,730 year half-life' }
        ];
        
        const difficultySettings = {
            beginner: { time: 0, questions: beginnerQuestions, points: 10 },
            amateur: { time: 20, questions: amateurQuestions, points: 25 },
            master: { time: 12, questions: masterQuestions, points: 50 }
        };
        
        // Initialize quiz UI when elements exist
        if (document.getElementById('quiz-best')) {
            document.getElementById('quiz-best').textContent = quizBestScore;
        }
        
        // Difficulty button handlers
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                quizDifficulty = this.dataset.difficulty;
                quizScore = 0;
                quizStreak = 0;
                askedQuestions = [];
                document.getElementById('quiz-score').textContent = '0';
                document.getElementById('streak-count').textContent = '0';
                nextQuestion();
            });
        });

        function openQuiz() {
            // Hide any existing tooltip
            const tooltip = document.getElementById('tooltip');
            if (tooltip) tooltip.classList.remove('visible');
            
            document.getElementById('quiz-panel').classList.add('visible');
            quizScore = 0;
            quizStreak = 0;
            askedQuestions = [];
            document.getElementById('quiz-score').textContent = '0';
            document.getElementById('streak-count').textContent = '0';
            document.getElementById('quiz-best').textContent = quizBestScore;
            nextQuestion();
        }

        function closeQuiz() {
            document.getElementById('quiz-panel').classList.remove('visible');
            if (quizTimer) clearInterval(quizTimer);
        }
        window.closeQuiz = closeQuiz;
        
        function skipQuestion() {
            if (quizTimer) clearInterval(quizTimer);
            quizStreak = 0;
            document.getElementById('streak-count').textContent = '0';
            nextQuestion();
        }
        window.skipQuestion = skipQuestion;

        function nextQuestion() {
            if (quizTimer) clearInterval(quizTimer);
            
            const settings = difficultySettings[quizDifficulty];
            const questions = settings.questions;
            
            // Get a random question we haven't asked
            const available = questions.filter((_, i) => !askedQuestions.includes(i));
            if (available.length === 0) {
                askedQuestions = [];
                nextQuestion();
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * available.length);
            const originalIndex = questions.indexOf(available[randomIndex]);
            askedQuestions.push(originalIndex);
            
            const question = questions[originalIndex];
            currentQuizAnswer = question.answer.toUpperCase();
            
            // Update type badge
            document.getElementById('quiz-type-badge').textContent = questionTypes[question.type] || 'General';
            document.getElementById('quiz-question').textContent = question.q;
            document.getElementById('quiz-hint').textContent = question.hint ? ' ' + question.hint : '';
            
            const optionsDiv = document.getElementById('quiz-options');
            optionsDiv.innerHTML = '';
            optionsDiv.className = 'quiz-options';
            
            // Check if it's a text input question
            if (question.inputType === 'text') {
                optionsDiv.classList.add('single-column');
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'quiz-input';
                input.placeholder = 'Type your answer...';
                input.id = 'quiz-text-input';
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        checkTextAnswer(input.value.trim().toUpperCase(), input);
                    }
                });
                optionsDiv.appendChild(input);
                
                const submitBtn = document.createElement('button');
                submitBtn.className = 'btn';
                submitBtn.textContent = ' Submit';
                submitBtn.onclick = () => checkTextAnswer(document.getElementById('quiz-text-input').value.trim().toUpperCase(), document.getElementById('quiz-text-input'));
                optionsDiv.appendChild(submitBtn);
                
                setTimeout(() => input.focus(), 100);
            } else {
                // Multiple choice
                const shuffled = [...question.options].sort(() => Math.random() - 0.5);
                shuffled.forEach(opt => {
                    const btn = document.createElement('div');
                    btn.className = 'quiz-option';
                    btn.textContent = opt;
                    btn.onclick = () => checkAnswer(opt, btn);
                    optionsDiv.appendChild(btn);
                });
            }
            
            // Start timer if applicable
            const timerBar = document.getElementById('quiz-timer-bar');
            if (settings.time > 0) {
                quizTimeLeft = settings.time;
                timerBar.style.width = '100%';
                timerBar.className = 'quiz-timer-bar';
                
                quizTimer = setInterval(() => {
                    quizTimeLeft -= 0.1;
                    const percent = (quizTimeLeft / settings.time) * 100;
                    timerBar.style.width = percent + '%';
                    
                    if (percent < 30) timerBar.className = 'quiz-timer-bar danger';
                    else if (percent < 60) timerBar.className = 'quiz-timer-bar warning';
                    
                    if (quizTimeLeft <= 0) {
                        clearInterval(quizTimer);
                        timeUp();
                    }
                }, 100);
            } else {
                timerBar.style.width = '100%';
                timerBar.className = 'quiz-timer-bar';
            }
        }
        
        function timeUp() {
            const options = document.querySelectorAll('.quiz-option');
            const input = document.getElementById('quiz-text-input');
            
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
                if (opt.textContent.toUpperCase() === currentQuizAnswer) {
                    opt.classList.add('correct');
                }
            });
            
            if (input) {
                input.disabled = true;
                input.classList.add('wrong');
            }
            
            quizStreak = 0;
            document.getElementById('streak-count').textContent = '0';
            
            setTimeout(nextQuestion, 2000);
        }
        
        function checkTextAnswer(answer, input) {
            if (quizTimer) clearInterval(quizTimer);
            input.disabled = true;
            
            // Handle alternate answers
            const alternates = {
                'TUNGSTEN': ['W', 'WOLFRAM'],
                'W': ['TUNGSTEN', 'WOLFRAM']
            };
            
            let isCorrect = answer === currentQuizAnswer;
            if (!isCorrect && alternates[currentQuizAnswer]) {
                isCorrect = alternates[currentQuizAnswer].includes(answer);
            }
            
            if (isCorrect) {
                input.classList.add('correct');
                handleCorrectAnswer();
            } else {
                input.classList.add('wrong');
                handleWrongAnswer();
                input.value = currentQuizAnswer;
            }
            
            setTimeout(nextQuestion, 1500);
        }

        function checkAnswer(answer, btn) {
            if (quizTimer) clearInterval(quizTimer);
            
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
                if (opt.textContent === currentQuizAnswer || opt.textContent.toUpperCase() === currentQuizAnswer) {
                    opt.classList.add('correct');
                }
            });
            
            if (answer === currentQuizAnswer || answer.toUpperCase() === currentQuizAnswer) {
                handleCorrectAnswer();
            } else {
                btn.classList.add('wrong');
                handleWrongAnswer();
            }
            
            setTimeout(nextQuestion, 1500);
        }
        
        function handleCorrectAnswer() {
            const settings = difficultySettings[quizDifficulty];
            const streakBonus = Math.floor(quizStreak / 3) * 5;
            quizScore += settings.points + streakBonus;
            quizStreak++;
            
            document.getElementById('quiz-score').textContent = quizScore;
            document.getElementById('streak-count').textContent = quizStreak;
            
            if (quizScore > quizBestScore) {
                quizBestScore = quizScore;
                localStorage.setItem('quizBestScore', quizBestScore.toString());
                document.getElementById('quiz-best').textContent = quizBestScore;
            }
            
            // Play streak sound for milestones, otherwise correct sound
            if (quizStreak > 0 && quizStreak % 5 === 0) {
                playSound('streak');
                createStreakCelebration();
            } else {
                playSound('correct');
            }
        }
        
        function handleWrongAnswer() {
            quizStreak = 0;
            document.getElementById('streak-count').textContent = '0';
            playSound('wrong');
        }

        document.getElementById('btn-quiz').addEventListener('click', openQuiz);

        // ============================================
        // FULLSCREEN MODE
        // ============================================
        
        let isFullscreen = false;
        
        function toggleFullscreen() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                const elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                }
                isFullscreen = true;
                document.getElementById('btn-fullscreen').innerHTML = '<span></span> Exit Fullscreen';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
                isFullscreen = false;
                document.getElementById('btn-fullscreen').innerHTML = '<span></span> Fullscreen';
            }
        }
        
        document.getElementById('btn-fullscreen').addEventListener('click', toggleFullscreen);
        
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                isFullscreen = false;
                document.getElementById('btn-fullscreen').innerHTML = '<span></span> Fullscreen';
            }
        });
        
        // ============================================
        // STREAK CELEBRATION ANIMATION
        // ============================================
        
        function createStreakCelebration() {
            const colors = ['#ffd700', '#ff6b6b', '#00d4ff', '#1dd1a1', '#a29bfe', '#ff6b35'];
            const quizPanel = document.getElementById('quiz-panel');
            const rect = quizPanel.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Create burst of confetti
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'streak-confetti';
                confetti.style.cssText = `
                    position: fixed;
                    width: ${5 + Math.random() * 10}px;
                    height: ${5 + Math.random() * 10}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${centerX}px;
                    top: ${centerY}px;
                    pointer-events: none;
                    z-index: 10000;
                    border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
                    box-shadow: 0 0 10px currentColor;
                `;
                document.body.appendChild(confetti);
                
                const angle = (Math.PI * 2 * i) / 30;
                const velocity = 5 + Math.random() * 10;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity - 5;
                let x = 0, y = 0, opacity = 1, rotation = 0;
                
                const animateConfetti = () => {
                    x += vx;
                    y += vy + 0.5; // gravity
                    rotation += 10;
                    opacity -= 0.02;
                    confetti.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}deg)`;
                    confetti.style.opacity = opacity;
                    if (opacity > 0) {
                        requestAnimationFrame(animateConfetti);
                    } else {
                        confetti.remove();
                    }
                };
                requestAnimationFrame(animateConfetti);
            }
            
            // Flash effect on quiz panel
            quizPanel.style.boxShadow = '0 0 60px rgba(255, 215, 0, 0.8), 0 0 100px rgba(255, 215, 0, 0.4)';
            setTimeout(() => {
                quizPanel.style.boxShadow = '';
            }, 500);
        }
        
        // ============================================
        // REACTION ANIMATION SYSTEM
        // ============================================
        
        function createReactionAnimation(panel) {
            playSound('reaction');
            
            // Create bubbling effect
            const rect = panel.getBoundingClientRect();
            const colors = ['#00d4ff', '#a29bfe', '#1dd1a1', '#feca57', '#ff6b6b'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'reaction-bubble';
                    const startX = rect.left + Math.random() * rect.width;
                    const startY = rect.bottom - 50;
                    bubble.style.cssText = `
                        position: fixed;
                        width: ${8 + Math.random() * 15}px;
                        height: ${8 + Math.random() * 15}px;
                        background: radial-gradient(circle at 30% 30%, white, ${colors[Math.floor(Math.random() * colors.length)]});
                        border-radius: 50%;
                        left: ${startX}px;
                        top: ${startY}px;
                        pointer-events: none;
                        z-index: 9999;
                        opacity: 0.8;
                        box-shadow: 0 0 10px currentColor, inset 0 0 10px rgba(255,255,255,0.5);
                    `;
                    document.body.appendChild(bubble);
                    
                    let y = 0;
                    let x = (Math.random() - 0.5) * 2;
                    let opacity = 0.8;
                    const animateBubble = () => {
                        y -= 2 + Math.random() * 2;
                        x += (Math.random() - 0.5) * 0.5;
                        opacity -= 0.01;
                        bubble.style.transform = `translate(${x * 10}px, ${y}px) scale(${1 + Math.abs(y) * 0.002})`;
                        bubble.style.opacity = opacity;
                        if (opacity > 0 && y > -150) {
                            requestAnimationFrame(animateBubble);
                        } else {
                            bubble.remove();
                        }
                    };
                    requestAnimationFrame(animateBubble);
                }, i * 30);
            }
            
            // Create energy sparks
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const spark = document.createElement('div');
                    spark.className = 'reaction-spark';
                    spark.style.cssText = `
                        position: fixed;
                        width: 3px;
                        height: 3px;
                        background: #fff;
                        left: ${rect.left + rect.width / 2}px;
                        top: ${rect.top + rect.height / 2}px;
                        pointer-events: none;
                        z-index: 9999;
                        border-radius: 50%;
                        box-shadow: 0 0 10px #00d4ff, 0 0 20px #00d4ff;
                    `;
                    document.body.appendChild(spark);
                    
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 3 + Math.random() * 5;
                    let x = 0, y = 0, opacity = 1;
                    const animateSpark = () => {
                        x += Math.cos(angle) * speed;
                        y += Math.sin(angle) * speed;
                        opacity -= 0.03;
                        spark.style.transform = `translate(${x}px, ${y}px)`;
                        spark.style.opacity = opacity;
                        if (opacity > 0) {
                            requestAnimationFrame(animateSpark);
                        } else {
                            spark.remove();
                        }
                    };
                    requestAnimationFrame(animateSpark);
                }, i * 20);
            }
        }

        // ============================================
        // ENHANCED COMBINE FUNCTION
        // ============================================
        
        // Override the original combineElements to track discoveries
        const originalCombine = combineElements;
        combineElements = function() {
            if (selectedElements.length < 2) {
                alert('Please select at least 2 elements to combine.');
                return;
            }

            const symbols = selectedElements.map(e => e.symbol).sort().join('-');
            const compound = compounds[symbols];

            const resultDiv = document.getElementById('compound-result');
            const panel = document.getElementById('combination-panel');
            
            // Trigger reaction animation
            createReactionAnimation(panel);
            
            // Epic energy burst animation
            panel.classList.add('combine-flash');
            setTimeout(() => panel.classList.remove('combine-flash'), 1000);
            
            if (compound) {
                const totalMass = selectedElements.reduce((sum, e) => sum + e.mass, 0);
                resultDiv.innerHTML = `
                    <div class="compound-formula">${compound.formula}</div>
                    <div class="compound-name">${compound.name}</div>
                    <div class="compound-details">
                        <div class="compound-detail-item">
                            <div class="compound-detail-label">Molar Mass</div>
                            <div class="compound-detail-value">${compound.molarMass} g/mol</div>
                        </div>
                        <div class="compound-detail-item">
                            <div class="compound-detail-label">Bond Type</div>
                            <div class="compound-detail-value">${compound.type}</div>
                        </div>
                        <div class="compound-detail-item">
                            <div class="compound-detail-label">Combined Mass</div>
                            <div class="compound-detail-value">${totalMass.toFixed(3)} u</div>
                        </div>
                    </div>
                    <div class="compound-description">${compound.description}</div>
                `;
                
                // Track discovery
                addDiscovery(symbols, compound.name);
            } else {
                const formula = selectedElements.map(e => e.symbol).join('');
                const totalMass = selectedElements.reduce((sum, e) => sum + e.mass, 0);
                resultDiv.innerHTML = `
                    <div class="compound-formula">${formula}?</div>
                    <div class="compound-name">Unknown Compound</div>
                    <div class="compound-description">
                        This combination doesn't form a common compound in our database. 
                        Combined atomic mass: ${totalMass.toFixed(3)} u
                        <br><br>
                        Try combining elements that commonly bond together like H + O for water, or Na + Cl for salt!
                    </div>
                `;
            }
            
            resultDiv.classList.add('visible');
        };

        // Load saved data
        loadDiscoveries();

        // ============================================
        // REACTION LAB MODE
        // ============================================
        
        let labElements = [];
        let isReacting = false;
        let beakerDamaged = false;
        
        // Reaction definitions with scientifically accurate visual effects
        // Flame colors based on actual emission spectra
        const labReactions = {
            'Na-H2O': {
                name: 'Sodium + Water',
                equation: '2Na(s) + 2HO(l)  2NaOH(aq) + H(g)',
                description: 'Sodium floats on water (density 0.97 g/cm), melts from reaction heat (mp 98C), and skates across the surface. The evolved H gas often ignites with a characteristic golden-yellow flame (589nm Na emission). Highly exothermic: H = -184 kJ/mol.',
                effects: ['fizz', 'fire', 'bubbles', 'steam'],
                canBreakBeaker: false,
                flameColor: '#FFD700', // Golden yellow - sodium emission at 589nm
                liquidColor: '#e8e8ff', // Slightly basic/milky from NaOH
                color: '#FFD700',
                intensity: 'high',
                duration: 3000
            },
            'K-H2O': {
                name: 'Potassium + Water',
                equation: '2K(s) + 2HO(l)  2KOH(aq) + H(g)',
                description: 'Potassium reacts more violently than sodium (lower ionization energy). The hydrogen gas immediately ignites with a distinctive lilac/violet flame (766nm K emission). Often explodes due to rapid H production. H = -196 kJ/mol.',
                effects: ['explosion', 'fire', 'bubbles', 'sparks', 'steam'],
                canBreakBeaker: true,
                spreadsFire: true,
                flameColor: '#DDA0DD', // Lilac/violet - potassium emission at 766nm  
                liquidColor: '#f0e8ff',
                color: '#9932CC',
                intensity: 'extreme',
                duration: 2500
            },
            'Li-H2O': {
                name: 'Lithium + Water',
                equation: '2Li(s) + 2HO(l)  2LiOH(aq) + H(g)',
                description: 'Lithium reacts steadily but less violently than Na/K (smaller atomic radius = stronger metallic bonding). Fizzes consistently, may ignite with a crimson-red flame (670nm Li emission). H = -222 kJ/mol per mole Li.',
                effects: ['bubbles', 'fizz', 'steam'],
                flameColor: '#DC143C', // Crimson red - lithium emission at 670nm
                liquidColor: '#fff8f8',
                color: '#DC143C',
                intensity: 'medium',
                duration: 4000
            },
            'Mg-H2O': {
                name: 'Magnesium + Water',
                equation: 'Mg(s) + 2HO(l)  Mg(OH)(s) + H(g)',
                description: 'At room temperature, Mg reacts very slowly due to protective MgO layer. With hot water/steam, reaction is faster. Produces white Mg(OH) precipitate (milk of magnesia). Mg has +2 oxidation state.',
                effects: ['bubbles', 'smoke'],
                flameColor: '#FFFFFF',
                liquidColor: '#f0f0f0', // Milky white from precipitate
                color: '#FFFFFF',
                intensity: 'low',
                duration: 5000
            },
            'Ca-H2O': {
                name: 'Calcium + Water',
                equation: 'Ca(s) + 2HO(l)  Ca(OH)(aq) + H(g)',
                description: 'Calcium sinks (density 1.55 g/cm) and reacts moderately, producing hydrogen bubbles and milky Ca(OH) (limewater). Brick-red flame color (622nm Ca emission) if ignited. Solution becomes basic (pH ~12).',
                effects: ['bubbles', 'fizz', 'smoke'],
                flameColor: '#CD5C5C', // Brick red/orange-red - calcium emission
                liquidColor: '#fff5f0', // Milky
                color: '#CD5C5C',
                intensity: 'medium',
                duration: 3500
            },
            'Fe-O': {
                name: 'Iron Oxidation (Rusting)',
                equation: '4Fe(s) + 3O(g)  2FeO(s)',
                description: 'Slow oxidation at room temperature requires moisture as catalyst. Fe loses electrons (FeFe+3e). The hydrated iron(III) oxide (rust) is reddish-brown. Process takes hours/days in reality. H = -1648 kJ/mol.',
                effects: ['colorChange'],
                flameColor: null,
                liquidColor: '#8B4513', // Rust brown
                color: '#8B4513',
                intensity: 'low',
                duration: 6000
            },
            'H-O': {
                name: 'Oxyhydrogen Reaction',
                equation: '2H(g) + O(g)  2HO(g)',
                description: 'The "knallgas" reaction - explosive when H:O ratio is 2:1. Requires ignition (activation energy ~572 kJ/mol). Produces only water vapor - the cleanest combustion. Flame temp reaches 2800C. H = -572 kJ/mol.',
                effects: ['explosion', 'steam', 'flash'],
                canBreakBeaker: true,
                spreadsFire: false,
                flameColor: '#87CEEB', // Pale blue - hydrogen flame
                liquidColor: '#e0f0ff',
                color: '#87CEEB',
                intensity: 'extreme',
                duration: 1500
            },
            'C-O': {
                name: 'Carbon Combustion',
                equation: 'C(s) + O(g)  CO(g)',
                description: 'Complete combustion of carbon (graphite/coal) produces CO. Glows orange-red when burning (blackbody radiation ~1000-1500C). Incomplete combustion produces toxic CO. H = -394 kJ/mol. No flame color - incandescence only.',
                effects: ['fire', 'smoke'],
                flameColor: '#FF4500', // Orange-red glow (incandescence, not emission)
                liquidColor: '#444444',
                color: '#FF4500',
                intensity: 'medium',
                duration: 4000
            },
            'Mg-O': {
                name: 'Magnesium Combustion',
                equation: '2Mg(s) + O(g)  2MgO(s)',
                description: 'Magnesium burns with intense brilliant white light (3100C) - used in old camera flashes and flares. Produces white MgO ash. Do NOT look directly at burning Mg - can cause eye damage. H = -1204 kJ/mol.',
                effects: ['flash', 'fire', 'sparks', 'smoke'],
                canBreakBeaker: true,
                spreadsFire: true,
                flameColor: '#FFFFFF', // Brilliant white
                liquidColor: '#f8f8f8',
                color: '#FFFFFF',
                intensity: 'extreme',
                duration: 2000
            },
            'Na-Cl': {
                name: 'Sodium + Chlorine',
                equation: '2Na(s) + Cl(g)  2NaCl(s)',
                description: 'Highly exothermic reaction between an alkali metal and halogen. Sodium burns with golden-yellow flame in chlorine gas. Produces white NaCl crystals (table salt). H = -411 kJ/mol. Ionic bonding forms.',
                effects: ['fire', 'sparks', 'smoke'],
                flameColor: '#FFD700', // Golden yellow from sodium
                liquidColor: '#ffffee',
                color: '#FFD700',
                intensity: 'high',
                duration: 2500
            },
            'Cu-S': {
                name: 'Copper + Sulfur',
                equation: 'Cu(s) + S(s)  CuS(s)',
                description: 'Requires heating to initiate. Copper(II) sulfide forms as a black solid. The reaction produces blue-green flame from copper emission (510-578nm). Sulfur may burn with pale blue flame first. H = -53 kJ/mol.',
                effects: ['colorChange', 'smoke', 'fire'],
                flameColor: '#00CED1', // Blue-green copper flame
                liquidColor: '#1a1a2e', // Dark blue-black
                color: '#00CED1',
                intensity: 'medium',
                duration: 3500
            },
            'Zn-H': {
                name: 'Zinc + Acid',
                equation: 'Zn(s) + 2HCl(aq)  ZnCl(aq) + H(g)',
                description: 'Single displacement reaction - Zn is above H in reactivity series. Zinc dissolves as Zn ions form. Hydrogen gas evolves as bubbles. Rate increases with acid concentration and temperature. H = -152 kJ/mol.',
                effects: ['bubbles', 'fizz'],
                flameColor: '#98FB98', // Pale green if H ignited
                liquidColor: '#f0fff0',
                color: '#98FB98',
                intensity: 'medium',
                duration: 4000
            },
            'Ag-S': {
                name: 'Silver Tarnishing',
                equation: '2Ag(s) + S(s)  AgS(s)',
                description: 'Silver sulfide (tarnish) forms slowly when silver contacts sulfur compounds (eggs, air pollution). Black AgS layer is only nanometers thick initially. Silver has lowest reactivity among common metals. H = -32 kJ/mol.',
                effects: ['colorChange'],
                flameColor: null,
                liquidColor: '#2a2a3a', // Black tarnish
                color: '#2a2a3a',
                intensity: 'low',
                duration: 5000
            },
            'P-O': {
                name: 'Phosphorus Combustion',
                equation: 'P(s) + 5O(g)  PO(s)',
                description: 'White phosphorus (P) ignites spontaneously in air at 34C! Burns with yellow-white flame, producing dense white PO smoke. Extremely dangerous - causes severe chemical burns. H = -2984 kJ/mol.',
                effects: ['fire', 'smoke', 'sparks'],
                flameColor: '#FFFFE0', // Yellow-white
                liquidColor: '#ffffcc',
                color: '#FFFFE0',
                intensity: 'high',
                duration: 3000
            },
            'Al-Fe': {
                name: 'Thermite Reaction',
                equation: '2Al(s) + FeO(s)  AlO(s) + 2Fe(l)',
                description: 'Extremely exothermic redite reaction reaches 2500C! Al reduces FeO, producing molten iron. Used for welding railroad tracks. Requires Mg ribbon to initiate (high activation energy). H = -852 kJ/mol. CAUTION: Cannot be extinguished with water!',
                effects: ['explosion', 'fire', 'sparks', 'flash'],
                canBreakBeaker: true,
                spreadsFire: true,
                causesLeak: true,
                flameColor: '#FF4500', // Brilliant orange-white
                liquidColor: '#ff6600', // Molten iron glow
                color: '#FF4500',
                intensity: 'extreme',
                duration: 4000
            }
        };
        
        // Populate element tray
        function populateElementTray() {
            const tray = document.getElementById('tray-elements');
            // Clear existing elements to prevent duplicates
            tray.innerHTML = '';
            
            const interestingElements = [
                'H', 'He', 'Li', 'C', 'N', 'O', 'F', 'Na', 'Mg', 'Al', 'Si', 'P', 'S', 'Cl', 'K', 'Ca',
                'Fe', 'Cu', 'Zn', 'Ag', 'Au', 'Hg', 'Pb', 'U'
            ];
            
            interestingElements.forEach(symbol => {
                const element = elements.find(e => e.symbol === symbol);
                if (element) {
                    const color = categoryColors[element.category] || '#888888';
                    const div = document.createElement('div');
                    div.className = 'tray-element';
                    div.style.borderColor = color;
                    div.innerHTML = `
                        <span class="symbol" style="color: ${color}">${element.symbol}</span>
                        <span class="number">${element.number}</span>
                    `;
                    div.onclick = () => addToBeaker(element);
                    tray.appendChild(div);
                }
            });
        }
        
        function addToBeaker(element) {
            if (isReacting || labElements.length >= 3) return;
            
            playSound('click');
            labElements.push(element);
            
            const liquid = document.getElementById('beaker-liquid');
            const color = categoryColors[element.category] || '#888888';
            
            // Create drip effect when adding element
            createDrip(element);
            
            // Create element chip in beaker with entrance animation
            setTimeout(() => {
                const chip = document.createElement('div');
                chip.className = 'beaker-element';
                chip.style.borderColor = color;
                chip.style.color = color;
                chip.style.left = (20 + labElements.length * 50) + 'px';
                chip.style.bottom = (20 + Math.random() * 80) + 'px';
                chip.style.boxShadow = `0 0 15px ${color}66, inset 0 0 10px ${color}33`;
                chip.textContent = element.symbol;
                chip.onclick = () => {
                    chip.style.animation = 'bubbleFloat 0.3s ease-out forwards';
                    setTimeout(() => {
                        chip.remove();
                        labElements = labElements.filter(e => e !== element);
                        checkReaction();
                    }, 300);
                };
                liquid.appendChild(chip);
                
                // Create splash and bubbles on impact
                createSplash(color);
                createBubbles(5);
            }, 400);
            
            checkReaction();
        }
        
        function checkReaction() {
            if (labElements.length < 2) {
                hideReactionInfo();
                return;
            }
            
            const symbols = labElements.map(e => e.symbol).sort();
            let reactionKey = null;
            
            // Check for water-reactive metals
            if (symbols.includes('H') && symbols.includes('O')) {
                // Water is present
                const waterReactive = ['Na', 'K', 'Li', 'Ca', 'Mg'];
                for (const metal of waterReactive) {
                    if (symbols.includes(metal)) {
                        reactionKey = metal + '-H2O';
                        break;
                    }
                }
                if (!reactionKey && symbols.includes('H') && symbols.includes('O')) {
                    reactionKey = 'H-O';
                }
            }
            
            // Check other reactions
            if (!reactionKey) {
                const pairs = [
                    ['Na', 'Cl'], ['Fe', 'O'], ['C', 'O'], ['Mg', 'O'],
                    ['Cu', 'S'], ['Ag', 'S'], ['P', 'O'], ['Al', 'Fe']
                ];
                for (const [a, b] of pairs) {
                    if (symbols.includes(a) && symbols.includes(b)) {
                        reactionKey = a + '-' + b;
                        break;
                    }
                }
            }
            
            if (reactionKey && labReactions[reactionKey]) {
                triggerReaction(labReactions[reactionKey]);
            }
        }
        
        function triggerReaction(reaction) {
            isReacting = true;
            const liquid = document.getElementById('beaker-liquid');
            liquid.classList.add('reacting');
            
            playSound('success');
            
            // Show reaction info
            showReactionInfo(reaction);
            
            // Activate reaction glow with accurate color
            const reactionGlow = liquid.querySelector('.reaction-glow');
            const glowColor = reaction.flameColor || reaction.color;
            if (reactionGlow) {
                reactionGlow.style.background = `radial-gradient(ellipse at center bottom, ${glowColor}66 0%, transparent 70%)`;
                reactionGlow.style.opacity = '1';
            }
            
            // Use accurate flame color for fire effects
            const flameColor = reaction.flameColor || reaction.color;
            
            // Trigger effects based on reaction with scientifically accurate timing
            if (reaction.effects.includes('bubbles')) {
                // H gas evolution - steady bubbling
                createBubbles(20);
                const bubbleInterval = setInterval(() => createBubbles(6), 350);
                setTimeout(() => clearInterval(bubbleInterval), reaction.duration || 3000);
            }
            if (reaction.effects.includes('fizz')) {
                // Vigorous gas evolution - rapid small bubbles
                const fizzInterval = setInterval(() => createBubbles(15), 100);
                setTimeout(() => clearInterval(fizzInterval), reaction.duration || 3000);
            }
            if (reaction.effects.includes('fire')) {
                // Use accurate flame color based on emission spectrum
                createFire(flameColor, reaction.intensity);
            }
            if (reaction.effects.includes('explosion')) {
                // Delay based on reaction kinetics
                const delay = reaction.intensity === 'extreme' ? 200 : 500;
                setTimeout(() => createExplosion(flameColor, reaction.intensity), delay);
            }
            if (reaction.effects.includes('sparks')) {
                // Sparks from molten metal droplets
                const sparkCount = reaction.intensity === 'extreme' ? 60 : 35;
                createSparks(sparkCount, flameColor);
                setTimeout(() => createSparks(Math.floor(sparkCount / 2), flameColor), 400);
            }
            if (reaction.effects.includes('smoke')) {
                // Smoke/fumes from reaction products
                createSmoke(reaction.color);
            }
            if (reaction.effects.includes('flash')) {
                // Bright flash (Mg combustion, thermite)
                createFlash(reaction.intensity);
            }
            if (reaction.effects.includes('colorChange')) {
                // Precipitate or oxidation color change
                liquid.style.background = `linear-gradient(180deg, ${reaction.liquidColor || reaction.color}88, ${reaction.liquidColor || reaction.color}aa)`;
                liquid.style.transition = 'background 2s ease'; // Slower for realistic color change
            }
            if (reaction.effects.includes('steam')) {
                // Water vapor from exothermic reactions
                createSteam();
            }
            
            // Realistic physical effects for dangerous reactions
            if (reaction.canBreakBeaker && !beakerDamaged) {
                // Delay the break effect for dramatic timing
                const breakDelay = reaction.intensity === 'extreme' ? 800 : 1200;
                setTimeout(() => {
                    createBeakerCrack(reaction.intensity);
                    if (reaction.intensity === 'extreme') {
                        setTimeout(() => createBeakerShatter(reaction.color), 400);
                    }
                }, breakDelay);
            }
            
            if (reaction.spreadsFire) {
                // Fire spreads outside the beaker
                const fireDelay = reaction.intensity === 'extreme' ? 600 : 1000;
                setTimeout(() => createSpreadingFire(reaction.flameColor || reaction.color), fireDelay);
            }
            
            if (reaction.causesLeak) {
                // Liquid leaks from cracks
                setTimeout(() => createLiquidLeak(reaction.liquidColor || reaction.color), 1500);
            }
            
            // Change liquid color based on reaction products
            liquid.style.transition = 'background 0.5s ease, box-shadow 0.5s ease';
            const liquidCol = reaction.liquidColor || reaction.color;
            
            if (reaction.intensity === 'extreme') {
                liquid.style.background = `linear-gradient(180deg, ${liquidCol}55, ${liquidCol}88)`;
                liquid.style.boxShadow = `inset 0 0 40px ${flameColor}66, 0 0 30px ${flameColor}44`;
                document.getElementById('reaction-lab').style.animation = 'labShake 0.12s ease-in-out 8';
            } else if (reaction.intensity === 'high') {
                liquid.style.background = `linear-gradient(180deg, ${liquidCol}44, ${liquidCol}77)`;
                liquid.style.boxShadow = `inset 0 0 25px ${flameColor}44, 0 0 20px ${flameColor}33`;
                document.getElementById('reaction-lab').style.animation = 'labShake 0.2s ease-in-out 3';
            } else if (reaction.intensity === 'medium') {
                liquid.style.background = `linear-gradient(180deg, ${liquidCol}33, ${liquidCol}55)`;
            }
            
            const reactionDuration = reaction.duration || 3500;
            setTimeout(() => {
                isReacting = false;
                liquid.classList.remove('reacting');
                if (reactionGlow) reactionGlow.style.opacity = '0';
                liquid.style.boxShadow = '';
            }, reactionDuration);
        }
        
        function createBubbles(count) {
            const liquid = document.getElementById('beaker-liquid');
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    // Hydrogen bubbles are small, CO bubbles vary more
                    const size = 3 + Math.random() * 10;
                    bubble.style.width = size + 'px';
                    bubble.style.height = size + 'px';
                    bubble.style.left = (10 + Math.random() * 160) + 'px';
                    bubble.style.bottom = '5px';
                    // Smaller bubbles rise faster (Stokes' law approximation)
                    const duration = 1.2 + (size / 15) * 1.5;
                    bubble.style.setProperty('--duration', duration + 's');
                    bubble.style.setProperty('--rise', -(70 + Math.random() * 110) + 'px');
                    bubble.style.animationDuration = duration + 's';
                    liquid.appendChild(bubble);
                    setTimeout(() => bubble.remove(), duration * 1000 + 500);
                }, i * 30 + Math.random() * 40);
            }
        }
        
        function createFire(color, intensity = 'medium') {
            const container = document.getElementById('fire-container');
            container.classList.add('active');
            container.innerHTML = '';
            
            // Flame count and size based on reaction intensity
            const flameCount = intensity === 'extreme' ? 9 : (intensity === 'high' ? 7 : 5);
            const heightMult = intensity === 'extreme' ? 1.4 : (intensity === 'high' ? 1.2 : 1.0);
            
            // Parse the flame color to create realistic gradient
            // Real flames have blue base (hottest), then color, then darker tips
            const isWhiteFlame = color === '#FFFFFF' || color === '#ffffff';
            const isBluePaleFlame = color === '#87CEEB'; // Hydrogen
            
            // Main flames - multiple layers with accurate colors
            for (let i = 0; i < flameCount; i++) {
                // Outer flame (cooler, shows characteristic color)
                const flameOuter = document.createElement('div');
                flameOuter.className = 'flame flame-outer';
                flameOuter.style.left = (15 + i * (150 / flameCount)) + 'px';
                flameOuter.style.width = (25 + Math.random() * 18) + 'px';
                flameOuter.style.height = ((45 + Math.random() * 35) * heightMult) + 'px';
                
                if (isWhiteFlame) {
                    // Magnesium - brilliant white
                    flameOuter.style.background = `radial-gradient(ellipse at bottom, #ffffffee 0%, #ffffccaa 40%, transparent 75%)`;
                } else if (isBluePaleFlame) {
                    // Hydrogen - pale blue, nearly invisible
                    flameOuter.style.background = `radial-gradient(ellipse at bottom, #add8e6cc 0%, #87ceeb88 50%, transparent 80%)`;
                } else {
                    flameOuter.style.background = `radial-gradient(ellipse at bottom, ${color}dd 0%, ${color}88 40%, transparent 75%)`;
                }
                flameOuter.style.animationDelay = (Math.random() * 0.15) + 's';
                container.appendChild(flameOuter);
                
                // Mid flame (transition zone)
                const flameMid = document.createElement('div');
                flameMid.className = 'flame flame-mid';
                flameMid.style.left = (20 + i * (150 / flameCount)) + 'px';
                flameMid.style.width = (16 + Math.random() * 12) + 'px';
                flameMid.style.height = ((32 + Math.random() * 25) * heightMult) + 'px';
                
                if (isWhiteFlame) {
                    flameMid.style.background = `radial-gradient(ellipse at bottom, #ffffff 0%, #ffffee 50%, transparent 85%)`;
                } else {
                    // Blend towards white/yellow in hotter zone
                    flameMid.style.background = `radial-gradient(ellipse at bottom, #ffffee 0%, ${color}cc 50%, transparent 85%)`;
                }
                flameMid.style.animationDelay = (Math.random() * 0.1) + 's';
                container.appendChild(flameMid);
                
                // Core flame (hottest - blue/white for most flames)
                const flameCore = document.createElement('div');
                flameCore.className = 'flame flame-core';
                flameCore.style.left = (24 + i * (150 / flameCount)) + 'px';
                flameCore.style.width = (8 + Math.random() * 8) + 'px';
                flameCore.style.height = ((18 + Math.random() * 15) * heightMult) + 'px';
                
                // Hottest part is always near white/blue
                flameCore.style.background = `radial-gradient(ellipse at bottom, #ffffffee 0%, #ffffddcc 60%, transparent 95%)`;
                flameCore.style.animationDelay = (Math.random() * 0.08) + 's';
                container.appendChild(flameCore);
            }
            
            // Create embers with accurate colors
            const emberCount = intensity === 'extreme' ? 25 : (intensity === 'high' ? 18 : 12);
            createEmbers(container, color, emberCount);
            
            const duration = intensity === 'extreme' ? 4000 : (intensity === 'high' ? 3500 : 3000);
            setTimeout(() => {
                container.classList.remove('active');
            }, duration);
        }
        
        function createEmbers(container, color, count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const ember = document.createElement('div');
                    ember.className = 'ember';
                    ember.style.left = (30 + Math.random() * 120) + 'px';
                    ember.style.bottom = (40 + Math.random() * 30) + 'px';
                    ember.style.background = Math.random() > 0.5 ? color : '#ffaa00';
                    ember.style.boxShadow = `0 0 4px 2px ${color}`;
                    const tx = (Math.random() - 0.5) * 80;
                    const ty = -(50 + Math.random() * 80);
                    ember.style.setProperty('--tx', tx + 'px');
                    ember.style.setProperty('--ty', ty + 'px');
                    container.appendChild(ember);
                    setTimeout(() => ember.remove(), 1500);
                }, i * 100);
            }
        }
        
        function createExplosion(color, intensity = 'high') {
            const beaker = document.getElementById('beaker');
            const lab = document.getElementById('reaction-lab');
            
            // Flash effect first - brighter for more intense reactions
            const flash = document.createElement('div');
            flash.className = 'explosion-flash';
            if (intensity === 'extreme') {
                flash.style.background = 'radial-gradient(circle, white 0%, rgba(255,255,255,0.95) 40%, transparent 70%)';
            }
            beaker.appendChild(flash);
            setTimeout(() => flash.remove(), intensity === 'extreme' ? 600 : 400);
            
            // Explosion container
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            
            // Ring count and particle count based on intensity
            const ringCount = intensity === 'extreme' ? 6 : 4;
            const particleCount = intensity === 'extreme' ? 50 : 30;
            const debrisCount = intensity === 'extreme' ? 18 : 12;
            
            // Create shockwave rings with emission-accurate colors
            for (let i = 0; i < ringCount; i++) {
                const ring = document.createElement('div');
                ring.className = 'explosion-ring';
                // Inner rings are white (hottest), outer show characteristic emission color
                ring.style.borderColor = i < 2 ? '#ffffff' : color;
                ring.style.borderWidth = (4 - (i * 0.5)) + 'px';
                ring.style.setProperty('--duration', (0.4 + i * 0.15) + 's');
                ring.style.animationDelay = (i * 0.08) + 's';
                explosion.appendChild(ring);
            }
            
            // Create explosion particles with emission-accurate colors
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'explosion-particle';
                // Particles show characteristic emission color more prominently
                const roll = Math.random();
                const hue = roll > 0.5 ? color : (roll > 0.25 ? '#ffffff' : '#ffee88');
                particle.style.background = hue;
                particle.style.boxShadow = `0 0 6px 2px ${color}`;
                const angle = (i / particleCount) * Math.PI * 2 + Math.random() * 0.3;
                const dist = intensity === 'extreme' ? (100 + Math.random() * 160) : (80 + Math.random() * 120);
                particle.style.setProperty('--tx', Math.cos(angle) * dist + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * dist - 30 + 'px');
                particle.style.animationDelay = (Math.random() * 0.1) + 's';
                explosion.appendChild(particle);
            }
            
            // Create debris (molten metal droplets for alkali metals)
            for (let i = 0; i < debrisCount; i++) {
                const debris = document.createElement('div');
                debris.className = 'debris';
                const angle = Math.random() * Math.PI * 2;
                const distance = intensity === 'extreme' ? (80 + Math.random() * 140) : (60 + Math.random() * 100);
                debris.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                debris.style.setProperty('--ty', Math.sin(angle) * distance - 40 + 'px');
                debris.style.setProperty('--rot', (Math.random() * 720 - 360) + 'deg');
                // Debris shows molten metal (hot) or cooled fragments
                debris.style.background = Math.random() > 0.4 ? color : '#888';
                explosion.appendChild(debris);
            }
            
            beaker.appendChild(explosion);
            
            // Enhanced screen shake - more intense for extreme reactions
            lab.style.animation = 'none';
            lab.offsetHeight; // Force reflow
            const shakeIntensity = intensity === 'extreme' ? 'labShake 0.06s ease-in-out 10' : 'labShake 0.08s ease-in-out 6';
            lab.style.animation = shakeIntensity;
            
            setTimeout(() => explosion.remove(), 1200);
            
            // Create splash effect from explosion
            createSplash(color);
        }
        
        function createSplash(color) {
            const liquid = document.getElementById('beaker-liquid');
            const splash = document.createElement('div');
            splash.className = 'splash';
            splash.style.left = '50%';
            splash.style.bottom = '60%';
            liquid.appendChild(splash);
            
            // Create splash droplets
            for (let i = 0; i < 8; i++) {
                const drop = document.createElement('div');
                drop.className = 'splash-drop';
                const angle = (i / 8) * Math.PI + Math.PI;
                const distance = 30 + Math.random() * 40;
                drop.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                drop.style.setProperty('--ty', Math.sin(angle) * distance - 20 + 'px');
                drop.style.background = color || '#00d4ff';
                splash.appendChild(drop);
            }
            
            setTimeout(() => splash.remove(), 800);
        }
        
        function createSparks(count, sparkColor = '#ffcc00') {
            const beaker = document.getElementById('beaker');
            
            // Parse the reaction color for accurate spark colors
            // Sparks follow same emission spectra as flames
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const spark = document.createElement('div');
                    spark.className = 'spark';
                    spark.style.left = (40 + Math.random() * 100) + 'px';
                    spark.style.top = '25%';
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 40 + Math.random() * 100;
                    spark.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                    spark.style.setProperty('--ty', Math.sin(angle) * distance - 60 + 'px');
                    spark.style.setProperty('--duration', (0.4 + Math.random() * 0.4) + 's');
                    
                    // Sparks use reaction-specific emission color with hot white cores
                    // Higher energy sparks are whiter, cooler ones show characteristic color
                    const roll = Math.random();
                    if (roll > 0.6) {
                        spark.style.background = '#ffffff'; // Hot white core
                    } else if (roll > 0.3) {
                        spark.style.background = sparkColor; // Characteristic emission color
                    } else {
                        spark.style.background = '#ffee88'; // Generic incandescent
                    }
                    spark.style.boxShadow = `0 0 3px 1px ${sparkColor}`;
                    
                    beaker.appendChild(spark);
                    setTimeout(() => spark.remove(), 800);
                }, i * 25 + Math.random() * 20);
            }
        }
        
        function createSmoke(smokeColor = '#666666') {
            const beaker = document.getElementById('beaker');
            
            // Different reactions produce different colored smoke/fumes
            // Metal oxides: white (MgO, Al2O3)
            // Sulfur compounds: yellow-brown
            // Nitrogen oxides: brown
            // General combustion: gray-black
            
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const smoke = document.createElement('div');
                    smoke.className = 'smoke';
                    const size = 25 + Math.random() * 35;
                    smoke.style.width = size + 'px';
                    smoke.style.height = size + 'px';
                    smoke.style.left = (30 + Math.random() * 100) + 'px';
                    smoke.style.top = '15%';
                    smoke.style.setProperty('--duration', (2 + Math.random() * 1.5) + 's');
                    smoke.style.setProperty('--tx', ((Math.random() - 0.5) * 60) + 'px');
                    
                    // Create realistic smoke with color tinting
                    smoke.style.background = `radial-gradient(circle, ${smokeColor}88 0%, ${smokeColor}44 50%, transparent 70%)`;
                    
                    beaker.appendChild(smoke);
                    setTimeout(() => smoke.remove(), 4000);
                }, i * 180);
            }
        }
        
        function createFlash(intensity = 'medium') {
            const lab = document.getElementById('reaction-lab');
            const flash = document.createElement('div');
            flash.className = 'explosion-flash';
            
            // Intensity affects brightness and duration
            // Extreme: Mg burning (brightest), thermite
            // High: K + H2O explosion, H2 + O2
            // Medium: Standard combustion
            
            const opacity = intensity === 'extreme' ? '1' : (intensity === 'high' ? '0.9' : '0.7');
            const duration = intensity === 'extreme' ? '0.8s' : (intensity === 'high' ? '0.6s' : '0.4s');
            
            flash.style.cssText = `
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: radial-gradient(circle at center, white 0%, rgba(255,255,255,${opacity}) 30%, transparent 70%);
                z-index: 9999;
                animation: explosionFlash ${duration} ease-out forwards;
                pointer-events: none;
            `;
            lab.appendChild(flash);
            
            const dur = intensity === 'extreme' ? 800 : (intensity === 'high' ? 600 : 400);
            setTimeout(() => flash.remove(), dur);
        }
        
        function createSteam() {
            const beaker = document.getElementById('beaker');
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const steam = document.createElement('div');
                    steam.className = 'steam';
                    const size = 15 + Math.random() * 25;
                    steam.style.width = size + 'px';
                    steam.style.height = size + 'px';
                    steam.style.left = (35 + Math.random() * 90) + 'px';
                    steam.style.top = '5%';
                    steam.style.setProperty('--tx', ((Math.random() - 0.5) * 40) + 'px');
                    steam.style.setProperty('--duration', (1.5 + Math.random() * 1) + 's');
                    beaker.appendChild(steam);
                    setTimeout(() => steam.remove(), 2500);
                }, i * 120);
            }
        }
        
        function createDrip(element) {
            const liquid = document.getElementById('beaker-liquid');
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const drip = document.createElement('div');
                    drip.className = 'drip';
                    drip.style.left = (20 + Math.random() * 140) + 'px';
                    drip.style.top = '0';
                    drip.style.background = categoryColors[element.category] || '#00d4ff';
                    liquid.appendChild(drip);
                    setTimeout(() => drip.remove(), 1200);
                }, i * 200);
            }
        }
        
        // ============================================
        // REALISTIC DAMAGE EFFECTS
        // ============================================
        
        // Create cracks on the beaker from violent reactions
        function createBeakerCrack(intensity) {
            if (beakerDamaged) return;
            beakerDamaged = true;
            
            const beaker = document.getElementById('beaker');
            beaker.classList.add('cracked');
            
            playSound('click'); // Cracking sound
            
            // Create multiple crack lines
            const crackCount = intensity === 'extreme' ? 5 : 3;
            for (let i = 0; i < crackCount; i++) {
                const crack = document.createElement('div');
                crack.className = 'crack';
                
                // Random position and angle for realistic cracks
                const startX = 20 + Math.random() * 140;
                const startY = 30 + Math.random() * 150;
                const length = 30 + Math.random() * 60;
                const angle = -45 + Math.random() * 90;
                
                crack.style.cssText = `
                    position: absolute;
                    left: ${startX}px;
                    top: ${startY}px;
                    width: ${length}px;
                    height: 2px;
                    background: linear-gradient(90deg, 
                        transparent 0%, 
                        rgba(255,255,255,0.9) 20%, 
                        rgba(200,200,200,0.8) 50%, 
                        rgba(255,255,255,0.9) 80%, 
                        transparent 100%);
                    transform: rotate(${angle}deg);
                    box-shadow: 0 0 3px rgba(255,255,255,0.5), 0 1px 2px rgba(0,0,0,0.3);
                    animation: crackAppear 0.15s ease-out forwards;
                    z-index: 100;
                `;
                
                // Add branching cracks
                if (Math.random() > 0.5) {
                    const branch = document.createElement('div');
                    branch.className = 'crack-branch';
                    branch.style.cssText = `
                        position: absolute;
                        right: 0;
                        top: 0;
                        width: ${15 + Math.random() * 25}px;
                        height: 1px;
                        background: rgba(255,255,255,0.7);
                        transform: rotate(${30 + Math.random() * 40}deg);
                        transform-origin: left center;
                    `;
                    crack.appendChild(branch);
                }
                
                beaker.appendChild(crack);
            }
            
            // Screen shake
            document.getElementById('reaction-lab').style.animation = 'labShake 0.1s ease-in-out 4';
        }
        
        // Beaker shatters for extreme reactions
        function createBeakerShatter(color) {
            const beaker = document.getElementById('beaker');
            const lab = document.getElementById('reaction-lab');
            beaker.classList.add('shattered');
            
            playSound('success'); // Shattering sound
            
            // Create glass shards flying outward
            for (let i = 0; i < 15; i++) {
                const shard = document.createElement('div');
                shard.className = 'shatter-piece';
                
                const size = 8 + Math.random() * 20;
                const angle = (i / 15) * Math.PI * 2;
                const distance = 80 + Math.random() * 150;
                const rotation = Math.random() * 720 - 360;
                
                shard.style.cssText = `
                    position: absolute;
                    left: 50%;
                    top: 50%;
                    width: ${size}px;
                    height: ${size * 0.6}px;
                    background: linear-gradient(135deg, 
                        rgba(200,220,255,0.8) 0%, 
                        rgba(255,255,255,0.9) 50%, 
                        rgba(180,200,230,0.7) 100%);
                    clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
                    box-shadow: 0 0 5px rgba(255,255,255,0.5);
                    animation: shardFly 0.8s ease-out forwards;
                    --tx: ${Math.cos(angle) * distance}px;
                    --ty: ${Math.sin(angle) * distance}px;
                    --rot: ${rotation}deg;
                    z-index: 200;
                `;
                beaker.appendChild(shard);
                setTimeout(() => shard.remove(), 1000);
            }
            
            // Liquid splashes out
            createLiquidSplash(color);
            
            // Big screen shake
            lab.style.animation = 'labShake 0.08s ease-in-out 10';
        }
        
        // Liquid splashes when beaker breaks
        function createLiquidSplash(color) {
            const beaker = document.getElementById('beaker');
            const liquid = document.getElementById('beaker-liquid');
            
            // Reduce liquid level
            liquid.style.transition = 'height 1s ease-out';
            liquid.style.height = '20%';
            
            // Create splash droplets
            for (let i = 0; i < 20; i++) {
                const drop = document.createElement('div');
                drop.className = 'splash-drop-large';
                
                const size = 5 + Math.random() * 12;
                const angle = Math.PI + (Math.random() - 0.5) * Math.PI; // Mostly outward
                const distance = 60 + Math.random() * 120;
                
                drop.style.cssText = `
                    position: absolute;
                    left: 50%;
                    bottom: 30%;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    border-radius: 50%;
                    box-shadow: 0 0 10px ${color}88;
                    animation: dropletFly 0.8s ease-out forwards;
                    --tx: ${Math.cos(angle) * distance}px;
                    --ty: ${Math.sin(angle) * distance - 30}px;
                    z-index: 150;
                `;
                beaker.appendChild(drop);
                setTimeout(() => drop.remove(), 1000);
            }
        }
        
        // Fire spreads outside the beaker
        function createSpreadingFire(color) {
            const beakerContainer = document.querySelector('.beaker-container');
            
            // Create multiple spreading fire points around the beaker
            const firePositions = [
                { left: '-30px', bottom: '80px' },   // Left of beaker
                { left: '-20px', bottom: '60px' },   // Left lower
                { right: '-30px', bottom: '80px' },  // Right of beaker
                { right: '-20px', bottom: '60px' },  // Right lower
                { left: '20px', bottom: '30px' },    // Front left on table
                { right: '20px', bottom: '30px' }    // Front right on table
            ];
            
            for (let i = 0; i < firePositions.length; i++) {
                setTimeout(() => {
                    const fire = document.createElement('div');
                    fire.className = 'spreading-fire';
                    
                    const pos = firePositions[i];
                    let posStyle = 'position: absolute; ';
                    if (pos.left) posStyle += `left: ${pos.left}; `;
                    if (pos.right) posStyle += `right: ${pos.right}; `;
                    posStyle += `bottom: ${pos.bottom}; `;
                    
                    fire.style.cssText = `
                        ${posStyle}
                        width: 40px;
                        height: 60px;
                        z-index: 100;
                        pointer-events: none;
                    `;
                    
                    // Create flames for this fire point
                    for (let j = 0; j < 4; j++) {
                        const flame = document.createElement('div');
                        flame.style.cssText = `
                            position: absolute;
                            left: ${j * 10}px;
                            bottom: 0;
                            width: ${12 + Math.random() * 8}px;
                            height: ${25 + Math.random() * 20}px;
                            background: radial-gradient(ellipse at bottom, 
                                ${color}dd 0%, 
                                ${color}88 40%, 
                                transparent 75%);
                            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
                            animation: flameDance 0.3s ease-in-out infinite alternate;
                            animation-delay: ${Math.random() * 0.2}s;
                        `;
                        fire.appendChild(flame);
                    }
                    
                    beakerContainer.appendChild(fire);
                    
                    // Fire burns out after a while
                    setTimeout(() => {
                        fire.style.transition = 'opacity 1s ease-out';
                        fire.style.opacity = '0';
                        setTimeout(() => fire.remove(), 1000);
                    }, 2000 + Math.random() * 1500);
                }, i * 200);
            }
            
            // Create smoke from spreading fires
            setTimeout(() => createSmokeCloud(), 1000);
        }
        
        // Dense smoke cloud effect
        function createSmokeCloud() {
            const beakerContainer = document.querySelector('.beaker-container');
            
            // Smoke rises from around/above the beaker
            const smokePositions = [
                { left: '50%', bottom: '220px' },
                { left: '30%', bottom: '200px' },
                { left: '70%', bottom: '200px' },
                { left: '40%', bottom: '180px' },
                { left: '60%', bottom: '180px' },
                { left: '50%', bottom: '240px' },
                { left: '35%', bottom: '220px' },
                { left: '65%', bottom: '220px' }
            ];
            
            for (let i = 0; i < smokePositions.length; i++) {
                setTimeout(() => {
                    const smoke = document.createElement('div');
                    smoke.className = 'smoke-cloud';
                    
                    const size = 40 + Math.random() * 50;
                    const pos = smokePositions[i];
                    smoke.style.cssText = `
                        position: absolute;
                        left: ${pos.left};
                        bottom: ${pos.bottom};
                        transform: translateX(-50%);
                        width: ${size}px;
                        height: ${size}px;
                        background: radial-gradient(circle, 
                            rgba(80,80,80,0.6) 0%, 
                            rgba(60,60,60,0.3) 50%, 
                            transparent 70%);
                        border-radius: 50%;
                        animation: smokeCloudRise 4s ease-out forwards;
                        z-index: 90;
                        pointer-events: none;
                    `;
                    beakerContainer.appendChild(smoke);
                    setTimeout(() => smoke.remove(), 4000);
                }, i * 300);
            }
        }
        
        // Liquid leaks from cracks
        function createLiquidLeak(color) {
            const beaker = document.getElementById('beaker');
            const lab = document.querySelector('.lab-container');
            const liquid = document.getElementById('beaker-liquid');
            
            // Slowly drain the liquid
            liquid.style.transition = 'height 3s ease-out';
            liquid.style.height = '15%';
            
            // Create leak streams from crack positions
            const leakCount = 3;
            for (let i = 0; i < leakCount; i++) {
                const leak = document.createElement('div');
                leak.className = 'leak';
                
                const startX = 30 + Math.random() * 120;
                const startY = 80 + Math.random() * 60;
                
                leak.style.cssText = `
                    position: absolute;
                    left: ${startX}px;
                    top: ${startY}px;
                    width: 4px;
                    height: 0;
                    background: linear-gradient(180deg, ${color}cc, ${color}66);
                    border-radius: 0 0 2px 2px;
                    animation: leakGrow 2s ease-out forwards;
                    box-shadow: 0 0 8px ${color}44;
                    z-index: 50;
                `;
                beaker.appendChild(leak);
                
                // Create drip drops from the leak
                const dripInterval = setInterval(() => {
                    const drip = document.createElement('div');
                    drip.style.cssText = `
                        position: absolute;
                        left: ${startX + 1}px;
                        top: ${startY + 80}px;
                        width: 6px;
                        height: 8px;
                        background: ${color};
                        border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
                        animation: dripFall 0.6s ease-in forwards;
                        box-shadow: 0 0 5px ${color}66;
                        z-index: 49;
                    `;
                    beaker.appendChild(drip);
                    setTimeout(() => drip.remove(), 600);
                }, 300);
                
                setTimeout(() => clearInterval(dripInterval), 3000);
            }
            
            // Create puddle on the table
            setTimeout(() => createPuddle(color), 1500);
        }
        
        // Puddle forms under the beaker
        function createPuddle(color) {
            const beakerContainer = document.querySelector('.beaker-container');
            
            const puddle = document.createElement('div');
            puddle.className = 'leak-puddle';
            puddle.style.cssText = `
                position: absolute;
                left: 50%;
                bottom: 25px;
                transform: translateX(-50%);
                width: 0;
                height: 0;
                background: radial-gradient(ellipse, ${color}88 0%, ${color}44 60%, transparent 100%);
                border-radius: 50%;
                animation: puddleGrow 2s ease-out forwards;
                z-index: 40;
                pointer-events: none;
            `;
            beakerContainer.appendChild(puddle);
        }
        
        function showReactionInfo(reaction) {
            const info = document.getElementById('reaction-info');
            document.getElementById('reaction-name').textContent = reaction.name;
            document.getElementById('reaction-desc').textContent = reaction.description;
            document.getElementById('reaction-equation').textContent = reaction.equation;
            info.classList.add('visible');
        }
        
        function hideReactionInfo() {
            document.getElementById('reaction-info').classList.remove('visible');
        }
        window.hideReactionInfo = hideReactionInfo;
        
        function clearBeaker() {
            labElements = [];
            isReacting = false;
            beakerDamaged = false;
            
            const liquid = document.getElementById('beaker-liquid');
            const beaker = document.getElementById('beaker');
            const lab = document.getElementById('reaction-lab');
            const beakerContainer = document.querySelector('.beaker-container');
            
            // Re-add the reaction glow element after clearing
            liquid.innerHTML = '<div class="reaction-glow"></div>';
            liquid.classList.remove('reacting');
            liquid.style.background = '';
            liquid.style.boxShadow = '';
            liquid.style.transition = '';
            liquid.style.height = '60%';
            
            // Clear fire container
            const fireContainer = document.getElementById('fire-container');
            fireContainer.classList.remove('active');
            fireContainer.innerHTML = '';
            
            // Remove any lingering effects from beaker, beaker-container, and lab
            beaker.querySelectorAll('.smoke, .steam, .spark, .explosion, .crack, .leak, .shatter-piece').forEach(el => el.remove());
            if (beakerContainer) {
                beakerContainer.querySelectorAll('.spreading-fire, .smoke-cloud, .leak-puddle').forEach(el => el.remove());
            }
            lab.querySelectorAll('.spreading-fire, .smoke-cloud, .leak-puddle').forEach(el => el.remove());
            
            // Reset beaker appearance
            beaker.classList.remove('cracked', 'shattered');
            beaker.style.filter = '';
            
            // Stop any ongoing animations
            lab.style.animation = '';
            
            hideReactionInfo();
            playSound('click');
        }
        
        // Reset beaker to pristine state
        function resetBeakerState() {
            const beaker = document.getElementById('beaker');
            const liquid = document.getElementById('beaker-liquid');
            beaker.classList.remove('cracked', 'shattered');
            beaker.style.filter = '';
            liquid.style.height = '60%';
            beakerDamaged = false;
        }
        
        function openReactionLab() {
            document.getElementById('reaction-lab').classList.add('visible');
            // Reset beaker state when opening
            clearBeaker();
            // Reset beaker visual state (remove any damage)
            resetBeakerState();
            populateElementTray();
            populateRecipeBook();
        }
        
        function populateRecipeBook() {
            const recipeList = document.getElementById('recipe-list');
            recipeList.innerHTML = '';
            
            // Map reaction keys to readable element combinations
            const reactionInfo = {
                'Na-H2O': { elements: 'Na + H + O', hint: 'Sodium in Water' },
                'K-H2O': { elements: 'K + H + O', hint: 'Potassium in Water' },
                'Li-H2O': { elements: 'Li + H + O', hint: 'Lithium in Water' },
                'Mg-H2O': { elements: 'Mg + H + O', hint: 'Magnesium in Water' },
                'Ca-H2O': { elements: 'Ca + H + O', hint: 'Calcium in Water' },
                'Fe-O': { elements: 'Fe + O', hint: 'Iron Oxidation' },
                'H-O': { elements: 'H + O', hint: 'Hydrogen & Oxygen' },
                'C-O': { elements: 'C + O', hint: 'Carbon Combustion' },
                'Mg-O': { elements: 'Mg + O', hint: 'Magnesium Fire' },
                'Na-Cl': { elements: 'Na + Cl', hint: 'Salt Formation' },
                'Cu-S': { elements: 'Cu + S', hint: 'Copper & Sulfur' },
                'Zn-H': { elements: 'Zn + H', hint: 'Zinc in Acid' },
                'Ag-S': { elements: 'Ag + S', hint: 'Silver Tarnish' },
                'P-O': { elements: 'P + O', hint: 'Phosphorus Fire' },
                'Al-Fe': { elements: 'Al + Fe', hint: 'Thermite Reaction' }
            };
            
            // Sort reactions by intensity for better organization
            const intensityOrder = { 'extreme': 0, 'high': 1, 'medium': 2, 'low': 3 };
            const sortedReactions = Object.entries(labReactions).sort((a, b) => {
                return intensityOrder[a[1].intensity] - intensityOrder[b[1].intensity];
            });
            
            sortedReactions.forEach(([key, reaction]) => {
                const info = reactionInfo[key] || { elements: key, hint: '' };
                const item = document.createElement('div');
                item.className = `recipe-item ${reaction.intensity}`;
                item.innerHTML = `
                    <div class="recipe-name">
                        <span>${reaction.name}</span>
                        <span class="recipe-intensity ${reaction.intensity}">${reaction.intensity}</span>
                    </div>
                    <div class="recipe-elements">${info.elements}</div>
                    <div class="recipe-equation">${reaction.equation}</div>
                `;
                
                // Clicking a recipe highlights required elements
                item.addEventListener('click', () => {
                    highlightRecipeElements(info.elements);
                });
                
                item.addEventListener('mouseenter', () => {
                    item.style.background = `linear-gradient(135deg, ${reaction.color}22, ${reaction.color}11)`;
                });
                
                item.addEventListener('mouseleave', () => {
                    item.style.background = '';
                });
                
                recipeList.appendChild(item);
            });
        }
        
        function highlightRecipeElements(elementsStr) {
            // Parse elements from string like "Na + H + O"
            const symbols = elementsStr.split('+').map(s => s.trim());
            
            // Flash the corresponding elements in the tray
            const trayElements = document.querySelectorAll('.tray-element');
            trayElements.forEach(el => {
                const symbol = el.querySelector('.symbol').textContent;
                if (symbols.includes(symbol)) {
                    el.style.animation = 'none';
                    el.offsetHeight; // Force reflow
                    el.style.animation = 'recipeHighlight 0.6s ease-out 2';
                    el.style.boxShadow = '0 0 20px rgba(255, 200, 100, 0.6), inset 0 0 15px rgba(255, 200, 100, 0.2)';
                    setTimeout(() => {
                        el.style.boxShadow = '';
                    }, 1200);
                }
            });
            
            playSound('click');
        }
        
        function closeReactionLab() {
            document.getElementById('reaction-lab').classList.remove('visible');
            clearBeaker();
        }
        window.closeReactionLab = closeReactionLab;
        
        // Add lab shake animation
        const labStyle = document.createElement('style');
        labStyle.textContent = `
            @keyframes labShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
            @keyframes flashFade {
                0% { opacity: 1; }
                100% { opacity: 0; }
            }
            @keyframes recipeHighlight {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); border-color: rgba(255, 200, 100, 0.8); }
            }
        `;
        document.head.appendChild(labStyle);
        
        // Button handler
        document.getElementById('btn-lab').addEventListener('click', openReactionLab);

        // Initialize with error handling
        try {
            createScientificBackground();
            init();
        } catch(e) {
            console.error('Init error:', e);
            // Fallback: hide loading screen if init fails
            document.getElementById('loading').classList.add('hidden');
        }
    </script>
</body>
</html>